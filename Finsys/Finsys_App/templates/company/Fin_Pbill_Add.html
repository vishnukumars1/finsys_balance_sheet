{% extends 'company/Fin_base.html' %}
{% block body %}
{% load static %}

<style>
    input:read-only, select:disabled, textarea:read-only {
        background-color: #43596c !important;
        color: #fff;
    }

    .select2-container--default .select2-search--dropdown{
        background-color: black !important;
        color: white !important;
    }
    .select2-container--default .select2-search--dropdown .select2-search__field {
        background-color: White !important;
        color: Black !important;
    }

    .select2-container--default .select2-results__option {
        color: white;
        background-color: black;
    }

    .select2-container--default .select2-selection--single{
        background-color: #43596c !important;
        padding:4px;
        height: 35px!important;
        font-size: 1.2em;  
    }

    .select2-container--default .select2-selection--single .select2-selection__rendered {
        color: white !important;
    }

    #bal_type{
        background-color: #243e54; 
        border-radius: 5px;
    }

    #ncust_bal_type{
        background-color: #243e54; 
        border-radius: 5px;
    }

    #tab_logic_total{
        background-color:rgba(0,0,0,.4); 
        border: 1px solid rgba(128, 128, 128, 0.6);
    }

    #shipcharge, #adjustment, #paid{
        background-color: #43596c;
    }

    .qty_text{
        font-size: smaller; 
        font-weight: lighter;
    }

    ::-webkit-scrollbar{
        display: none;
    }
</style>

<div class="page-content">
    <div class="d-flex justify-content-end mb-1">
        <a href="{% url 'Fin_List_Purchase_Bill' %}"><i class="fa fa-times-circle text-white mx-4 p-1" style="font-size: 1.2rem;margin-right: -0rem !important;"></i></a>
      </div>
    <div class="card radius-15 h-20">
        <div class="row">
          <div class="col-md-12">
            <center><h2 class="mt-3">NEW BILL</h2></center>
            <hr/>
          </div>
        </div>
      </div>

    <!-- <div class="card radius-15">
        <div class="card-body">
            <div class="card-title">
                <center><h3 class="mb-0">NEW BILL</h3></center>
            </div>
            <hr/>
        </div>
    </div> -->
    <div class="card radius-15" style="background-color: #243e54;">
        <div class="card-body">
            <div class="card-title">
                <h4 class="mb-0">Vendor Details</h4>
            </div>
            <hr/>
            <form action="{% url 'Fin_Create_Purchase_Bill' %}" method="post" enctype="multipart/form-data" autocomplete="off">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-4 mt-2">
                        <label for="validationCustom01">Select Vendor</label>
                        <div class="d-flex">
                            <select name="ven_name" id="ven_name" class="custom-select" required>
                                <option value="">Select Vendor</option>
                                {% for v in ven %}
                                <option value="{{v.id}}" 
                                data-email="{{v.email}}"
                                data-plsupply="{{v.place_of_supply}}"
                                data-gsttype="{{v.gst_type}}"
                                data-gstno="{{v.gstin}}"
                                data-street="{{v.billing_street}}"
                                data-city="{{v.billing_city}}"
                                data-state="{{v.billing_state}}"
                                data-pincode="{{v.billing_pincode}}"
                                data-country="{{v.billing_country}}">
                                    {{ v.first_name }} {{ v.last_name }}
                                </option>
                                {% endfor %}
                            </select>
                            <a><button type="button" class="btn btn-outline-secondary ml-1" data-target="#newvendor" data-toggle="modal">+</button></a>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mt-4">
                        <label for="">Billing Address</label>
                        <div class="form-row">
                            <textarea class="form-control" id="ven_address" name="ven_address" rows="5" readonly></textarea>
                        </div>
                    </div>
                    <div class="col-md-4 mt-4">
                        <label for="">Email</label>
                        <input type="email" class="form-control" id="ven_email" name="ven_email" readonly>

                        <br>
                        <label for="" class="mt-2">GST Treatment</label>
                        <select class="form-control" id="ven_gst_type" name="ven_gst_type" disabled>
                            <option selected value=""></option>
                            <option value="Registered Business - Regular">Registered Business - Regular <span><i>(Business that is registered under gst)</i></span></option>
                            <option value="Registered Business - Composition">Registered Business - Composition (Business that is registered under composition scheme in gst)</option>
                            <option value="Unregistered Business">Unregistered Business (Business that has not been registered under gst)</option>
                            <option value="Overseas">Overseas (Import/Export of supply outside india)</option>
                            <option value="Consumer">Consumer</option>
                            <option value="Special Economic Zone (SEZ)">Special Economic Zone (SEZ) (Business that is located in a special economic zone of india or a SEZ developer)</option>
                            <option value="Demed Exports">Demed Exports (Supply of woods to an exports oriented unit or againsed advanced authorization or export promotion capital woods)</option>
                            <option value="Tax Deductor">Tax Deductor (State of central gov,government agencies or local authority)</option>
                            <option value="SEZ Developer">SEZ Developer (A person or organization who owns atleast 26% equality in creating business units in special economic zone)</option>
                        </select>
                    </div>
                    <div class="col-md-4 mt-4">
                        <label for="">Place of Supply</label>
                        <select class="custom-select form-control" id="ven_psupply" name="ven_psupply">
                            <option value="" selected hidden>Place of Supply</option>
                            <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                            <option value="Assam">Assam</option>
                            <option value="Bihar">Bihar</option>
                            <option value="Chandigarh">Chandigarh</option>
                            <option value="Chhattisgarh">Chhattisgarh</option>
                            <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                            <option value="Damn anad Diu">Damn anad Diu</option>
                            <option value="Delhi">Delhi</option>
                            <option value="Goa">Goa</option>
                            <option value="Gujarat">Gujarat</option>
                            <option value="Haryana">Haryana</option>
                            <option value="Himachal Pradesh">Himachal Pradesh</option>
                            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                            <option value="Jharkhand">Jharkhand</option>
                            <option value="Karnataka">Karnataka</option>
                            <option value="Kerala">Kerala</option>
                            <option value="Ladakh">Ladakh</option>
                            <option value="Lakshadweep">Lakshadweep</option>
                            <option value="Madhya Pradesh">Madhya Pradesh</option>
                            <option value="Maharashtra">Maharashtra</option>
                            <option value="Manipur">Manipur</option>
                            <option value="Meghalaya">Meghalaya</option>
                            <option value="Mizoram">Mizoram</option>
                            <option value="Nagaland">Nagaland</option>
                            <option value="Odisha">Odisha</option>
                            <option value="Puducherry">Puducherry</option>
                            <option value="Punjab">Punjab</option>
                            <option value="Rajasthan">Rajasthan</option>
                            <option value="Sikkim">Sikkim</option>
                            <option value="Tamil Nadu">Tamil Nadu</option>
                            <option value="Telangana">Telangana</option>
                            <option value="Tripura">Tripura</option>
                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                            <option value="Uttarakhand">Uttarakhand</option>
                            <option value="West Bengal">West Bengal</option>
                            <option value="Other Territory">Other Territory</option>
                        </select>
                        
                        <br>
                        <div id="ven_gst_in_div" style="display: none;">
                            <div class="mt-2">
                                <br>
                                <label for="">GST IN</label>
                                <input type="text" class="form-control" id="ven_gst_in" name="ven_gst_in" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                <hr>
                <br><br>
                <div class="row">
                    <div class="col-md-3 mt-2"><h5>Bill Details</h5></div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-4 mt-2">
                        <label>Bill Number</label>
                        {% if bill_no == 1000 %}
                        <input type="text" class="form-control" name="bill_no" id="bill_no" required>
                        {% else %}
                        <input type="text" class="form-control" name="bill_no" id="bill_no" placeholder="{{bill_no}}" required>
                        {% endif %}
                        <h6 class="text-danger mt-1" id="bill_error"></h6>
                    </div>
                    <div class="col-md-4 mt-2">
                        <label for="">Reference Number</label>
                        <input type="text" class="form-control" name="ref_no" id="ref_no" value="{{ref_no}}" readonly>   
                    </div>
                    <div class="col-md-4 mt-2">
                        <label for="">Purchase Order Number</label>
                        <input type="text" class="form-control" name="pord_no" id="pord_no" readonly>   
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-3 mt-2">
                        <label for="">Bill Date</label>
                        <input type="date" class="form-control" id="bill_date" name="bill_date" value="{{tod}}">
                    </div>
                    <div class="col-md-3 mt-2">
                        <label>Due Date</label>
                        <input type="date" class="form-control" id="due_date" name="due_date" value="{{tod}}" readonly>
                    </div>
                    <div class="col-md-3 mt-2">
                        <label for="">Payment Terms</label>
                        <div class="d-flex">
                            <select class="custom-select" name="pay_terms" id="pay_terms" required>
                                {% for t in terms %}
                                    <option value="{{t.id}}" data-days="{{t.days}}">{{ t.term_name }}</option>
                                {% endfor %}
                            </select>
                            <a class="btn btn-outline-secondary ml-1" data-target="#newterm" data-toggle="modal">+</a>
                        </div> 
                    </div>
                    <div class="col-md-3 mt-2">
                        <label for="">Payment Type</label>
                        <select class="form-control" name="pay_type" id="pay_type" required>
                            <option value="" hidden>Select</option>
                            <option value="Cash">Cash</option>
                            <option value="Cheque">Cheque</option>
                            <option value="UPI">UPI</option>
                            {% for b in bnk %}
                            <option value="{{b.bank_name}}" data-acno="{{b.account_number}}">{{ b.bank_name }} ({{b.account_number}})</option>
                            {% endfor %}
                        </select>  
                    </div>
                    <div class="col-md-3 mt-4" id="cheque_id_div" style="display: none;">
                        <label for="">Cheque ID</label>
                        <input type="text" class="form-control" id="cheque_id"  name="cheque_id">
                    </div>
                    <div class="col-md-3 mt-4" id="upi_id_div" style="display: none;">
                        <label for="">UPI ID</label>
                        <input type="text" class="form-control" id="upi_id"  name="upi_id">
                    </div>
                    <div class="col-md-3 mt-4" id="bank_id_div" style="display: none;">
                        <label for="">Bank Account Number</label>
                        <input type="text" class="form-control" id="bnk_no" name="bnk_no" readonly>
                    </div>
                </div>
                <hr>
                <br><br>
                <div class="row">
                    <div class="col-md-3 mt-2"><h5>Customer Details</h5></div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-4 mt-2">
                        <label for="validationCustom01">Select Customer</label>
                        <div class="d-flex">
                            <select name="cust_name" id="cust_name" class="custom-select">
                                <option value="">Select Customer</option>
                                <option value="none">None</option>
                                {% for c in cust %}
                                <option value="{{c.id}}" 
                                data-email="{{c.email}}"
                                data-plsupply="{{c.place_of_supply}}"
                                data-gsttype="{{c.gst_type}}"
                                data-gstno="{{c.gstin}}"
                                data-street="{{c.billing_street}}"
                                data-city="{{c.billing_city}}"
                                data-state="{{c.billing_state}}"
                                data-pincode="{{c.billing_pincode}}"
                                data-country="{{c.billing_country}}">
                                    {{ c.first_name }} {{ c.last_name }}
                                </option>
                                {% endfor %}
                            </select>
                            <a class="btn btn-outline-secondary ml-1" role="button" data-target="#newcustomer" data-toggle="modal">+</a>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mt-4">
                        <label for="">Billing Address</label>
                        <div class="form-row">
                            <textarea class="form-control" id="cust_address" name="cust_address" rows="5" readonly></textarea>
                        </div>
                    </div>
                    <div class="col-md-4 mt-4">
                        <label for="">Email</label>
                        <input type="email" class="form-control" id="cust_email" name="cust_email" readonly>

                        <br>
                        <label for="" class="mt-2">GST Treatment</label>
                        <select class="form-control" id="cust_gst_type" name="cust_gst_type" disabled>
                            <option selected value=""></option>
                            <option value="Registered Business - Regular">Registered Business - Regular <span><i>(Business that is registered under gst)</i></span></option>
                            <option value="Registered Business - Composition">Registered Business - Composition (Business that is registered under composition scheme in gst)</option>
                            <option value="Unregistered Business">Unregistered Business (Business that has not been registered under gst)</option>
                            <option value="Overseas">Overseas (Import/Export of supply outside india)</option>
                            <option value="Consumer">Consumer</option>
                            <option value="Special Economic Zone (SEZ)">Special Economic Zone (SEZ) (Business that is located in a special economic zone of india or a SEZ developer)</option>
                            <option value="Demed Exports">Demed Exports (Supply of woods to an exports oriented unit or againsed advanced authorization or export promotion capital woods)</option>
                            <option value="Tax Deductor">Tax Deductor (State of central gov,government agencies or local authority)</option>
                            <option value="SEZ Developer">SEZ Developer (A person or organization who owns atleast 26% equality in creating business units in special economic zone)</option>
                        </select>
                    </div>
                    <div class="col-md-4 mt-4">
                        <label for="">Place of Supply</label>
                        <select class="custom-select form-control" id="cust_psupply" name="cust_psupply">
                            <option value="" selected hidden>Place of Supply</option>
                            <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                            <option value="Assam">Assam</option>
                            <option value="Bihar">Bihar</option>
                            <option value="Chandigarh">Chandigarh</option>
                            <option value="Chhattisgarh">Chhattisgarh</option>
                            <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                            <option value="Damn anad Diu">Damn anad Diu</option>
                            <option value="Delhi">Delhi</option>
                            <option value="Goa">Goa</option>
                            <option value="Gujarat">Gujarat</option>
                            <option value="Haryana">Haryana</option>
                            <option value="Himachal Pradesh">Himachal Pradesh</option>
                            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                            <option value="Jharkhand">Jharkhand</option>
                            <option value="Karnataka">Karnataka</option>
                            <option value="Kerala">Kerala</option>
                            <option value="Ladakh">Ladakh</option>
                            <option value="Lakshadweep">Lakshadweep</option>
                            <option value="Madhya Pradesh">Madhya Pradesh</option>
                            <option value="Maharashtra">Maharashtra</option>
                            <option value="Manipur">Manipur</option>
                            <option value="Meghalaya">Meghalaya</option>
                            <option value="Mizoram">Mizoram</option>
                            <option value="Nagaland">Nagaland</option>
                            <option value="Odisha">Odisha</option>
                            <option value="Puducherry">Puducherry</option>
                            <option value="Punjab">Punjab</option>
                            <option value="Rajasthan">Rajasthan</option>
                            <option value="Sikkim">Sikkim</option>
                            <option value="Tamil Nadu">Tamil Nadu</option>
                            <option value="Telangana">Telangana</option>
                            <option value="Tripura">Tripura</option>
                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                            <option value="Uttarakhand">Uttarakhand</option>
                            <option value="West Bengal">West Bengal</option>
                            <option value="Other Territory">Other Territory</option>
                        </select>

                        <br>
                        <div id="cust_gst_in_div" style="display: none;">
                            <div class="mt-2">
                                <br>
                                <label for="">GST IN</label>
                                <input type="text" class="form-control" id="cust_gst_in" name="cust_gst_in" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                <hr>
                <br>
                <div class="row">
                    <div class="col-md-3 mt-2">
                        <label for="">Price List</label>
                        <input type="checkbox" class="ml-2 mt-3" name="price_list_confirm" id="price_list_confirm">
                        <select class="form-control" name="price_list" id="price_list" style="display: none;">
                            <option value="" selected hidden>Choose</option>
                            {% for p in plist %}
                            {% if p.type == 'Purchase' %}
                                <option value="{{p.id}}">{{p.name}}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-12 table-responsive-md mt-3">
                        <table class="table table-bordered table-hover mt-3" id="item_table" >
                            <thead>
                                <tr style="color: black;">
                                    <th class="text-center">#</th>
                                    <th class="text-center">PRODUCT</th>
                                    <th class="text-center">HSN / SAC</th>
                                    <th class="text-center">QTY</th>
                                    <th class="text-center">PRICE</th>
                                    <th class="text-center">TAX (%)</th>
                                    <th class="text-center">DISCOUNT</th>
                                    <th class="text-center">TOTAL</th>
                                    <th class="text-center">FIELD</th>
                                </tr>
                            </thead>
                            <tbody id="items-table-body">
                                <tr id='addr01'>
                                    <td class="nnum text-center">1</td>
                                    <td style="width:21%">
                                        <div class="d-flex">
                                            <select name='product[]' id="product1" class="form-control border-secondary product" onchange='item_data(this.id)' required>
                                                <option value="" selected hidden>Select Product</option>
                                                {% for i in itm %}
                                                    <option value="{{ i.id }}" 
                                                    data-hsn="{{i.hsn}}"
                                                    data-sac="{{ i.sac }}"
                                                    data-item_type="{{ i.item_type }}"
                                                    data-stock="{{i.current_stock}}" 
                                                    data-price="{{i.purchase_price}}"
                                                    data-intra="{{i.intra_state_tax}}"
                                                    data-inter="{{i.inter_state_tax}}">
                                                        {{ i.name }} 
                                                    </option>
                                                {% endfor %}
                                            </select> &nbsp;&nbsp;&nbsp;
                                            <a><button type="button" class="btn btn-outline-secondary" data-target="#newitem" data-toggle="modal">+</button></a>
                                        </div>
                                    </td>

                                    <td style="width:12%">
                                        <input type="text" name='hsn[]' id="hsn1" class="form-control border-secondary HSNCODE" readonly />
                                        <input type="text" name='sac[]' id="sac1" class="form-control border-secondary SACCODE" readonly style="display: none;"/>
                                    </td>

                                    <td style="width:13%">
                                        <br>
                                        <input type="number" name='qty[]' id="qty1"  class="form-control border-secondary qty mb-1" step=0 min=1 value=0 onchange="change_quantity(this.id)" title="Value Should Be Greater Than Zero" required/>
                                        <span class="qty_text"> Available Quantity <span id="stock1"></span></span>
                                    </td>
                                
                                    <td style="width:12%">
                                        <input type="number" name='price[]' id="price1" class="form-control border-secondary price" step="0.00" min="0" value=0 readonly />
                                    </td>
                                
                                    <td style="width:15%">
                                        <br>
                                        <input type="text" id="intrataxval1" hidden>
                                        <input type="text" id="intertaxval1" hidden>
                                        <input type="text" name='tax[]' id="tax1" class="form-control border-secondary tax mb-1" placeholder="Tax Rate" readonly />
                                        <select name='intra_tax[]' id="intra_tax1" class="form-control intra_tax d-none mb-4" onchange="calc()">
                                            <option value="" selected hidden>Select GST</option>
                                            <option value=28 >28.0% GST</option>
                                            <option value=18 >18.0% GST</option>
                                            <option value=12 >12.0% GST</option>
                                            <option value=5 >05.0% GST</option>
                                            <option value=3 >03.0% GST</option>
                                            <option value=0 >0.0% GST</option>
                                        </select>
                                        <select name='inter_tax[]' id="inter_tax1" class="form-control inter_tax d-none mb-4" onchange="calc()">
                                            <option value="" selected hidden>Select IGST</option>
                                            <option value=28 >28.0% IGST</option>
                                            <option value=18 >18.0% IGST</option>
                                            <option value=12 >12.0% IGST</option>
                                            <option value=5 >05.0% IGST</option>
                                            <option value=3 >03.0% IGST</option>
                                            <option value=0 >0.0% IGST</option>
                                        </select>
                                        <span class="text-danger nostate" style="font-size: small; font-weight: lighter ;" id="nostate1">&nbsp;</span>                                    
                                    </td>

                                    <td style="width: 10%;" >
                                        <input type="number" name='discount[]'  placeholder='Enter Discount' id="disc1" value=0 class="form-control border-secondary disc" step=0 min=0 onchange="calc()" />
                                    </td>
                
                                    <td style="width:13%">
                                        <input type="number" name='total[]' id="total1" class="form-control border-secondary total" value=0 readonly />
                                    </td>

                                    <td style="display: none;"><input type="text" id="taxamount1" class="form-control border-secondary taxamount" /></td>
                                    
                                    <td style="width:5%">
                                        <button type="button" id="1" class="btn btn-danger remove_row px-2 py-1 mx-1 fa fa-close" title="Remove Row"> </button>
                                    </td>
                                </tr>
                            </tbody>
                            <tr>
                                <td style="border: none;"><a class="btn btn-outline-secondary ml-1" role="button" id="add" ><span class="fa fa-plus"></span></a></td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="row mt-5 mr-1">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="">Note</label>
                                <div class="form-row">
                                    <textarea class="form-control" name="note" rows="3"></textarea>
                                </div><br>
                                <div>
                                    <input type="file" class="form-control" name="file">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-1 mt-3"></div>
                    <div class="col-md-5 table-responsive-md mt-3" id="tab_logic_total"><br>
                        <div class="p-3">
                            <div class="row container-fluid p-2 m-0">
                                <div class="col-sm-4 mt-2"><label for="a" class="text-center">Sub Total</label></div>
                                <div class="col-sm-1 mt-2">:</div>
                                <div class="col-sm-7 mt-2">
                                    <input type="number" class="form-control" id="sub_total" name='sub_total' step="any" value=0 readonly>
                                </div>
                                <div class="col-sm-4 m-0 p-0"></div>
                            </div>
                            <div class="row container-fluid p-2 m-0" id="igst_div">
                                <div class="col-sm-4 mt-2"><label for="a" class="text-center">IGST</label></div>
                                <div class="col-sm-1 mt-2">:</div>
                                <div class="col-sm-7 mt-2">
                                    <input type="number" class="form-control" id="igst" name='igst' step="any" value=0 readonly/>
                                </div>
                                <div class="col-sm-4 m-0 p-0"></div>
                            </div>
                            <div class="row container-fluid p-2 m-0" style="display: none;" id="cgst_div">
                                <div class="col-sm-4 mt-2"><label for="a" class="text-center">CGST</label></div>
                                <div class="col-sm-1 mt-2">:</div>
                                <div class="col-sm-7 mt-2">
                                    <input type="number" class="form-control" id="cgst" name='cgst' step="any" value=0 readonly/>
                                </div>
                                <div class="col-sm-4 m-0 p-0"></div>
                            </div>
                            <div class="row container-fluid p-2 m-0" style="display: none;" id="sgst_div">
                                <div class="col-sm-4 mt-2"><label for="a" class="text-center">SGST</label></div>
                                <div class="col-sm-1 mt-2">:</div>
                                <div class="col-sm-7 mt-2">
                                    <input type="number" class="form-control" id="sgst" name='sgst' step="any" value=0 readonly/>
                                </div>
                                <div class="col-sm-4 m-0 p-0"></div>
                            </div>
                            <div class="row container-fluid p-2 m-0">
                                <div class="col-sm-4 mt-2"><label for="a" class="text-center">Tax Amount</label></div>
                                <div class="col-sm-1 mt-2">:</div>
                                <div class="col-sm-7 mt-2">
                                    <input type="number" class="form-control" id="tax_amount" name='tax_amount' step="any" value=0  readonly/>
                                </div>
                                <div class="col-sm-4 m-0 p-0"></div>
                            </div>
                            <div class="row container-fluid p-2 m-0">
                                <div class="col-sm-4 mt-2"><label for="a" class="text-center">Shipping Charge</label></div>
                                <div class="col-sm-1 mt-2">:</div>
                                <div class="col-sm-7 mt-2">
                                    <input type="number" class="form-control" id="shipcharge" name='shipcharge' step="any" value=0>
                                </div>
                                <div class="col-sm-4 m-0 p-0"></div>
                            </div>
                            <div class="row container-fluid p-2 m-0">
                                <div class="col-sm-4 mt-2"><a class="text-center">Adjustments</a></div>
                                <div class="col-sm-1 mt-2">:</div>
                                <div class="col-sm-7 mt-2">
                                    <input type="number" class="form-control" name='adjustment' id="adjustment" step="any" value=0 />
                                </div>
                                <div class="col-sm-4 m-0 p-0"></div>
                            </div>
                            <div class="row container-fluid  p-2 m-0">
                                <div class="col-sm-4 mt-2"><label for="a" class="text-center">Grand Total</label></div>
                                <div class="col-sm-1 mt-2">:</div>
                                <div class="col-sm-7 mt-2">
                                    <input type="number" class="form-control" id="grand_total" name='grand_total' step="any" value=0 readonly>
                                </div>
                                <div class="col-sm-4 m-0 p-0"></div>
                            </div>
                        </div>   
                    </div>
                </div>
                <div class="row mr-1">
                    <div class="col-md-7"></div>
                    <div class="col-md-5 table-responsive-md mt-3" id="tab_logic_total"><br>
                        <div class="p-3">
                            <div class="row container-fluid p-2 m-0">
                                <div class="col-sm-4 mt-2"><label>Paid</label></div>
                                <div class="col-sm-1 mt-2">:</div>
                                <div class="col-sm-7 mt-2">
                                    <input type="number" class="form-control" id="paid" name='paid' step="any" value=0 >
                                    <p id="error-message" class="mt-1" style="color: red;"></p>
                                </div>
                                <div class="col-sm-4 m-0 p-0"></div>
                            </div>
                            <div class="row container-fluid p-2 m-0" >
                                <div class="col-sm-4"><label for="a" class="text-center">Balance Due</label></div>
                                <div class="col-sm-1">:</div>
                                <div class="col-sm-7">
                                    <input type="number" class="form-control" id="bal_due" name='bal_due' step="any" value=0 readonly>
                                </div>
                                <div class="col-sm-4 m-0 p-0"></div>
                            </div>
                        </div>   
                    </div>
                </div>
                <div class="row mr-1">
                    <div class="col-md-7">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="invalidCheck" required>
                            <label>Agree to terms and conditions</label>
                            <div class="invalid-feedback">You must agree before submitting.</div>
                        </div>
                        <div class="mt-3">
                            <div class="text-muted">NOTICE:</div>
                            <div class="text-muted">
                                Fin sYs Terms and Conditions Apply
                            </div>
                        </div>
                        <footer class="text-muted">
                            Purchase was created on a computer and is valid without the signature and seal.
                        </footer>
                    </div>
                    <div class="col-md-5 mt-3">  
                        <div class="d-flex justify-content-between">
                            <button class="btn btn-outline-secondary text-grey w-100 mt-3 mb-3 mr-2" type="submit" name="Save"> Save</button>
                            <button class="btn btn-outline-secondary text-grey w-100 mt-3 mb-3 ml-2 " type="submit" name="Draft">Draft</button>
                        </div>
                    </div>
                </div>
            </form>

            <div class="modal fade" id="newvendor">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content" style="background-color: #213b52;">
                        <div class="modal-header">
                            <h3 class="m-3" id="ven_modal_head">New Vendor</h3>
                            <button type="button" class="close" aria-label="Close" id="new_ven_close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <button type="button" class="close" aria-label="Close" id="new_vterm_close" style="display: none;">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="card p-3 m-3">
                                <form method="post" class="needs-validation" autocomplete="off" id="vendor_form">
                                    {% csrf_token %}
                                    <div class="row mt-3">
                                        <div class="col-md-3">
                                            <input type="text" class="new_modal_type_ven" value="Vendor" hidden>
                                            <label for="title">Title</label>
                                            <select name="title" id="title" class="form-control">
                                                <option value="Mr">Mr</option>
                                                <option value="Mrs">Mrs</option>
                                                <option value="Ms">Ms</option>
                                                <option value="Dr">Dr</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="firstName">First Name</label>
                                            <input type="text" class="form-control" id="firstName" name="first_name">
                                            <span class="font-medium text-danger" id="ven-name-error"></span>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="lastName">Last Name</label>
                                            <input type="text" class="form-control" id="lastName" name="last_name">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="companyName">Company</label>
                                            <input type="text" class="form-control" id="companyName" name="company_name">
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-3">
                                            <label for="location">Location</label>
                                            <input type="text" class="form-control" id="location" name="location">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="vendorEmail">Email</label>
                                            <input type="email" class="form-control" id="vendorEmail" name="email" placeholder="finsys@gmail.com">
                                            <span class="font-medium text-danger" id="ven-email-error"></span>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="vendorWebsite">Website</label>
                                            <input type="text" class="form-control" id="vendorWebsite" name="website" placeholder="www.finsys.com">
                                            <span class="font-medium text-danger" id="ven-web-error"></span>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="vendorMobile">Mobile</label>
                                            <input type="text" class="form-control" id="vendorMobile" name="mobile">
                                            <span class="font-medium text-danger" id="ven-mobile-error"></span>
                                        </div>
                                    </div>
                                    <hr>
                                    <h4>Other Options</h4>
                                    <hr>
                                    <div class="row mt-3">
                                        <div class="col-md-3">
                                            <label for="gstType">GST Type</label>
                                            <select class="form-control" id="gstType" name="gst_type">
                                                <option selected value="">Select GST Type</option>
                                                <option value="Registered Business - Regular">Registered Business - Regular <span><i>(Business that is registered under gst)</i></span></option>
                                                <option value="Registered Business - Composition">Registered Business - Composition (Business that is registered under composition scheme in gst)</option>
                                                <option value="Unregistered Business">Unregistered Business (Business that has not been registered under gst)</option>
                                                <option value="Overseas">Overseas (Import/Export of supply outside india)</option>
                                                <option value="Consumer">Consumer</option>
                                                <option value="Special Economic Zone (SEZ)">Special Economic Zone (SEZ) (Business that is located in a special economic zone of india or a SEZ developer)</option>
                                                <option value="Demed Exports">Demed Exports (Supply of woods to an exports oriented unit or againsed advanced authorization or export promotion capital woods)</option>
                                                <option value="Tax Deductor">Tax Deductor (State of central gov,government agencies or local authority)</option>
                                                <option value="SEZ Developer">SEZ Developer (A person or organization who owns atleast 26% equality in creating business units in special economic zone)</option>
                                            </select>
                                        </div>
                
                                        <div class="col-md-3 gstrow d-block" id="gstInValue">
                                            <label for="gstIN">GSTIN</label>
                                            <input type="text" class="form-control" id="gstIN" name="gstin" placeholder="29APPCK7465F1Z1">
                                            <span class="font-medium text-danger" id="ven-gst-error"></span>
                                        </div>
                
                                        <div class="col-md-3">
                                            <label for="panNo">PAN No.</label>
                                            <input type="text" class="form-control" id="panNo" name="pan_no" placeholder="APPCK7465F">
                                            <span class="font-medium text-danger" id="ven-pan-error"></span>
                                        </div>
                
                                        <div class="col-md-3">
                                            <label for="placeOfSupply">Place of Supply</label>
                                            <select class="custom-select form-control" id="placeOfSupply" name="place_of_supply">
                                                <option selected value="" hidden>Select Place of Supply</option>
                                                <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                                <option value="Andhra Pradesh">Andhra Pradesh</option>
                                                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                <option value="Assam">Assam</option>
                                                <option value="Bihar">Bihar</option>
                                                <option value="Chandigarh">Chandigarh</option>
                                                <option value="Chhattisgarh">Chhattisgarh</option>
                                                <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                <option value="Damn anad Diu">Damn anad Diu</option>
                                                <option value="Delhi">Delhi</option>
                                                <option value="Goa">Goa</option>
                                                <option value="Gujarat">Gujarat</option>
                                                <option value="Haryana">Haryana</option>
                                                <option value="Himachal Pradesh">Himachal Pradesh</option>
                                                <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                <option value="Jharkhand">Jharkhand</option>
                                                <option value="Karnataka">Karnataka</option>
                                                <option value="Kerala">Kerala</option>
                                                <option value="Ladakh">Ladakh</option>
                                                <option value="Lakshadweep">Lakshadweep</option>
                                                <option value="Madhya Pradesh">Madhya Pradesh</option>
                                                <option value="Maharashtra">Maharashtra</option>
                                                <option value="Manipur">Manipur</option>
                                                <option value="Meghalaya">Meghalaya</option>
                                                <option value="Mizoram">Mizoram</option>
                                                <option value="Nagaland">Nagaland</option>
                                                <option value="Odisha">Odisha</option>
                                                <option value="Puducherry">Puducherry</option>
                                                <option value="Punjab">Punjab</option>
                                                <option value="Rajasthan">Rajasthan</option>
                                                <option value="Sikkim">Sikkim</option>
                                                <option value="Tamil Nadu">Tamil Nadu</option>
                                                <option value="Telangana">Telangana</option>
                                                <option value="Tripura">Tripura</option>
                                                <option value="Uttar Pradesh">Uttar Pradesh</option>
                                                <option value="Uttarakhand">Uttarakhand</option>
                                                <option value="West Bengal">West Bengal</option>
                                                <option value="Other Territory">Other Territory</option>
                                            </select>
                                        </div>

                                        <div class="col-md-3 currency_div mt-3">
                                            <label for="">Currency</label>
                                            <select name="currency" id="currency" class="form-control">
                                                <option value="INR - Indian Rupee">INR - Indian Rupee</option>
                                            </select>
                                        </div>
                
                                        <div class="col-md-3 mt-3">
                                            <label for="">Opening Balance</label>
                                            <div class="d-flex">
                                                <select name="balance_type" id="bal_type" class="form-select text-white mr-1">
                                                    <option value="debit" selected>Debit</option>
                                                    <option value="credit">Credit</option>
                                                </select>
                                                <input type="text" class="form-control" name="open_balance" id="openbalance" step="any">
                                            </div>
                                        </div>
                
                                        <div class="col-md-3 mt-3">
                                            <label for="creditLimit">Credit Limit</label>
                                            <input type="text" class="form-control" name="credit_limit" value="0" step="any" id="creditLimit">
                                        </div>
                
                                        <div class="col-md-3 mt-3">
                                            <label for="paymentTerms">Payment Terms</label>
                                            <div class="d-flex">
                                                <select name="payment_terms" id="paymentTerms" class="form-control">
                                                    <option value="" selected hidden>Choose</option>
                                                    {% for t in terms %}
                                                        <option value="{{ t.id }}">{{ t.term_name }}</option>
                                                    {% endfor %}
                                                </select>
                                                &nbsp;&nbsp;&nbsp;
                                                <a class="btn btn-outline-secondary" id="new_vterm_btn">+</a>
                                            </div>
                                        </div>
                
                                        <div class="col-md-3 mt-3">
                                            <label for="priceList">Price List</label>
                                            <select name="price_list" id="priceList" class="form-control">
                                                <option value="" selected hidden>Choose</option>
                                                {% for p in plist %}
                                                {% if p.type == 'Purchase' %}
                                                    <option value="{{p.id}}">{{p.name}}</option>
                                                {% endif %}
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row mt-5">
                                        <div class="col-md-6">
                                            <div class="row">
                                                <div class="col-md-12 card-title">
                                                    <h5 class="mb-0">Billing Address</h5>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-12 mt-3">
                                                    <div class="form-row">
                                                        <label for="street">Street</label>
                                                        <textarea class="form-control street" id="street" name="street"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="city">City</label>
                                                        <input type="text" class="form-control" id="city" name="city" placeholder="City">
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="state">State</label>
                                                        <select type="text" class="form-control" id="state" name="state">
                                                            <option value="" selected hidden>Choose</option>
                                                            <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                                                            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                            <option value="Assam">Assam</option>
                                                            <option value="Bihar">Bihar</option>
                                                            <option value="Chandigarh">Chandigarh</option>
                                                            <option value="Chhattisgarh">Chhattisgarh</option>
                                                            <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                            <option value="Damn anad Diu">Damn anad Diu</option>
                                                            <option value="Delhi">Delhi</option>
                                                            <option value="Goa">Goa</option>
                                                            <option value="Gujarat">Gujarat</option>
                                                            <option value="Haryana">Haryana</option>
                                                            <option value="Himachal Pradesh">Himachal Pradesh</option>
                                                            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                            <option value="Jharkhand">Jharkhand</option>
                                                            <option value="Karnataka">Karnataka</option>
                                                            <option value="Kerala">Kerala</option>
                                                            <option value="Ladakh">Ladakh</option>
                                                            <option value="Lakshadweep">Lakshadweep</option>
                                                            <option value="Madhya Pradesh">Madhya Pradesh</option>
                                                            <option value="Maharashtra">Maharashtra</option>
                                                            <option value="Manipur">Manipur</option>
                                                            <option value="Meghalaya">Meghalaya</option>
                                                            <option value="Mizoram">Mizoram</option>
                                                            <option value="Nagaland">Nagaland</option>
                                                            <option value="Odisha">Odisha</option>
                                                            <option value="Puducherry">Puducherry</option>
                                                            <option value="Punjab">Punjab</option>
                                                            <option value="Rajasthan">Rajasthan</option>
                                                            <option value="Sikkim">Sikkim</option>
                                                            <option value="Tamil Nadu">Tamil Nadu</option>
                                                            <option value="Telangana">Telangana</option>
                                                            <option value="Tripura">Tripura</option>
                                                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                                                            <option value="Uttarakhand">Uttarakhand</option>
                                                            <option value="West Bengal">West Bengal</option>
                                                            <option value="Other Territory">Other Territory</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="pinco">Pin Code</label>
                                                        <input type="text" class="form-control" id="pinco" name="pincode" placeholder="PIN code">
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="country">Country</label>
                                                        <input type="text" class="form-control" id="country" name="country" placeholder="Country">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="row">
                                                <div class="col-md-12 d-flex">
                                                    <h5>Shipping Address</h5>
                                                    <input class="ml-4 ml-5" type="checkbox" id="shipAddress" name="ship_address">
                                                    <label class="ml-2 mt-1 ml-2" for="shipAddress">Same As Billing Address</label>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-12 mt-3">
                                                    <div class="form-row">
                                                        <label for="shipstreet">Street</label>
                                                        <textarea class="form-control" id="shipstreet" name="shipstreet"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="shipcity">City</label>
                                                        <input type="text" class="form-control" id="shipcity" name="shipcity" placeholder="City">
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="shipstate">State</label>
                                                        <select type="text" class="form-control" id="shipState" name="shipstate">
                                                            <option value="" selected hidden>Choose</option>
                                                            <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                                                            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                            <option value="Assam">Assam</option>
                                                            <option value="Bihar">Bihar</option>
                                                            <option value="Chandigarh">Chandigarh</option>
                                                            <option value="Chhattisgarh">Chhattisgarh</option>
                                                            <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                            <option value="Damn anad Diu">Damn anad Diu</option>
                                                            <option value="Delhi">Delhi</option>
                                                            <option value="Goa">Goa</option>
                                                            <option value="Gujarat">Gujarat</option>
                                                            <option value="Haryana">Haryana</option>
                                                            <option value="Himachal Pradesh">Himachal Pradesh</option>
                                                            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                            <option value="Jharkhand">Jharkhand</option>
                                                            <option value="Karnataka">Karnataka</option>
                                                            <option value="Kerala">Kerala</option>
                                                            <option value="Ladakh">Ladakh</option>
                                                            <option value="Lakshadweep">Lakshadweep</option>
                                                            <option value="Madhya Pradesh">Madhya Pradesh</option>
                                                            <option value="Maharashtra">Maharashtra</option>
                                                            <option value="Manipur">Manipur</option>
                                                            <option value="Meghalaya">Meghalaya</option>
                                                            <option value="Mizoram">Mizoram</option>
                                                            <option value="Nagaland">Nagaland</option>
                                                            <option value="Odisha">Odisha</option>
                                                            <option value="Puducherry">Puducherry</option>
                                                            <option value="Punjab">Punjab</option>
                                                            <option value="Rajasthan">Rajasthan</option>
                                                            <option value="Sikkim">Sikkim</option>
                                                            <option value="Tamil Nadu">Tamil Nadu</option>
                                                            <option value="Telangana">Telangana</option>
                                                            <option value="Tripura">Tripura</option>
                                                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                                                            <option value="Uttarakhand">Uttarakhand</option>
                                                            <option value="West Bengal">West Bengal</option>
                                                            <option value="Other Territory">Other Territory</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="shippinco">Pin Code</label>
                                                        <input type="text" class="form-control" id="shippinco" name="shippincode" placeholder="PIN code">
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="shipcountry">Country</label>
                                                        <input type="text" class="form-control" id="shipcountry" name="shipcountry" placeholder="Country">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="agreeTerms" style="background-color: #43596c;">
                                                <label for="agreeTerms">Agree to Terms and Conditions</label>
                                                <div class="invalid-feedback">You must agree before submitting.</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4"></div>
                                        <div class="col-md-4">
                                            <button class="btn btn-outline-info rounded-pill text-grey w-100 mt-3 mb-3" type="submit" id="vendor_submit">
                                                Submit form
                                            </button>
                                        </div>
                                        <div class="col-md-4"></div>
                                    </div>
                                </form>

                                <form method="post" class="needs-validation" autocomplete="off" id="vterms_form" style="display: none;">
                                    {% csrf_token %}
                                    <div class="row">
                                        <div class="col-md-6 text-left mt-2">
                                            <input type="text" class="new_modal_type_ven" hidden>
                                            <Label style="font-size: medium;">Term Name  </Label>
                                            <input type="text" class="form-control mt-2" name="vterm_name" id="vterm_name" placeholder="NET 60">
                                            <span type="font-medium text-danger" id="ven-vname-error" style="color: red;"></span>
                                        </div>
                                        <div class="col-md-6 text-left mt-2">
                                            <Label style="font-size: medium;">Days  </Label>
                                            <input type="number" class="form-control mt-2" name="vdays" id="vdays" placeholder="60">
                                            <span type="font-medium text-danger" id="ven-vdays-error" style="color: red;"></span>
                                        </div>
                                    </div><br>
                                    <div class="row">
                                        <div class="col-md-4"></div>
                                        <div class="col-md-4 mt-2">
                                            <button class="btn btn-outline-info text-grey mb-3 w-100" type="submit">Save</button>
                                        </div>
                                    </div>
                                </form>  
                            </div>
                        </div>
                    </div>
                </div>  
            </div>       

            <div class="modal fade" id="newcustomer">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content" style="background-color: #213b52;">
                        <div class="modal-header">
                            <h3 class="m-3" id="cust_modal_head">New Customer</h3>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="new_cust_close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <button type="button" class="close" aria-label="Close" id="new_cterm_close" style="display: none;">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="card p-3 m-3">
                                <form method="post" class="needs-validation" autocomplete="off" id="customer_form">
                                    {% csrf_token %}
                                    <div class="row mt-3">
                                        <div class="col-md-3">
                                            <input type="text" class="new_modal_type_cust" value="Customer" hidden>
                                            <label for="ncust_title">Title</label>
                                            <select name="ncust_title" id="ncust_title" class="form-control">
                                                <option value="Mr">Mr</option>
                                                <option value="Mrs">Mrs</option>
                                                <option value="Miss">Miss</option>
                                                <option value="Ms">Ms</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="ncust_fname">First Name</label>
                                            <input type="text" class="form-control" id="ncust_fname" name="ncust_fname">
                                            <span class="font-medium text-danger" id="cust-name-error"></span>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="ncust_lname">Last Name</label>
                                            <input type="text" class="form-control" id="ncust_lname" name="ncust_lname">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="ncust_cmp">Company</label>
                                            <input type="text" class="form-control" id="ncust_cmp" name="ncust_cmp">
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-3">
                                            <label for="ncust_loc">Location</label>
                                            <input type="text" class="form-control" id="ncust_loc" name="ncust_loc">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="ncust_email">Email</label>
                                            <input type="email" class="form-control" id="ncust_email" name="ncust_email" placeholder="finsys@gmail.com">
                                            <span class="font-medium text-danger" id="cust-email-error"></span>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="ncust_website">Website</label>
                                            <input type="text" class="form-control" id="ncust_website" name="ncust_website" placeholder="www.finsys.com">
                                            <span class="font-medium text-danger" id="cust-web-error"></span>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="ncust_mobile">Mobile</label>
                                            <input type="text" class="form-control" id="ncust_mobile" name="ncust_mobile">
                                            <span class="font-medium text-danger" id="cust-mobile-error"></span>
                                        </div>
                                    </div>
                                    <hr>
                                    <h4>Other Options</h4>
                                    <hr>
                                    <div class="row mt-3">
                                        <div class="col-md-3">
                                            <label for="ncust_gst_type">GST Type</label>
                                            <select class="form-control" id="ncust_gst_type" name="ncust_gst_type">
                                                <option selected value="" hidden>Select GST Type</option>
                                                <option value="Registered Business - Regular">Registered Business - Regular <span><i>(Business that is registered under gst)</i></span></option>
                                                <option value="Registered Business - Composition">Registered Business - Composition (Business that is registered under composition scheme in gst)</option>
                                                <option value="Unregistered Business">Unregistered Business (Business that has not been registered under gst)</option>
                                                <option value="Overseas">Overseas (Import/Export of supply outside india)</option>
                                                <option value="Consumer">Consumer</option>
                                                <option value="Special Economic Zone (SEZ)">Special Economic Zone (SEZ) (Business that is located in a special economic zone of india or a SEZ developer)</option>
                                                <option value="Demed Exports">Demed Exports (Supply of woods to an exports oriented unit or againsed advanced authorization or export promotion capital woods)</option>
                                                <option value="Tax Deductor">Tax Deductor (State of central gov,government agencies or local authority)</option>
                                                <option value="SEZ Developer">SEZ Developer (A person or organization who owns atleast 26% equality in creating business units in special economic zone)</option>
                                            </select>
                                        </div>
                
                                        <div class="col-md-3 ncust_gst d-block" id="ncust_gst">
                                            <label for="ncust_gstno">GSTIN</label>
                                            <input type="text" class="form-control" id="ncust_gstno" name="ncust_gstno" placeholder="29APPCK7465F1Z1">
                                            <span class="font-medium text-danger" id="cust-gst-error"></span>
                                        </div>
                
                                        <div class="col-md-3">
                                            <label for="ncust_pan">PAN No.</label>
                                            <input type="text" class="form-control" id="ncust_pan" name="ncust_pan" placeholder="APPCK7465F">
                                            <span class="font-medium text-danger" id="cust-pan-error"></span>
                                        </div>

                                        <div class="col-md-3">
                                            <label for="ncust_psupply">Place of Supply</label>
                                            <select class="custom-select form-control" id="ncust_psupply" name="ncust_psupply">
                                                <option selected value="" hidden>Select Place of Supply</option>
                                                <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                                <option value="Andhra Pradesh">Andhra Pradesh</option>
                                                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                <option value="Assam">Assam</option>
                                                <option value="Bihar">Bihar</option>
                                                <option value="Chandigarh">Chandigarh</option>
                                                <option value="Chhattisgarh">Chhattisgarh</option>
                                                <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                <option value="Damn anad Diu">Damn anad Diu</option>
                                                <option value="Delhi">Delhi</option>
                                                <option value="Goa">Goa</option>
                                                <option value="Gujarat">Gujarat</option>
                                                <option value="Haryana">Haryana</option>
                                                <option value="Himachal Pradesh">Himachal Pradesh</option>
                                                <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                <option value="Jharkhand">Jharkhand</option>
                                                <option value="Karnataka">Karnataka</option>
                                                <option value="Kerala">Kerala</option>
                                                <option value="Ladakh">Ladakh</option>
                                                <option value="Lakshadweep">Lakshadweep</option>
                                                <option value="Madhya Pradesh">Madhya Pradesh</option>
                                                <option value="Maharashtra">Maharashtra</option>
                                                <option value="Manipur">Manipur</option>
                                                <option value="Meghalaya">Meghalaya</option>
                                                <option value="Mizoram">Mizoram</option>
                                                <option value="Nagaland">Nagaland</option>
                                                <option value="Odisha">Odisha</option>
                                                <option value="Puducherry">Puducherry</option>
                                                <option value="Punjab">Punjab</option>
                                                <option value="Rajasthan">Rajasthan</option>
                                                <option value="Sikkim">Sikkim</option>
                                                <option value="Tamil Nadu">Tamil Nadu</option>
                                                <option value="Telangana">Telangana</option>
                                                <option value="Tripura">Tripura</option>
                                                <option value="Uttar Pradesh">Uttar Pradesh</option>
                                                <option value="Uttarakhand">Uttarakhand</option>
                                                <option value="West Bengal">West Bengal</option>
                                                <option value="Other Territory">Other Territory</option>
                                            </select>
                                        </div>

                                        <div class="col-md-3 bal_div mt-3">
                                            <label for="validationCustom05">Opening Balance</label>
                                            <div class="d-flex">
                                                <select name="ncust_bal_type" id="ncust_bal_type" class="form-select text-white mr-1">
                                                    <option value="debit">Debit</option>
                                                    <option value="credit">Credit</option>
                                                </select>
                                                <input type="text" class="form-control" name="ncust_bal" id="ncust_bal" step="any">
                                            </div>
                                        </div>
                
                                        <div class="col-md-3 mt-3">
                                            <label for="ncust_crlimit">Credit Limit</label>
                                            <input type="text" class="form-control" name="ncust_crlimit" step="any" id="ncust_crlimit">
                                        </div>
                
                                        <div class="col-md-3 mt-3">
                                            <label for="ncust_pay_term">Payment Terms</label>
                                            <div class="d-flex">
                                                <select name="ncust_pay_term" id="ncust_pay_term" class="form-control">
                                                    <option value="" selected hidden>Choose</option>
                                                    {% for t in terms %}
                                                        <option value="{{ t.id }}">{{ t.term_name }}</option>
                                                    {% endfor %}
                                                </select>
                                                &nbsp;&nbsp;&nbsp;
                                                <a class="btn btn-outline-secondary" id="new_cterm_btn">+</a>
                                            </div>
                                        </div>
                
                                        <div class="col-md-3 mt-3">
                                            <label for="ncust_pricelist">Price List</label>
                                            <select name="ncust_pricelist" id="ncust_pricelist" class="form-control">
                                                <option value="" selected hidden>Choose</option>
                                                {% for p in plist %}
                                                {% if p.type == 'Sales' %}
                                                    <option value="{{p.id}}">{{p.name}}</option>
                                                {% endif %}
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row mt-5">
                                        <div class="col-md-6">
                                            <div class="row">
                                                <div class="col-md-12 card-title">
                                                    <h5 class="mb-0">Billing Address</h5>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-12 mt-3">
                                                    <div class="form-row">
                                                        <label for="ncust_street">Street</label>
                                                        <textarea class="form-control ncust_street" required id="ncust_street" name="ncust_street"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="ncust_city">City</label>
                                                        <input type="text" class="form-control" id="ncust_city" name="ncust_city" placeholder="City" required>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="ncust_state">State</label>
                                                        <select type="text" class="form-control" id="ncust_state" name="ncust_state" required>
                                                            <option value="" selected hidden>Choose</option>
                                                            <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                                                            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                            <option value="Assam">Assam</option>
                                                            <option value="Bihar">Bihar</option>
                                                            <option value="Chandigarh">Chandigarh</option>
                                                            <option value="Chhattisgarh">Chhattisgarh</option>
                                                            <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                            <option value="Damn anad Diu">Damn anad Diu</option>
                                                            <option value="Delhi">Delhi</option>
                                                            <option value="Goa">Goa</option>
                                                            <option value="Gujarat">Gujarat</option>
                                                            <option value="Haryana">Haryana</option>
                                                            <option value="Himachal Pradesh">Himachal Pradesh</option>
                                                            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                            <option value="Jharkhand">Jharkhand</option>
                                                            <option value="Karnataka">Karnataka</option>
                                                            <option value="Kerala">Kerala</option>
                                                            <option value="Ladakh">Ladakh</option>
                                                            <option value="Lakshadweep">Lakshadweep</option>
                                                            <option value="Madhya Pradesh">Madhya Pradesh</option>
                                                            <option value="Maharashtra">Maharashtra</option>
                                                            <option value="Manipur">Manipur</option>
                                                            <option value="Meghalaya">Meghalaya</option>
                                                            <option value="Mizoram">Mizoram</option>
                                                            <option value="Nagaland">Nagaland</option>
                                                            <option value="Odisha">Odisha</option>
                                                            <option value="Puducherry">Puducherry</option>
                                                            <option value="Punjab">Punjab</option>
                                                            <option value="Rajasthan">Rajasthan</option>
                                                            <option value="Sikkim">Sikkim</option>
                                                            <option value="Tamil Nadu">Tamil Nadu</option>
                                                            <option value="Telangana">Telangana</option>
                                                            <option value="Tripura">Tripura</option>
                                                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                                                            <option value="Uttarakhand">Uttarakhand</option>
                                                            <option value="West Bengal">West Bengal</option>
                                                            <option value="Other Territory">Other Territory</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="ncust_pinco">Pin Code</label>
                                                        <input type="text" class="form-control" required id="ncust_pinco" name="ncust_pinco" placeholder="PIN code">
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="ncust_country">Country</label>
                                                        <input type="text" class="form-control" required id="ncust_country" name="ncust_country" placeholder="Country">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="row">
                                                <div class="col-md-12 d-flex">
                                                    <h5>Shipping Address</h5>
                                                    <input class="ml-4 ml-5" type="checkbox" id="ncust_shipadd" name="ncust_shipadd">
                                                    <label class="ml-2 mt-1 ml-2" for="shipAddress">Same As Billing Address</label>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-12 mt-3">
                                                    <div class="form-row">
                                                        <label for="ncust_shipstreet">Street</label>
                                                        <textarea class="form-control" id="ncust_shipstreet" name="ncust_shipstreet"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="ncust_shipcity">City</label>
                                                        <input type="text" class="form-control" id="ncust_shipcity" name="ncust_shipcity" placeholder="City">
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="ncust_shipstate">State</label>
                                                        <select type="text" class="form-control" id="ncust_shipstate" name="ncust_shipstate">
                                                            <option value="" selected>Choose</option>
                                                            <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                                                            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                            <option value="Assam">Assam</option>
                                                            <option value="Bihar">Bihar</option>
                                                            <option value="Chandigarh">Chandigarh</option>
                                                            <option value="Chhattisgarh">Chhattisgarh</option>
                                                            <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                            <option value="Damn anad Diu">Damn anad Diu</option>
                                                            <option value="Delhi">Delhi</option>
                                                            <option value="Goa">Goa</option>
                                                            <option value="Gujarat">Gujarat</option>
                                                            <option value="Haryana">Haryana</option>
                                                            <option value="Himachal Pradesh">Himachal Pradesh</option>
                                                            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                            <option value="Jharkhand">Jharkhand</option>
                                                            <option value="Karnataka">Karnataka</option>
                                                            <option value="Kerala">Kerala</option>
                                                            <option value="Ladakh">Ladakh</option>
                                                            <option value="Lakshadweep">Lakshadweep</option>
                                                            <option value="Madhya Pradesh">Madhya Pradesh</option>
                                                            <option value="Maharashtra">Maharashtra</option>
                                                            <option value="Manipur">Manipur</option>
                                                            <option value="Meghalaya">Meghalaya</option>
                                                            <option value="Mizoram">Mizoram</option>
                                                            <option value="Nagaland">Nagaland</option>
                                                            <option value="Odisha">Odisha</option>
                                                            <option value="Puducherry">Puducherry</option>
                                                            <option value="Punjab">Punjab</option>
                                                            <option value="Rajasthan">Rajasthan</option>
                                                            <option value="Sikkim">Sikkim</option>
                                                            <option value="Tamil Nadu">Tamil Nadu</option>
                                                            <option value="Telangana">Telangana</option>
                                                            <option value="Tripura">Tripura</option>
                                                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                                                            <option value="Uttarakhand">Uttarakhand</option>
                                                            <option value="West Bengal">West Bengal</option>
                                                            <option value="Other Territory">Other Territory</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="ncust_shippinco">Pin Code</label>
                                                        <input type="text" class="form-control" id="ncust_shippinco" name="ncust_shippinco" placeholder="PIN code">
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mt-3">
                                                    <div class="form-row">
                                                        <label for="ncust_shipcountry">Country</label>
                                                        <input type="text" class="form-control" id="ncust_shipcountry" name="ncust_shipcountry" placeholder="Country">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="" id="ncust_agreeTerms" required>
                                                <label for="agreeTerms">Agree to Terms and Conditions</label>
                                                <div class="invalid-feedback">You must agree before submitting.</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4"></div>
                                        <div class="col-md-4">
                                            <button class="btn btn-outline-info rounded-pill text-grey w-100 mt-3 mb-3" type="submit" id="ncust_submit">
                                                Submit form
                                            </button>
                                        </div>
                                        <div class="col-md-4"></div>
                                    </div>
                                </form>

                                <form method="post" class="needs-validation" autocomplete="off" id="cterms_form" style="display: none;">
                                    {% csrf_token %}
                                    <div class="row">
                                        <div class="col-md-6 text-left mt-2">
                                            <input type="text" class="new_modal_type_cust" hidden>
                                            <Label style="font-size: medium;">Term Name  </Label>
                                            <input type="text" class="form-control mt-2" name="cterm_name" id="cterm_name" placeholder="NET 60">
                                            <span type="font-medium text-danger" id="cust-cname-error" style="color: red;"></span>
                                        </div>
                                        <div class="col-md-6 text-left mt-2">
                                            <Label style="font-size: medium;">Days  </Label>
                                            <input type="number" class="form-control mt-2" name="cdays" id="cdays" placeholder="60">
                                            <span type="font-medium text-danger" id="cust-cdays-error" style="color: red;"></span>
                                        </div>
                                    </div><br>
                                    <div class="row">
                                        <div class="col-md-4"></div>
                                        <div class="col-md-4 mt-2">
                                            <button class="btn btn-outline-info text-grey mb-3 w-100" type="submit">Save</button>
                                        </div>
                                    </div>
                                </form>  
                            </div>
                        </div>
                    </div>
                </div>  
            </div>   
            
            <div class="modal fade" id="newterm">
                <div class="modal-dialog">
                    <div class="modal-content" style="background-color: #213b52;">
                        <div class="modal-header">
                            <h5 class="m-3">New Payment Term</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="term_close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="card p-3 m-3">
                                <form method="post" class="needs-validation" autocomplete="off" id="terms_form">
                                    {% csrf_token %}
                                    <div class="row">
                                        <div class="col-md-6 text-left mt-2">
                                            <Label style="font-size: medium;">Term Name  </Label>
                                            <input type="text" class="form-control mt-2" name="term_name" id="term_name" placeholder="NET 60" required>
                                        </div>
                                        <div class="col-md-6 text-left mt-2">
                                            <Label style="font-size: medium;">Days  </Label>
                                            <input type="number" class="form-control mt-2" name="days" id="days" placeholder="60" required>
                                        </div>
                                    </div><br>
                                    <div class="row">
                                        <div class="col-md-4"></div>
                                        <div class="col-md-4 mt-2">
                                            <button class="btn btn-outline-info text-grey mb-3 w-100" type="submit">Save</button>
                                        </div>
                                    </div>
                                </form>  
                            </div>
                        </div>
                    </div>   
                </div>
            </div>         

            <div class="modal fade" id="newitem">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content" style="background-color: #213b52;">
                        <div class="modal-header">
                            <h3 class="m-3" id="itm_modal_head">New Item</h3>
                            <button type="button" class="close" aria-label="Close" id="new_itm_close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <button type="button" class="close" aria-label="Close" id="new_acc_close" style="display: none;">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <button type="button" class="close" aria-label="Close" id="new_unit_close" style="display: none;">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="card p-3 m-3">
                                <form class="needs-validation" method="post" autocomplete="off" id="item_form">
                                    {% csrf_token %}
                                    <div class="row">
                                        <div class="col-md-12 mx-0">
                                            <div class="row">
                                                <div class="col-md-6 mt-3">
                                                    <input type="text" class="new_modal_type_itm" value="Item" hidden>
                                                    <label for="nitm_name" class="text-white">Name</label>
                                                    <input type="text" id="nitm_name" name="nitm_name" class="form-control" autocomplete="off">
                                                    <span class="font-medium text-danger" id="item-name-error"></span>
                                                </div>
                                                <div class="col-md-6 mt-3">
                                                    <label for="nitm_type" class="text-white">Type</label>
                                                    <select name="nitm_type" class="form-control" id="nitm_type">
                                                        <option selected value="" hidden>Choose...</option>
                                                        <option value="Goods">Goods</option>
                                                        <option value="Services">Services</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mt-3">
                                                    <label for="nitm_unit" class="text-white">Unit</label>
                                                    <div class="d-flex">
                                                        <select class="custom-select" name="nitm_unit" id="nitm_unit">
                                                            <option selected value="" hidden>Choose...</option>
                                                            {% for a in units %}
                                                            <option class="text-uppercase" value="{{a.name}}">{{ a.name }}</option>
                                                            {% endfor %}
                                                        </select>
                                                        &nbsp;&nbsp;&nbsp;
                                                        <a class="btn btn-outline-secondary" id="new_unit_btn">+</a>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mt-3" id="hsnDiv">
                                                    <label for="nitm_hsn" class="text-white">HSN Code</label>
                                                    <input type="number" name="nitm_hsn" class="form-control" placeholder="Enter a valid HSN code" id="nitm_hsn">
                                                    <span class="font-medium text-danger" id="item-hsn-error"></span>
                                                </div>
                                                <div class="col-md-6 mt-3" id="sacDiv" style="display: none;">
                                                    <label for="sacField" style="color: white;">SAC Code</label>
                                                    <input type="number" name="sac" class="form-control" style=" color: white;" placeholder="Enter a valid SAC code" id="sacField" oninput="validateSAC()">
                                                    <!-- <div id="sacError" style="color: red;"></div> -->
                                                    <span class="font-medium text-danger" id="item-sac-error"></span>
                                                </div>
                                            </div>
                                            <div class="row mt-3">
                                                <div class="col-md-3 mt-3 mb-3">
                                                    <label class="text-white">Tax Reference</label>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-check mt-3 mb-3">
                                                        <input class="form-check-input" name="taxref" type="radio" id="inclusive" value="taxable">
                                                        <label class="text-white" for="inclusive">Taxable</label>
                                                    </div>
                                                </div>
                                                <div class="form-check mt-3 mb-3">
                                                    <input class="form-check-input" name="taxref" type="radio" value="non taxable" id="noninclusive">
                                                    <label class="text-white" for="noninclusive">Non Taxable</label>
                                                </div>
                                            </div>
                                            <div class="row"  id="taxableDiv" style="display: none;">
                                                <div class="col-md-6 mt-3">
                                                    <label for="nitm_intra_tax" class="text-white">Intra State Tax Rate</label>
                                                    <select name="nitm_intra_tax" class="form-control" id="nitm_intra_tax" >
                                                        <option value=0>GST 0 (0%)</option>
                                                        <option value=3>GST 3 (3%)</option>
                                                        <option value=5>GST 5 (5%)</option>
                                                        <option value=12>GST 12 (12%)</option>
                                                        <option value=18>GST 18 (18%)</option>
                                                        <option value=28>GST 28 (28%)</option>        
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mt-3">
                                                    <label for="nitm_inter_tax" class="text-white">Inter State Tax Rate</label>
                                                    <select name="nitm_inter_tax" class="form-control" id="nitm_inter_tax" >
                                                        <option value=0>IGST 0 (0%)</option>
                                                        <option value=3>IGST 3 (3%)</option>
                                                        <option value=5>IGST 5 (5%)</option>
                                                        <option value=12>IGST 12 (12%)</option>
                                                        <option value=18>IGST 18 (18%)</option>
                                                        <option value=28>IGST 28 (28%)</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mt-3">
                                                    <label class="text-white">Purchase Price</label>
                                                    <div class="row">
                                                        <div class="col-md-12 d-flex">
                                                            <input type="text" class="form-control col-2 mr-1" value="INR">
                                                            <input type="number" name="nitm_pur_price" class="form-control" id="nitm_pur_price" value="0">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mt-3">
                                                    <label class="text-white">Sales Price</label>
                                                    <div class="row">
                                                        <div class="col-md-12 d-flex">
                                                            <input type="text" class="form-control col-2 mr-1" value="INR">
                                                            <input type="text" name="nitm_sale_price" class="form-control" id="nitm_sale_price" value="0">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mt-3">
                                                    <label for="nitm_pur_acc" class="text-white">Account</label>
                                                    <div class="d-flex">
                                                        <select name="nitm_pur_acc" class="form-control" id="nitm_pur_acc">
                                                            <option value="" selected hidden>Choose...</option>
                                                            {% for a in account %}
                                                            <option value="{{ a.account_name }}">{{ a.account_name }}</option>
                                                            {% endfor %}
                                                        </select>
                                                        &nbsp;&nbsp;&nbsp;
                                                        <a class="btn btn-outline-secondary" id="new_acc_btn">+</a>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mt-3">
                                                    <label for="nitm_sale_acc" class="text-white">Account</label>
                                                    <select name="nitm_sale_acc" class="form-control" id="nitm_sale_acc">
                                                        <option value="" selected hidden>Choose..</option>
                                                        <option value="General Income">General Income</option>
                                                        <option value="Interest Income">Interest Income</option>
                                                        <option value="Late Fee Income">Late Fee Income</option>
                                                        <option value="Discount Income">Discount Income</option>
                                                        <option value="Shipping Charges">Shipping Charges</option>
                                                        <option value="Other Charges">Other Charges</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mt-3">
                                                    <label for="nitm_pur_acc" class="text-white">Description</label>
                                                    <textarea class="form-control" name="nitm_pur_acc" id="nitm_pur_acc"></textarea>  
                                                </div>
                                                <div class="col-md-6 mt-3">
                                                    <label for="nitm_sale_acc" class="text-white">Description</label>
                                                    <textarea class="form-control" name="nitm_sale_acc" id="nitm_sale_acc"></textarea>
                                                </div>
                                            </div>
                                            <div class="row mt-3" >
                                                <div class="col-md-3">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox"  id="track">
                                                        <label class="form-check-label" for="track">Track Inventory</label>
                                                    </div>  
                                                </div>
                                            </div>
                                            <div class="row" id="inventorytrack" style="display: none">
                                                <div class="col-md-6 mt-3">
                                                    <label class="text-white">Inventory Account</label>
                                                    <select name="invacc" class="form-control" id="invacc">
                                                        <option selected value="" hidden>Choose...</option>
                                                        <option value="Inventory Assets">Inventory Assets</option>    
                                                    </select>
                                                </div>
                                                <div class="col-md-3 mt-3">
                                                    <label class="text-white">Stock on hand</label>
                                                    <input type="number" name="nitm_stock" class="form-control" id="nitm_stock" value="0">
                                                </div>
                                                <div class="col-md-3 mt-3">
                                                    <label class="text-white">Stock Rate per Unit</label>
                                                    <input type="number" name="nitm_stock_rate" class="form-control" id="nitm_stock_rate" value="0">
                                                </div>
                                            </div>
                                            <div class="row" >
                                                <div class="col-md-3 mt-3">
                                                    <label class="text-white">Minimum Stock to maintain</label>
                                                    <input type="number" name="nitm_min_stock" class="form-control" id="nitm_min_stock" value="0">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4"></div>
                                        <div class="col-md-4">
                                            <button class="btn btn-outline-info rounded-pill text-grey w-100 mt-3 mb-3" type="submit">
                                                Submit form
                                            </button>
                                        </div>
                                        <div class="col-md-4"></div>
                                    </div>
                                </form>

                                <form class="needs-validation" method="post" autocomplete="off" id="unit_form" style="display: none;">
                                    <div class="row mt-2">
                                        <div class="col-md-2"></div>
                                        <div class="col-md-3">
                                            <input type="text" class="new_modal_type_itm" hidden>
                                            <label class="float-right mt-2" for="name">Unit Name</label>
                                        </div>
                                        <div class="col-md-5">
                                            <input name="name" id="unit_name" class="form-control text-uppercase" >
                                            <span class="font-medium text-danger" id="unit-name-error"></span>
                                        </div>
                                    </div>
                                    <div class="row mt-4">
                                        <div class="col-12 d-flex justify-content-center">
                                            <button class="btn btn-outline-info text-grey" type="submit" id="saveItemUnit">Save</button>
                                        </div>
                                    </div>
                                </form>

                                <form class="needs-validation" method="post" autocomplete="off" id="account_form" style="display: none;">
                                    <div class="row mt-2 mb-2">
                                        <div class="col-md-6">
                                            <div class="row mt-2">
                                                <div class="col-12">
                                                    <input type="text" class="new_modal_type_itm" hidden>
                                                    <label for="acctyp">Account Type</label>
                                                    <input type="text" value="Assets" id="acctype" name="acctype" hidden>
                                                    <select name="account_type" id="Account_type" class="custom-select-md form-control w-100" onchange="AccountTypeChange(this)" required>
                                                        <optgroup label="Expense" style="background-color: rgb(47 81 111);">
                                                            <option value="Expense"> Expense </option>
                                                            <option value="Cost Of Goods Sold"> Cost Of Goods Sold </option>
                                                            <option value="Other Expense"> Other Expense </option>
                                                        </optgroup>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="row mt-2">
                                                <div class="col-12">
                                                    <label for="name">*Name</label>
                                                    <input name="account_name" id="accountName" required class="custom-select-md form-control w-100">
                                                </div>
                                            </div>
                                            <div class="row mt-1" id="subAccountCheck" style="display: none;">
                                                <div class="col-12">
                                                    <div class="form-check">
                                                        <input type="checkbox" name="subAccountCheckBox" class="form-check-input" id="subAccountCheckBox">
                                                        <label class="form-check-label" for="subAccountCheckBox">Make this a sub-account</label>
                                                        <span><i class="fa fa-question-circle" data-toggle="tooltip" data-placement="bottom" title="Select this option if you are creating a sub-account."></i></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-2" id="parentAccountValue" style="display: none;">
                                                <div class="col-12">
                                                    <label for="parentAccount">Parent Account</label>
                                                    <select name="parent_account" id="parentAccount" class="custom-select-md form-control w-100">
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="row mt-2">
                                                <div class="col-12">
                                                    <label for="acc_code">Account Code</label>
                                                    <input type="text" name="account_code" id="account_code" class="form-control">
                                                </div>
                                            </div>
                                            <div class="row mt-2">
                                                <div class="col-12">
                                                    <label>Description</label>
                                                    <textarea class="form-control" rows="3" id="description" name="description" placeholder="Max. 500 Characters"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mt-4"> 
                                            <div id="acnt-desc" class="form-control" name="detype" style="font-size: small;  height: fit-content;">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <div class="row">
                                            <div class="col-md-4"></div>
                                            <div class="col-md-4 d-flex justify-content-center">
                                                <button class="btn btn-outline-info" type="submit" id="saveNewAccount">Save</button>
                                            </div>
                                            <div class="col-md-4"></div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div> 
            </div>   
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js" ></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js" defer></script>

<!-- Making Vendor, Customer and Item Dropdown Searchable -->
<script>
    $('#ven_name').select2({
        placeholder: 'Select Vendor',
    });

    $('#cust_name').select2({
        placeholder: 'Select Customer',
    });

    $('.product').select2({
        placeholder: 'Select Product',
        width: '71%',
    });
</script>

<!-- Vendor Change  -->
<script>
    $('#ven_name').change(function(){
        var vendor = $(this).find("option:selected");
        var email = vendor.data("email");
        var plsupply = vendor.data("plsupply");
        var gsttype = vendor.data("gsttype");
        var gstno = vendor.data("gstno");
        var street = vendor.data("street");
        var state = vendor.data("state");
        var pincode = vendor.data("pincode");
        var country = vendor.data("country");
        $('#ven_email').val(email)
        $('#ven_psupply').val(plsupply)
        $('#ven_gst_type').val(gsttype)
        if(gsttype != "Unregistered Business" && gsttype != 'Overseas' && gsttype != 'Consumer'){
            $('#ven_gst_in_div').show()
            $('#ven_gst_in').val(gstno)
        }else{
            $('#ven_gst_in_div').hide()
            $('#ven_gst_in').val('')
        }
        $('#ven_address').val(`${street}\n${state}\n${pincode}\n${country}`)
        calc()
    });
</script>

<!-- Customer Change -->
<script>
    $('#cust_name').change(function(){
        var customer = $(this).find("option:selected");
        if(customer.val() != 'none'){
            var email = customer.data("email");
            var plsupply = customer.data("plsupply");
            var gsttype = customer.data("gsttype");
            var gstno = customer.data("gstno");
            var street = customer.data("street");
            var state = customer.data("state");
            var pincode = customer.data("pincode");
            var country = customer.data("country");
            $('#cust_email').val(email)
            $('#cust_psupply').val(plsupply)
            $('#cust_gst_type').val(gsttype)
            if(gsttype != "Unregistered Business" && gsttype != 'Overseas' && gsttype != 'Consumer'){
                $('#cust_gst_in_div').show()
                $('#cust_gst_in').val(gstno)
            }else{
                $('#cust_gst_in_div').hide()
                $('#cust_gst_in').val('')
            }
            $('#cust_address').val(`${street}\n${state}\n${pincode}\n${country}`)
            calc()
        }else{
            $('#cust_email').val('')
            $('#cust_psupply').val('')
            $('#cust_gst_type').val('')
            $('#cust_gst_in_div').hide()
            $('#cust_gst_in').val('')
            $('#cust_address').val('')
            calc()
        }
    });
</script>

<!-- Bill Number Validation -->
<script>
    $('#bill_no').change(function(){
        if($('#bill_no').val() == '{{bill_no}}'){
            $('#bill_error').text('')
        }else{
            $.ajax({
                url: "{% url 'Fin_Check_Pbill_No' %}",
                type : 'GET',
                csrfmiddlewaretoken: '{{ csrf_token }}',
                data:{
                    no : $('#bill_no').val(),
                    },
                success: function(response) {
                    if(response.message == 'Valid'){
                        if('{{bill_no}}' == '1000'){
                            $('#bill_error').text('')
                        }else{
                            $('#bill_error').text('Bill Number Is Not Continous !!')
                        }
                    }
                    if(response.message == 'Invalid'){
                        $('#bill_no').val('')
                        $('#bill_error').text('This Bill Number is Not Valid !!')
                    }
                    if(response.message == 'Used'){
                        $('#bill_no').val('')
                        $('#bill_error').text('This Bill Number Already Exists !!')
                    }
                },
            });
        }
    });
</script>

<!-- Bill Date Change -->
<script>
    $(document).on('change','#bill_date', function() {
        term = $('#pay_terms').find("option:selected")
        var days = parseInt(term.data('days'));
        due_date =new Date( document.getElementById("bill_date").value)
        if (!isNaN(due_date.getTime())) {
            due_date.setDate(due_date.getDate() + days);
            const new_date = due_date.toISOString().split("T")[0];
            document.getElementById("due_date").value = new_date;
        } else {
            alert("Please enter a valid date.");
        }
    });
</script>

<!-- Payment Term Change -->
<script>
    $(document).on('change','#pay_terms', function() {
        term = $('#pay_terms').find("option:selected")
        var days = parseInt(term.data('days'));
        due_date =new Date( document.getElementById("bill_date").value)
        if (!isNaN(due_date.getTime())) {
            due_date.setDate(due_date.getDate() + days);
            const new_date = due_date.toISOString().split("T")[0];
            document.getElementById("due_date").value = new_date;
        } else {
            alert("Please enter a valid date.");
        }
    });
</script>

<!-- Payment Type Change -->
<script>
    $('#pay_type').change(function(){
        pay = $('#pay_type').val()
        if(pay == 'Cash'){
            $('#cheque_id').val('')
            $('#cheque_id').prop('required',false)
            $('#cheque_id_div').hide()
            
            $('#upi_id').val('')
            $('#upi_id').prop('required',false)
            $('#upi_id_div').hide()

            $('#bnk_no').val('')
            $('#bank_id_div').hide()
        }else if(pay == 'Cheque'){
            $('#cheque_id').val('')
            $('#cheque_id').prop('required',true)
            $('#cheque_id_div').show()
            
            $('#upi_id').val('')
            $('#upi_id').prop('required',false)
            $('#upi_id_div').hide()

            $('#bnk_no').val('')
            $('#bank_id_div').hide()
        }else if(pay == 'UPI'){
            $('#cheque_id').val('')
            $('#cheque_id').prop('required',false)
            $('#cheque_id_div').hide()
            
            $('#upi_id').val('')
            $('#upi_id').prop('required',true)
            $('#upi_id_div').show()

            $('#bnk_no').val('')
            $('#bank_id_div').hide()
        }else{
            type = $(this).find('option:selected')
            acno = type.data('acno')
            $('#cheque_id').val('')
            $('#cheque_id').prop('required',false)
            $('#cheque_id_div').hide()
            
            $('#upi_id').val('')
            $('#upi_id').prop('required',false)
            $('#upi_id_div').hide()

            $('#bnk_no').val(acno)
            $('#bank_id_div').show()
        }
    });
</script>

<!-- Show or Hide Price List -->
<script>
    $('#price_list_confirm').change( function(){
        if($(this).is(':checked')){
            $('#price_list').show()
            $('#price_list').prop('required',true)
        }else{
            $('#price_list').hide()
            $('#price_list').val('')
            $('#price_list').prop('required',false)
            var tableBody = document.getElementById("items-table-body");
            var rows = tableBody.getElementsByTagName("tr");
            for (var i = 1; i <= rows.length; i++) {
                var item = $(`#product${i}`).find("option:selected");
                var price = item.data("price");
                $(`#price${i}`).val(price)
            }
        }
        calc()
    });
</script>

<!-- Change Price List -->
<script>
    $('#price_list').change(function(){
        var tableBody = document.getElementById("items-table-body");
        var rows = tableBody.getElementsByTagName("tr");
        for (var i = 1; i <= rows.length; i++) {
            if($(`#product${i}`).val() != ''){
                if($('#price_list').val() == 'none'){
                    var item = $(`#product${i}`).find("option:selected");
                    var price = item.data("price");
                    $(`#price${i}`).val(price)
                }else{
                    // Created Closure to Avoid Ajax Changing Value of i as Ajax is Asynchronus (value of i is passed to index during each loop)
                    (function(index) {
                        $.ajax({
                            url: "{% url 'Fin_Price_List_Data' %}",
                            type : 'GET',
                            csrfmiddlewaretoken: '{{ csrf_token }}',
                            data:{
                                plist_id : $('#price_list').val(),
                                itm_id : $(`#product${index}`).val()
                                },
                            success: function(response) {
                                price = response.price
                                $(`#price${index}`).val(price)
                            },
                        });
                    })(i); 
                }
            }
        }
        setTimeout(function() {
            calc();
        }, 1000); 
    });
</script>

<!-- Changing State of Vendor or Customer -->
<script>
    $('#ven_name').change(function(){
        change_state()
    });

    $("#cust_name").change(function(){
        change_state()
    });

    $('#ven_psupply').change(function(){
        change_state()
    });

    $("#cust_psupply").change(function(){
        change_state()
    });

    function change_state(){
        $('.nostate').hide();
        $('.tax').hide()
        var ven_state = $('#ven_psupply').val()
        var cust_state = $('#cust_psupply').val()
        if (ven_state == cust_state) {
            $(".inter_tax").removeClass('d-flex');
            $(".inter_tax").addClass('d-none');
            $(".intra_tax").removeClass('d-none');
            $(".intra_tax").addClass('d-flex');
            $(".inter_tax").val('');
            $('#igst_div').hide()
            $('#cgst_div').show()
            $('#sgst_div').show()
        } else {
            if(ven_state == 'Kerala' && cust_state == ''){
                $(".inter_tax").removeClass('d-flex');
                $(".inter_tax").addClass('d-none');
                $(".intra_tax").removeClass('d-none');
                $(".intra_tax").addClass('d-flex');
                $(".inter_tax").val('');
                $('#igst_div').hide()
                $('#cgst_div').show()
                $('#sgst_div').show()
            }else{
                $(".inter_tax").removeClass('d-none');
                $(".inter_tax").addClass('d-flex');
                $(".intra_tax").removeClass('d-flex');
                $(".intra_tax").addClass('d-none');
                $(".intra_tax").val('');
                $('#igst_div').show()
                $('#cgst_div').hide()
                $('#sgst_div').hide()
            }
        }

        var table = document.getElementById("items-table-body");
        var trows = table.rows.length;
        for (var l = 1; l <= trows; l++){
            intra = document.getElementById('intrataxval'+l).value;
            inter = document.getElementById('intertaxval'+l).value;
            if (ven_state == cust_state){
                document.getElementById('intra_tax'+l).value = intra
            }else{
                if(ven_state == 'Kerala' && cust_state == ''){
                    document.getElementById('intra_tax'+l).value = intra
                }else{
                    document.getElementById('inter_tax'+l).value = inter
                }
            }
        }
        calc()
    }
</script>

<!-- Change Item -->
<script>
    function item_data(id){
        var no = id.split('product')[1]
        var item = $(`#${id}`).find("option:selected");
        var ven_state = $('#ven_psupply').val()
        var cust_state = $('#cust_psupply').val()
        var hsn = item.data("hsn");
        var sac = item.data("sac");
        var item_type = item.data("item_type");
        var stock = item.data("stock");
        var price = item.data("price");
        var intra = item.data("intra");
        var inter = item.data("inter");
        var tableBody = document.getElementById("items-table-body");
        var rows = tableBody.getElementsByTagName("tr");
        for (var i = 1; i <= rows.length; i++) {
            if(i != parseInt(no)){
                if($(`#product${no}`).val() == $(`#product${i}`).val()) {
                    alert('Item already selected once, Please select another !!')
                    $(`#product${no}`).val(" ").trigger("change");
                    return
                }
            }
        }
        if( item_type ==='Goods')
        {
            $(`#hsn${no}`).show();
            $(`#sac${no}`).hide();
            $(`#hsn${no}`).val(hsn);
        }
        else
        {
            $(`#sac${no}`).show();
            $(`#hsn${no}`).hide();
            $(`#sac${no}`).val(sac);
        }
        // $(`#hsn${no}`).val(hsn)
        if($('#price_list').val() == ''){
            $(`#price${no}`).val(price)
        }else{
            $.ajax({
                url: "{% url 'Fin_Price_List_Data' %}",
                type : 'GET',
                csrfmiddlewaretoken: '{{ csrf_token }}',
                data:{
                    plist_id : $('#price_list').val(),
                    itm_id : $(`#${id}`).val()
                },
                success: function(response) {
                    price = response.price
                    $(`#price${no}`).val(price)
                },
            });
        }

        tot_stock = parseInt($(`#qty${no}`).val()) + parseInt(stock)
        $(`#stock${no}`).text(tot_stock)
        $(`#intrataxval${no}`).val(intra)
        $(`#intertaxval${no}`).val(inter)
        console.log(`#nostate${no}`)
        if (ven_state == ''){
            $(`#nostate${no}`).text("Please Select a Vendor")
            $(`#nostate${no}`).show();
        }else{
            $(`#nostate${no}`).hide();
            $(`#tax${no}`).hide()
            if (ven_state == cust_state){
                $(`#inter_tax${no}`).removeClass('d-flex');
                $(`#inter_tax${no}`).addClass('d-none');
                $(`#intra_tax${no}`).removeClass('d-none');
                $(`#intra_tax${no}`).addClass('d-flex');
                $(`#inter_tax${no}`).val('');
                $(`#intra_tax${no}`).val(intra)
            }else{
                if(ven_state == 'Kerala' && cust_state == ''){
                    $(`#inter_tax${no}`).removeClass('d-flex');
                    $(`#inter_tax${no}`).addClass('d-none');
                    $(`#intra_tax${no}`).removeClass('d-none');
                    $(`#intra_tax${no}`).addClass('d-flex');
                    $(`#inter_tax${no}`).val('');
                    $(`#intra_tax${no}`).val(intra)
                }else{
                    $(`#inter_tax${no}`).removeClass('d-none');
                    $(`#inter_tax${no}`).addClass('d-flex');
                    $(`#intra_tax${no}`).removeClass('d-flex');
                    $(`#intra_tax${no}`).addClass('d-none');
                    $(`#intra_tax${no}`).val('');
                    $(`#inter_tax${no}`).val(inter)
                }
            }
        }
        calc()
    }
</script>

<!-- Add and Delete Item Table Row -->
<script>
    $(document).ready(function(){
        $('#add').click(function(){
            var roinc = $("#items-table-body tr").length;
            roinc++
            $('#items-table-body').append(
                `<tr id='addr0${roinc}'>
                    <td class="nnum text-center"></td>
                    <td style="width:21%">
                        <div class="d-flex">
                            <select name='product[]' id="product${roinc}" class="form-control border-secondary product" onchange='item_data(this.id)' required>
                                <option value="" selected hidden>Select Product</option>
                                {% for i in itm %}
                                    <option value="{{ i.id }}" 
                                    data-hsn="{{i.hsn}}"
                                    data-sac="{{ i.sac }}"
                                    data-item_type="{{ i.item_type }}"
                                    data-stock="{{i.current_stock}}" 
                                    data-price="{{i.purchase_price}}"
                                    data-intra="{{i.intra_state_tax}}"
                                    data-inter="{{i.inter_state_tax}}">
                                        {{ i.name }} 
                                    </option>
                                {% endfor %}
                            </select>&nbsp;&nbsp;&nbsp;
                            <a><button type="button" class="btn btn-outline-secondary" data-target="#newitem" data-toggle="modal">+</button></a>
                        </div>
                    </td>

                    <td tyle="width:12%">
                        <input type="text" name='hsn[]' id="hsn${roinc}" class="form-control border-secondary HSNCODE" readonly />
                        <input type="text" name='sac[]' id="sac${roinc}" class="form-control border-secondary SACCODE" readonly style="display:none"/>
                    </td>

                    <td style="width:13%">
                        <br>
                        <input type="number" name='qty[]' value=0 id="qty${roinc}" class="form-control border-secondary qty mb-1" step=0 min=1 onchange="change_quantity(this.id)" title="Value Should Be Greater Than Zero" required/>
                        <span class="qty_text"> Available Quantity <span id="stock${roinc}"></span></span>
                    </td>

                    <td tyle="width:12%">
                        <input type="number" name='price[]' id="price${roinc}" value=0 class="form-control border-secondary price" step="0.00" min="0" readonly/>
                    </td>

                    <td style='width:15%;'>
                        <br>
                        <input type="text" id="intrataxval${roinc}" hidden >
                        <input type="text" id="intertaxval${roinc}" hidden >
                        <input type="text" name='tax[]' id="tax${roinc}" class="form-control border-secondary tax mb-1" placeholder="Tax Rate" readonly/>
                        <select name='intra_tax[]' id="intra_tax${roinc}" class="form-control intra_tax d-none mb-4" onchange="calc()">
                            <option value="" selected hidden>Select GST</option>
                            <option value=28 >28.0% GST</option>
                            <option value=18 >18.0% GST</option>
                            <option value=12 >12.0% GST</option>
                            <option value=5 >05.0% GST</option>
                            <option value=3 >03.0% GST</option>
                            <option value=0 >0.0% GST</option>
                        </select>
                        <select name='inter_tax[]' id="inter_tax${roinc}" class="form-control inter_tax d-none mb-4" onchange="calc()">
                            <option value="" selected hidden>Select IGST</option>
                            <option value=28 >28.0% IGST</option>
                            <option value=18 >18.0% IGST</option>
                            <option value=12 >12.0% IGST</option>
                            <option value=5 >05.0% IGST</option>
                            <option value=3 >03.0% IGST</option>
                            <option value=0 >0.0% IGST</option>
                        </select>
                        <span class="text-danger nostate" style="font-size: small; font-weight: lighter ;" id="nostate${roinc}">&nbsp;</span>
                    </td>  

                    <td tyle="width:10%">
                        <input type="number" name='discount[]' placeholder='Enter Discount' value=0 id="disc${roinc}" class="form-control border-secondary disc" step=0 min=0 onchange="calc()">
                    </td>

                    <td style="width:13%">
                        <input type="number" name='total[]' id="total${roinc}" placeholder=0 class="form-control border-secondary total" value=0 step="any" readonly />
                    </td>

                    <td style="display: none;"><input type="text" step="any" id="taxamount${roinc}" class="form-control border-secondary taxamount" /></td>
                    
                    <td style="width:5%">
                        <button type="button" id="${roinc}" class="btn btn-danger px-2 mx-1 py-1 remove_row fa fa-close"></button>
                    </td>
                </tr>`
            );

            $(`#product${roinc}`).select2({
                placeholder: 'Select Product',
                width: '71%'
            });
            
            var tableBody = document.getElementById("items-table-body");
            var rows = tableBody.getElementsByTagName("tr");
            for (var i = 0; i < rows.length; i++) {
                rows[i].getElementsByTagName("td")[0].textContent = i + 1;
            }

            // Function To Append Newly Created Item Using Modal to Newly Created Item Dropdown In Table When Add Row is Created
            append_new_item_dropdown(roinc)
        });
    });

    function append_new_item_dropdown(row){
        $(`#product${row}`).empty();
        $.ajax({
            url: "{% url 'Fin_Get_All_Items_Add' %}",
            type : 'GET',
            success: function(response) {
                $(`#product${row}`).append('<option value="' + '' + '" selected hidden"> Select Product </option>');
                response.forEach(function(item) {
                    value = item.id
                    name = item.name
                    hsn = item.hsn
                    sac = item.sac
                    item_type = item.item_type
                    cstock = item.cstock
                    price = item.price
                    intra_tax = item.intra_tax
                    inter_tax = item.inter_tax
                    $(`#product${row}`).append('<option value="' + value + '" data-hsn="' + hsn + '" data-sac="' + sac + '" data-item_type="' + item_type + '" data-stock="' + cstock + '" data-price="' + price + '" data-intra="' + intra_tax + '" data-inter="' + inter_tax + '">' + name + '</option>');
                });
            },
        });
    }
    
    $(document).on('click','.remove_row',function(){
        var row_id = $(this).attr("id");
        $('#addr0'+row_id+'').remove();
        var tableBody = document.getElementById("items-table-body");
        var rows = tableBody.getElementsByTagName("tr");
        for (var i = 0; i < rows.length; i++) {
            rows[i].getElementsByTagName("td")[0].textContent = i + 1;
        }
        calc();
    });
</script>

<!-- Change Quantity -->
<script>
    function change_quantity(id){
        var no = id.split('qty')[1]
        var item = $(`#product${no}`).find("option:selected");
        var stock = item.data("stock");
        if(stock){
            $(`#stock${no}`).text(stock + parseInt($(`#qty${no}`).val()))
        }else{
            $(`#stock${no}`).text(0 + parseInt($(`#qty${no}`).val()))
        }
        calc()
    }
</script>

<!-- Calculate total of each row in Item Table and Grand Total-->
<script>
    function calc() {
        $('#items-table-body tr').each(function () {
            var html = $(this).html();
            if (html != '') {
                var qty = parseFloat($(this).find('.qty').val());
                var price = parseFloat($(this).find('.price').val());
                var dis = parseFloat($(this).find('.disc').val());
                var ven_state = $('#ven_psupply').val()
                var cust_state = $('#cust_psupply').val()
                if(ven_state == cust_state){
                    tax = parseFloat($(this).find('.intra_tax').val());
                }else{
                    if(ven_state == 'Kerala' && cust_state == ''){
                        tax = parseFloat($(this).find('.intra_tax').val());
                    }else{
                        tax = parseFloat($(this).find('.inter_tax').val());
                    }
                }
                $(this).find('.total').val((qty * price)-dis);
                $(this).find('.taxamount').val(((qty * price) - dis) * (tax / 100));
                calc_total();
            }
        });
    }

    function calc_total() {
        total = 0;
        taxamount = 0;
        $('.total').each(function () {
            total += parseFloat($(this).val());
        });

        $('.taxamount').each(function () {
            if($(this).val() != ''){
                taxamount += parseFloat($(this).val());
            }
        });

        $('#sub_total').val(total.toFixed(2));

        if($('#igst_div').css('display') === 'none'){
            $('#cgst').val((taxamount/2).toFixed(2))
            $('#sgst').val((taxamount/2).toFixed(2))
        }else{
            $('#igst').val(taxamount.toFixed(2))
        }

        $('#tax_amount').val(taxamount.toFixed(2));

        ship = parseFloat($("#shipcharge").val());
        adj_val = parseFloat($('#adjustment').val())
        gtot = taxamount + total + ship + adj_val;
        $('#grand_total').val(gtot.toFixed(2));

        paid = parseFloat($('#paid').val())
        paid = gtot - paid
        $('#bal_due').val(paid.toFixed(2));
    }
</script>

<!-- Change Shipping Charge, Adjustment and Advance Paid -->
<script>
    $('#shipcharge').change(function(){
        cash_change()
    });

    $('#adjustment').change(function(){
        cash_change()
    });

    $('#paid').change(function(){
        cash_change()
    });

    function cash_change(){
        sub_total = parseFloat($("#sub_total").val());
        taxamount = parseFloat($("#tax_amount").val());
        ship = parseFloat($("#shipcharge").val());
        adj_val = parseFloat($('#adjustment').val())
        gtot = sub_total + taxamount + ship + adj_val;
        $('#grand_total').val(gtot.toFixed(2));
        paid = parseFloat($('#paid').val())
        paid = gtot - paid
        $('#bal_due').val(paid.toFixed(2));
    }
</script>

<!-- New Payment Term or Vendor -->
<script>
    function return_to_vendor_modal(){
        $('#ven_modal_head').text('New Vendor')
        $('.new_modal_type_ven').val('Vendor')
        $('#new_vterm_close').hide()
        $('#new_ven_close').show()
        $('#vterms_form').hide()
        $('#vendor_form').show()
        $('#newvendor').find('.modal-dialog').addClass('modal-xl');
        $('#newvendor').find('.modal-dialog').removeClass('modal-md');

        $('#firstName').prop('required', true);
        $('#lastName').prop('required', true);
        $('#companyName').prop('required', true);
        $('#vendorEmail').prop('required', true);
        $('#vendorMobile').prop('required', true);
        $('#gstType').prop('required', true);
        $('#panNo').prop('required', true);
        $('#placeOfSupply').prop('required', true);
        $('#currency').prop('required', true);
        $('#openbalance').prop('required', true);
        $('#creditLimit').prop('required', true);
        $('#paymentTerms').prop('required', true);
        $('#street').prop('required', true);
        $('#city').prop('required', true);
        $('#state').prop('required', true);
        $('#pinco').prop('required', true);
        $('#country').prop('required', true);
        $('#agreeTerms').prop('required', true);

        $('#vterm_name').prop('required', false);
        $('#vdays').prop('required', false);
    }

    // Add New Payment Term Button is Clicked
    $('#new_vterm_btn').click(function(){
        $('#ven_modal_head').text('New Payment Term')
        $('.new_modal_type_ven').val('Term')
        $('#new_vterm_close').show()
        $('#new_ven_close').hide()
        $('#vterms_form').show()
        $('#vendor_form').hide()
        $('#newvendor').find('.modal-dialog').removeClass('modal-xl');
        $('#newvendor').find('.modal-dialog').addClass('modal-md');

        $('#firstName').prop('required', false);
        $('#lastName').prop('required', false);
        $('#companyName').prop('required', false);
        $('#vendorEmail').prop('required', false);
        $('#vendorMobile').prop('required', false);
        $('#gstType').prop('required', false);
        $('#gstIN').prop('required', false);
        $('#panNo').prop('required', false);
        $('#placeOfSupply').prop('required', false);
        $('#currency').prop('required', false);
        $('#openbalance').prop('required', false);
        $('#creditLimit').prop('required', false);
        $('#paymentTerms').prop('required', false);
        $('#street').prop('required', false);
        $('#city').prop('required', false);
        $('#state').prop('required', false);
        $('#pinco').prop('required', false);
        $('#country').prop('required', false);
        $('#agreeTerms').prop('required', false);

        $('#vterm_name').prop('required', true);
        $('#vdays').prop('required', true);
    });
    
    // Close Add Payment Term
    $('#new_vterm_close').click(function(){
        return_to_vendor_modal()
    });

    // Close New Vendor
    $('#new_ven_close').click(function(){
        $('#vendor_form')[0].reset();
        $('#vterms_form')[0].reset();
        $('#newvendor').modal('hide')
    })
</script>

<!-- New Payment Term From Inside The Vendor -->
<script>
    function validate_vterms(){
        var vterm_name = $('#vterm_name').val();
        var vdays = $('#vdays').val();
        $.ajax({
            type : 'GET',
            url:"{% url 'Fin_Check_New_Term' %}",
            data:{
                'name' : vterm_name,
                'days' : vdays,
            },
            csrfmiddlewaretoken: '{{ csrf_token }}',
            success: function(response) {
                if(response.name_is_exist){
                    $('#vterm_name').val('')
                    $('#ven-vname-error').text(response.message)
                }else{
                    $('#ven-vname-error').text('')
                }
                if(response.days_is_exist){
                    $('#vdays').val('');
                    $('#ven-vdays-error').text(response.message)
                }else{
                    $('#ven-vdays-error').text('')
                }
            },         
        });
    }
    
    $('#vterm_name').change(function(){
        validate_vterms()
    });

    $('#vdays').change(function(){
        validate_vterms()
    });

    $('#newvendor').submit(function(event){
        event.preventDefault();
        if($('.new_modal_type_ven').first().val() == 'Term'){
            $.ajax({
                url: "{% url 'Fin_New_Payment_Term' %}",
                type : 'GET',
                csrfmiddlewaretoken: '{{ csrf_token }}',
                data:{
                    days : $('#vdays').val(),
                    term_name : $('#vterm_name').val(),
                },
                success: function(response) {
                    $('#paymentTerms').append($('<option></option>').text($('#vterm_name').val()).val(response.id));
                    $('#pay_terms').append($('<option></option>').text($('#vterm_name').val()).val(response.id));
                    $('#ncust_pay_term').append($('<option></option>').text($('#vterm_name').val()).val(response.id));
                    $('#vterms_form')[0].reset();
                    return_to_vendor_modal()
                },
            });
        }
    });
</script>

<!-- New Vendor -->
<script>
    // Reset Form When Closed
    $('#ven_close').click(function(){
        $('#vendor_form')[0].reset();
    })

    // Change GST Type
    $("#gstType").change(function() {
        var x=$('#gstType').val();
        if(x == "Unregistered Business" || x == 'Overseas' || x == 'Consumer'){
            $(".gstrow").removeClass('d-block');
            $(".gstrow").addClass('d-none');
            $(".currency_div").removeClass('mt-3');
            $('#gstIN').prop('required',false);
        }else {
            $(".gstrow").removeClass('d-none');
            $(".gstrow").addClass('d-block');
            $(".currency_div").addClass('mt-3');
            $('#gstIN').prop('required',true);
        }
    });

    // Changing Credit or Debit
    $(document).on('change', '#bal_type',function () {
        calc_ven_bal()
    });

    // Changing Opening Balance
    $(document).on('change', '#openbalance',function () {
        calc_ven_bal()
    });

    function calc_ven_bal(){
        openbal = $("#openbalance").val()
        if(openbal != ""){
            if($('#bal_type').val()=='credit'){
                if (parseFloat(openbal) != 0){
                    document.getElementById("openbalance").value = -1*(parseFloat(openbal))
                }else{
                    document.getElementById("openbalance").value = openbal
                }
            }else{
                if (parseFloat(openbal) < 0){
                    document.getElementById("openbalance").value = -1*(parseFloat(openbal))
                }else{
                    document.getElementById("openbalance").value = parseFloat(openbal)
                }
            }
        }
    }

    // Same as Billing address
    $('#shipAddress').change(function() {
        if ($(this).is(':checked')) {
            $('#shipstreet').val($('#street').val());
            $('#shipcity').val($('#city').val());
            $('#shipState').val($('#state').val());
            $('#shippinco').val($('#pinco').val());
            $('#shipcountry').val($('#country').val());
        }else{
            $('#shipstreet').val('');
            $('#shipcity').val('');
            $('#shipState').val('');
            $('#shippinco').val('');
            $('#shipcountry').val('');
        }
    });

    $('#street').change( function() { $('#shipAddress').prop('checked', false); });
    $('#city').change( function() { $('#shipAddress').prop('checked', false); });
    $('#state').change( function() { $('#shipAddress').prop('checked', false); });
    $('#pinco').change( function() { $('#shipAddress').prop('checked', false); });
    $('#country').change( function() { $('#shipAddress').prop('checked', false); });

    $('#shipstreet').change( function() { $('#shipAddress').prop('checked', false); });
    $('#shipcity').change( function() { $('#shipAddress').prop('checked', false); });
    $('#shipState').change( function() { $('#shipAddress').prop('checked', false); });
    $('#shippinco').change( function() { $('#shipAddress').prop('checked', false); });
    $('#shipcountry').change( function() { $('#shipAddress').prop('checked', false); });

    // Name Validation
    $('#firstName').change(function(){
        check_vendor_name()
    });

    $('#lastName').change(function(){
        check_vendor_name()
    });

    function check_vendor_name(){
        fname = $('#firstName').val()
        lname = $('#lastName').val()
        if (fname != "" && lname !=""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_checkVendorName' %}",
                data:{
                    'fname' : fname,
                    'lname' : lname,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    if(response.is_exist){
                        $('#firstName').val('')
                        $('#lastName').val('')
                        $('#ven-name-error').text(response.message)
                        $('#firstName').css('border', '2px solid red'); 
                        $('#lastName').css('border', '2px solid red'); 
                    }else{
                        $('#ven-name-error').text('')
                        $('#firstName').css('border', '2px solid green'); 
                        $('#lastName').css('border', '2px solid green'); 
                    }
                },         
            });
        }
    }

    // Email Validation
    $('#vendorEmail').change(function(){
        var vendorEmail = $('#vendorEmail').val();
        if (vendorEmail != ""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_checkVendorEmail' %}",
                data:{
                    'email' : vendorEmail,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    if(response.is_exist){
                        $('#vendorEmail').val('')
                        $('#ven-email-error').text(response.message)
                        $('#vendorEmail').css('border', '2px solid red'); 
                    }else{
                        var email_string = /[^@\s]+@[^@\s]+\.[^@\s]+/; 
                        if (email_string.test($('#vendorEmail').val())) {
                            $('#ven-email-error').text('')
                            $('#vendorEmail').css('border', '2px solid green'); 
                        } else {
                            $('#vendorEmail').val('')
                            $('#ven-email-error').text('Invalid Email')
                            $('#vendorEmail').css('border', '2px solid red'); 
                        }
                    }
                },         
            });
        }
    });

    // URL Validation
    $('#vendorWebsite').change(function(){
        var web_string = /www\..*/; 
        if (web_string.test($('#vendorWebsite').val())) {
            $('#ven-web-error').text('')
            $('#vendorWebsite').css('border', '2px solid green'); 
        } else {
            $('#vendorWebsite').val('')
            $('#ven-web-error').text('Invalid URL')
            $('#vendorWebsite').css('border', '2px solid red'); 
        }
    });
    
    // Phone Number Validation
    $('#vendorMobile').change(function(){
        var phoneNo = $('#vendorMobile').val();
        if (phoneNo != ""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_checkVendorPhone' %}",
                data:{
                    'phone' : phoneNo,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    if(response.is_exist){
                        $('#vendorMobile').val('')
                        $('#ven-mobile-error').text(response.message)
                        $('#vendorMobile').css('border', '2px solid red'); 
                    }else{
                        var phno_string = /\d{10}/; 
                        if (phno_string.test($('#vendorMobile').val())) {
                            $('#ven-mobile-error').text('')
                            $('#vendorMobile').css('border', '2px solid green'); 
                        } else {
                            $('#vendorMobile').val('')
                            $('#ven-mobile-error').text('Invalid Phone Number')
                            $('#vendorMobile').css('border', '2px solid red'); 
                        }
                    }
                },         
            });
        }
    });

    // GST Number Validation
    $('#gstIN').change(function(){
        var gstNo = $('#gstIN').val();
        if (gstNo != ""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_checkVendorGSTIN' %}",
                data:{
                    'gstin' : gstNo,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    if(response.is_exist){
                        $('#gstIN').val('')
                        $('#ven-gst-error').text(response.message)
                        $('#gstIN').css('border', '2px solid red'); 
                    }else{
                        var gst_string = /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/; 
                        if (gst_string.test($('#gstIN').val())) {
                            $('#ven-gst-error').text('')
                            $('#gstIN').css('border', '2px solid green'); 
                        } else {
                            $('#gstIN').val('')
                            $('#ven-gst-error').text('Invalid GST Number')
                            $('#gstIN').css('border', '2px solid red'); 
                        }
                    }
                },         
            });
        }
    });

    // Pan Number Validation
    $('#panNo').change(function(){
        var panNo = $('#panNo').val();
        if (panNo != ""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_checkVendorPAN' %}",
                data:{
                    'pan' : panNo,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    if(response.is_exist){
                        $('#panNo').val('')
                        $('#ven-pan-error').text(response.message)
                        $('#panNo').css('border', '2px solid red'); 
                    }else{
                        var pan_string = /[A-Z]{5}[0-9]{4}[A-Z]{1}/; 
                        if (pan_string.test($('#panNo').val())) {
                            $('#ven-pan-error').text('')
                            $('#panNo').css('border', '2px solid green'); 
                        } else {
                            $('#panNo').val('')
                            $('#ven-pan-error').text('Invalid PAN Number')
                            $('#panNo').css('border', '2px solid red'); 
                        }
                    }
                },         
            });
        }
    });

    // Create New Vendor
    $('#newvendor').submit(function(event){
        event.preventDefault();
        if($('.new_modal_type_ven').first().val() == 'Vendor'){
            $.ajax({
                url: "{% url 'Fin_New_Vendor' %}",
                type: "GET",
                data: {
                    title: $('#title').val(),
                    fname: $('#firstName').val(),
                    lname: $('#lastName').val(),
                    cname: $('#companyName').val(),
                    loc: $('#location').val(),
                    email: $('#vendorEmail').val(),
                    site: $('#vendorWebsite').val(),
                    phone: $('#vendorMobile').val(),
                    gst_type: $('#gstType').val(),
                    gst_in: $('#gstIN').val(),
                    pan: $('#panNo').val(),
                    psupply: $('#placeOfSupply').val(),
                    currency: $('#currency').val(),
                    bal_type: $('#bal_type').val(),
                    bal: $('#openbalance').val(),
                    limit: $('#creditLimit').val(),
                    terms: $('#paymentTerms').val(),
                    plist: $('#priceList').val(),
                    street: $('#street').val(),
                    city: $('#city').val(),
                    state: $('#state').val(),
                    pinco: $('#pinco').val(),
                    country: $('#country').val(),
                    shipstreet: $('#shipstreet').val(),
                    shipcity: $('#shipcity').val(),
                    shipstate: $('#shipState').val(),
                    shippinco: $('#shippinco').val(),
                    shipcountry: $('#shipcountry').val(),
                },
                csrfmiddlewaretoken: '{{ csrf_token }}',
                success: function(response) {
                    var $select = $('#ven_name');
                    var $option = $('<option>', { 
                        text: `${$('#firstName').val()} ${$('#lastName').val()}`, 
                        value: response.id 
                    });
                    $option.attr('data-email', $('#vendorEmail').val());
                    $option.attr('data-plsupply', $('#placeOfSupply').val());
                    $option.attr('data-gsttype', $('#gstType').val());
                    $option.attr('data-gstno', $('#gstIN').val());
                    $option.attr('data-street', $('#street').val());
                    $option.attr('data-city', $('#city').val());
                    $option.attr('data-state', $('#state').val());
                    $option.attr('data-pincode', $('#pinco').val());
                    $option.attr('data-country', $('#country').val());
                    $select.append($option).trigger('change');
                    $('#vendor_form')[0].reset();
                    $('#newvendor').modal('hide');
                },
            });
        }
    });
</script>

<!-- New Payment Term or Customer -->
<script>
    function return_to_customer_modal(){
        $('#cust_modal_head').text('New Customer')
        $('.new_modal_type_cust').val('Customer')
        $('#new_cterm_close').hide()
        $('#new_cust_close').show()
        $('#cterms_form').hide()
        $('#customer_form').show()
        $('#newcustomer').find('.modal-dialog').addClass('modal-xl');
        $('#newcustomer').find('.modal-dialog').removeClass('modal-md');

        $('#ncust_fname').prop('required', true);
        $('#ncust_lname').prop('required', true);
        $('#ncust_cmp').prop('required', true);
        $('#ncust_email').prop('required', true);
        $('#ncust_mobile').prop('required', true);
        $('#ncust_gst_type').prop('required', true);
        $('#ncust_pan').prop('required', true);
        $('#ncust_psupply').prop('required', true);
        $('#ncust_bal').prop('required', true);
        $('#ncust_crlimit').prop('required', true);
        $('#ncust_pay_term').prop('required', true);
        $('#ncust_street').prop('required', true);
        $('#ncust_city').prop('required', true);
        $('#ncust_state').prop('required', true);
        $('#ncust_pinco').prop('required', true);
        $('#ncust_country').prop('required', true);
        $('#ncust_agreeTerms').prop('required', true);

        $('#cterm_name').prop('required', false);
        $('#cdays').prop('required', false);
    }

    // Add New Payment Term Button is Clicked
    $('#new_cterm_btn').click(function(){
        $('#cust_modal_head').text('New Payment Term')
        $('.new_modal_type_cust').val('Term')
        $('#new_cterm_close').show()
        $('#new_cust_close').hide()
        $('#cterms_form').show()
        $('#customer_form').hide()
        $('#newcustomer').find('.modal-dialog').removeClass('modal-xl');
        $('#newcustomer').find('.modal-dialog').addClass('modal-md');

        $('#ncust_fname').prop('required', false);
        $('#ncust_lname').prop('required', false);
        $('#ncust_cmp').prop('required', false);
        $('#ncust_email').prop('required', false);
        $('#ncust_mobile').prop('required', false);
        $('#ncust_gst_type').prop('required', false);
        $('#ncust_gstno').prop('required', false);
        $('#ncust_pan').prop('required', false);
        $('#ncust_psupply').prop('required', false);
        $('#ncust_bal').prop('required', false);
        $('#ncust_crlimit').prop('required', false);
        $('#ncust_pay_term').prop('required', false);
        $('#ncust_street').prop('required', false);
        $('#ncust_city').prop('required', false);
        $('#ncust_state').prop('required', false);
        $('#ncust_pinco').prop('required', false);
        $('#ncust_country').prop('required', false);
        $('#ncust_agreeTerms').prop('required', false);

        $('#cterm_name').prop('required', true);
        $('#cdays').prop('required', true);
    });
    
    // Close Add Payment Term
    $('#new_cterm_close').click(function(){
        return_to_customer_modal()
    });

    // Close New Vendor
    $('#new_cust_close').click(function(){
        $('#customer_form')[0].reset();
        $('#cterms_form')[0].reset();
        $('#newcustomer').modal('hide')
    })
</script>

<!-- New Payment Term From Inside The Customer -->
<script>
    function validate_cterms(){
        var cterm_name = $('#cterm_name').val();
        var cdays = $('#cdays').val();
        $.ajax({
            type : 'GET',
            url:"{% url 'Fin_Check_New_Term' %}",
            data:{
                'name' : cterm_name,
                'days' : cdays,
            },
            csrfmiddlewaretoken: '{{ csrf_token }}',
            success: function(response) {
                if(response.name_is_exist){
                    $('#cterm_name').val('')
                    $('#cust-cname-error').text(response.message)
                }else{
                    $('#cust-cname-error').text('')
                }
                if(response.days_is_exist){
                    $('#cdays').val('');
                    $('#cust-cdays-error').text(response.message)
                }else{
                    $('#cust-cdays-error').text('')
                }
            },         
        });
    }
    
    $('#cterm_name').change(function(){
        validate_cterms()
    });

    $('#cdays').change(function(){
        validate_cterms()
    });

    $('#newcustomer').submit(function(event){
        event.preventDefault();
        if($('.new_modal_type_cust').first().val() == 'Term'){
            $.ajax({
                url: "{% url 'Fin_New_Payment_Term' %}",
                type : 'GET',
                csrfmiddlewaretoken: '{{ csrf_token }}',
                data:{
                    days : $('#cdays').val(),
                    term_name : $('#cterm_name').val(),
                },
                success: function(response) {
                    $('#paymentTerms').append($('<option></option>').text($('#cterm_name').val()).val(response.id));
                    $('#pay_terms').append($('<option></option>').text($('#cterm_name').val()).val(response.id));
                    $('#ncust_pay_term').append($('<option></option>').text($('#cterm_name').val()).val(response.id));
                    $('#cterms_form')[0].reset();
                    return_to_customer_modal()
                },
            });
        }
    });
</script>

<!-- New Customer -->
<script>
    // Reset Form when Closed
    $('#cust_close').click(function(){
        $('#customer_form')[0].reset();
    })

    // Changing GST Type
    $("#ncust_gst_type").change(function() {
        var x = $('#ncust_gst_type').val();
        if(x == "Unregistered Business" || x == 'Overseas' || x == 'Consumer'){
            $(".ncust_gst").removeClass('d-block');
            $(".ncust_gst").addClass('d-none');
            $(".bal_div").removeClass('mt-3');
            $('#ncust_gstno').prop('required',false);
        }else {
            $(".ncust_gst").removeClass('d-none');
            $(".ncust_gst").addClass('d-block');
            $(".bal_div").addClass('mt-3');
            $('#ncust_gstno').prop('required',true);
        }
    });

    // Changing Credit or Debit
    $(document).on('change', '#ncust_bal_type',function () {
        calc_cust_bal()
    });

    // Changing Opening Balance
    $(document).on('change', '#ncust_bal',function () {
        calc_cust_bal()
    });

    function calc_cust_bal(){
        openbal = $("#ncust_bal").val()
        if(openbal != ""){
            if($('#ncust_bal_type').val()=='credit'){
                if (parseFloat(openbal) != 0){
                    document.getElementById("ncust_bal").value = -1*(parseFloat(openbal))
                }else{
                    document.getElementById("ncust_bal").value = openbal
                }
            }else{
                if (parseFloat(openbal) < 0){
                    document.getElementById("ncust_bal").value = -1*(parseFloat(openbal))
                }else{
                    document.getElementById("ncust_bal").value = parseFloat(openbal)
                }
            }
        }
    }

    // Same as Billing address
    $('#ncust_shipadd').change(function() {
        if ($(this).is(':checked')) {
            $('#ncust_shipstreet').val($('#ncust_street').val());
            $('#ncust_shipcity').val($('#ncust_city').val());
            $('#ncust_shipstate').val($('#ncust_state').val());
            $('#ncust_shippinco').val($('#ncust_pinco').val());
            $('#ncust_shipcountry').val($('#ncust_country').val());
        }else{
            $('#ncust_shipstreet').val('');
            $('#ncust_shipcity').val('');
            $('#ncust_shipstate').val('');
            $('#ncust_shippinco').val('');
            $('#ncust_shipcountry').val('');
        }
    });

    $('#ncust_street').change( function() { $('#ncust_shipadd').prop('checked', false); });
    $('#ncust_city').change( function() { $('#ncust_shipadd').prop('checked', false); });
    $('#ncust_state').change( function() { $('#ncust_shipadd').prop('checked', false); });
    $('#ncust_pinco').change( function() { $('#ncust_shipadd').prop('checked', false); });
    $('#ncust_country').change( function() { $('#ncust_shipadd').prop('checked', false); });

    $('#ncust_shipstreet').change( function() { $('#ncust_shipadd').prop('checked', false); });
    $('#ncust_shipcity').change( function() { $('#ncust_shipadd').prop('checked', false); });
    $('#ncust_shipstate').change( function() { $('#ncust_shipadd').prop('checked', false); });
    $('#ncust_shippinco').change( function() { $('#ncust_shipadd').prop('checked', false); });
    $('#ncust_shipcountry').change( function() { $('#ncust_shipadd').prop('checked', false); });

    // Name Validation
    $('#ncust_fname').change(function(){
        check_cust_name()
    });

    $('#ncust_lname').change(function(){
        check_cust_name()
    });

    function check_cust_name(){
        fname = $('#ncust_fname').val()
        lname = $('#ncust_lname').val()
        if (fname != "" && lname !=""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_checkCustomerName' %}",
                data:{
                    'fname' : fname,
                    'lname' : lname,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    if(response.is_exist){
                        $('#ncust_fname').val('')
                        $('#ncust_lname').val('')
                        $('#cust-name-error').text(response.message)
                        $('#ncust_fname').css('border', '2px solid red'); 
                        $('#ncust_lname').css('border', '2px solid red'); 
                    }else{
                        $('#cust-name-error').text('')
                        $('#ncust_fname').css('border', '2px solid green'); 
                        $('#ncust_lname').css('border', '2px solid green'); 
                    }
                },         
            });
        }
    }

    // Email Validation
    $('#ncust_email').change(function(){
        var custemail = $('#ncust_email').val();
        if (custemail != ""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_checkCustomerEmail' %}",
                data:{
                    'email' : custemail,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    if(response.is_exist){
                        $('#cust-email-error').text(response.message)
                    }else{
                        $('#cust-email-error').text('')
                    }
                    if(response.is_exist){
                        $('#ncust_email').val('')
                        $('#cust-email-error').text(response.message)
                        $('#ncust_email').css('border', '2px solid red'); 
                    }else{
                        var mail_string = /[^@\s]+@[^@\s]+\.[^@\s]+/; 
                        if (mail_string.test($('#ncust_email').val())) {
                            $('#cust-email-error').text('')
                            $('#ncust_email').css('border', '2px solid green'); 
                        } else {
                            $('#ncust_email').val('')
                            $('#cust-email-error').text('Invalid Email')
                            $('#ncust_email').css('border', '2px solid red'); 
                        }
                    }
                },         
            });
        }
    });
    
    // URL Validation
    $('#ncust_website').change(function(){
        var web_string = /www\..*/; 
        if (web_string.test($('#ncust_website').val())) {
            $('#cust-web-error').text('')
            $('#ncust_website').css('border', '2px solid green'); 
        } else {
            $('#ncust_website').val('')
            $('#cust-web-error').text('Invalid URL')
            $('#ncust_website').css('border', '2px solid red'); 
        }
    });

    // Phone Number Validation
    $('#ncust_mobile').change(function(){
        var phoneNo = $('#ncust_mobile').val();
        if (phoneNo != ""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_checkCustomerPhone' %}",
                data:{
                    'phone' : phoneNo,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    if(response.is_exist){
                        $('#ncust_mobile').val('')
                        $('#cust-mobile-erro').text(response.message)
                        $('#ncust_mobile').css('border', '2px solid red'); 
                    }else{
                        var phno_string = /\d{10}/; 
                        if (phno_string.test($('#ncust_mobile').val())) {
                            $('#cust-mobile-erro').text('')
                            $('#ncust_mobile').css('border', '2px solid green'); 
                        } else {
                            $('#ncust_mobile').val('')
                            $('#cust-mobile-erro').text('Invalid Phone Number')
                            $('#ncust_mobile').css('border', '2px solid red'); 
                        }
                    }
                },         
            });
        }
    });

    // GST Number Validation
    $('#ncust_gstno').change(function(){
        var gstNo = $('#ncust_gstno').val();
        if (gstNo != ""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_checkCustomerGSTIN' %}",
                data:{
                    'gstin' : gstNo,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    if(response.is_exist){
                        $('#ncust_gstno').val('')
                        $('#cust-gst-error').text(response.message)
                        $('#ncust_gstno').css('border', '2px solid red'); 
                    }else{
                        var gst_string = /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/; 
                        if (gst_string.test($('#ncust_gstno').val())) {
                            $('#cust-gst-error').text('')
                            $('#ncust_gstno').css('border', '2px solid green'); 
                        } else {
                            $('#ncust_gstno').val('')
                            $('#cust-gst-error').text('Invalid GST Number')
                            $('#ncust_gstno').css('border', '2px solid red'); 
                        }
                    }
                },         
            });
        }
    });

    // Pan Number Validation
    $('#ncust_pan').change(function(){
        var panNo = $('#ncust_pan').val();
        if (panNo != ""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_checkCustomerPAN' %}",
                data:{
                    'pan' : panNo,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    if(response.is_exist){
                        $('#ncust_pan').val('')
                        $('#cust-pan-error').text(response.message)
                        $('#ncust_pan').css('border', '2px solid red'); 
                    }else{
                        var pan_string = /[A-Z]{5}[0-9]{4}[A-Z]{1}/; 
                        if (pan_string.test($('#ncust_pan').val())) {
                            $('#cust-pan-error').text('')
                            $('#ncust_pan').css('border', '2px solid green'); 
                        } else {
                            $('#ncust_pan').val('')
                            $('#cust-pan-error').text('Invalid PAN Number')
                            $('#ncust_pan').css('border', '2px solid red'); 
                        }
                    }
                },         
            });
        }
    });

    // Create New Customer
    $('#newcustomer').submit(function(event){
        event.preventDefault();
        if($('.new_modal_type_cust').first().val() == 'Customer'){
            $.ajax({
                url: "{% url 'Fin_New_Customer' %}",
                type: "GET",
                data: {
                    title: $('#ncust_title').val(),
                    fname: $('#ncust_fname').val(),
                    lname: $('#ncust_lname').val(),
                    cname: $('#ncust_cmp').val(),
                    loc: $('#ncust_loc').val(),
                    email: $('#ncust_email').val(),
                    site: $('#ncust_website').val(),
                    phone: $('#ncust_mobile').val(),
                    gst_type: $('#ncust_gst_type').val(),
                    gst_in: $('#ncust_gstno').val(),
                    pan: $('#ncust_pan').val(),
                    psupply: $('#ncust_psupply').val(),
                    bal_type: $('#ncust_bal_type').val(),
                    bal: $('#ncust_bal').val(),
                    limit: $('#ncust_crlimit').val(),
                    terms: $('#ncust_pay_term').val(),
                    plist: $('#ncust_pricelist').val(),
                    street: $('#ncust_street').val(), 
                    city: $('#ncust_city').val(),
                    state: $('#ncust_state').val(),
                    pinco: $('#ncust_pinco').val(),
                    country: $('#ncust_country').val(),
                    shipstreet: $('#ncust_shipstreet').val(),
                    shipcity: $('#ncust_shipcity').val(),
                    shipstate: $('#ncust_shipstate').val(),
                    shippinco: $('#ncust_shippinco').val(),
                    shipcountry: $('#ncust_shipcountry').val(),
                },
                csrfmiddlewaretoken: '{{ csrf_token }}',
                success: function(response) {
                    var $select = $('#cust_name');
                    var $option = $('<option>', { 
                        text: `${$('#ncust_fname').val()} ${$('#ncust_lname').val()}`, 
                        value: response.id 
                    });
                    $option.attr('data-email', $('#ncust_email').val());
                    $option.attr('data-plsupply', $('#ncust_psupply').val());
                    $option.attr('data-gsttype', $('#ncust_gst_type').val());
                    $option.attr('data-gstno', $('#ncust_gstno').val());
                    $option.attr('data-street', $('#ncust_street').val());
                    $option.attr('data-city', $('#ncust_city').val());
                    $option.attr('data-state', $('#ncust_state').val());
                    $option.attr('data-pincode', $('#ncust_pinco').val());
                    $option.attr('data-country', $('#ncust_country').val());
                    $select.append($option).trigger('change');
                    $('#customer_form')[0].reset();
                    $('#newcustomer').modal('hide');
                },
            });
        }
    });
</script>

<!-- New Payment Terms -->
<script>
    // Close Payment Term Modal
    $('#term_close').click(function(){
        $('#terms_form')[0].reset();
    });

    // New Payment Terms
    $('#newterm').submit(function(event){
        event.preventDefault();
        $.ajax({
            url: "{% url 'Fin_New_Payment_Term' %}",
            type : 'GET',
            csrfmiddlewaretoken: '{{ csrf_token }}',
            data:{
                days : $('#days').val(),
                term_name : $('#term_name').val(),
            },
            success: function(response) {
                $('#paymentTerms').append($('<option></option>').text($('#term_name').val()).val(response.id));
                $('#pay_terms').append($('<option></option>').text($('#term_name').val()).val(response.id));
                $('#ncust_pay_term').append($('<option></option>').text($('#term_name').val()).val(response.id));
                $('#terms_form')[0].reset();
                $('#newterm').modal('hide');
            },
        });
    });
</script>   

<!-- New Unit or Account Inside Item -->
<script>
    function return_to_item_modal(){
        $('#itm_modal_head').text('New Item')
        $('.new_modal_type_itm').val('Item')
        $('#new_unit_close').hide()
        $('#new_acc_close').hide()
        $('#new_itm_close').show()
        $('#unit_form').hide()
        $('#account_form').hide()
        $('#item_form').show()
        $('#newitem').find('.modal-dialog').removeClass('modal-md');
        $('#newitem').find('.modal-dialog').addClass('modal-xl');

        $('#unit_name').prop('required', false);

        $('#Account_type').prop('required', false);
        $('#accountName').prop('required', false);

        $('#nitm_name').prop('required', true);
        $('#nitm_type').prop('required', true);
        $('#nitm_unit').prop('required', true);
        $('#nitm_hsn').prop('required', true);
        $('#inclusive').prop('required', true);

        $('#unit_form')[0].reset();
        $('#account_form')[0].reset();
    }

    // Add New Unit Button is Clicked
    $('#new_unit_btn').click(function(){
        $('#itm_modal_head').text('New Unit')
        $('.new_modal_type_itm').val('Unit')
        $('#new_unit_close').show()
        $('#new_acc_close').hide()
        $('#new_itm_close').hide()
        $('#unit_form').show()
        $('#account_form').hide()
        $('#item_form').hide()
        $('#newitem').find('.modal-dialog').removeClass('modal-xl');
        $('#newitem').find('.modal-dialog').addClass('modal-md');

        $('#unit_name').prop('required', true);

        $('#Account_type').prop('required', false);
        $('#accountName').prop('required', false);

        $('#nitm_name').prop('required', false);
        $('#nitm_type').prop('required', false);
        $('#nitm_unit').prop('required', false);
        $('#nitm_hsn').prop('required', false);
        $('#inclusive').prop('required', false);
    });
    
    // Close Add Unit 
    $('#new_unit_close').click(function(){
        return_to_item_modal()
    });

    // Add New Account Button is Clicked
    $('#new_acc_btn').click(function(){
        $('#itm_modal_head').text('New Account')
        $('.new_modal_type_itm').val('Account')
        $('#new_unit_close').hide()
        $('#new_acc_close').show()
        $('#new_itm_close').hide()
        $('#unit_form').hide()
        $('#account_form').show()
        $('#item_form').hide()

        $('#unit_name').prop('required', false);

        $('#Account_type').prop('required', true);
        $('#accountName').prop('required', true);

        $('#nitm_name').prop('required', false);
        $('#nitm_type').prop('required', false);
        $('#nitm_unit').prop('required', false);
        $('#nitm_hsn').prop('required', false);
        $('#inclusive').prop('required', false);
    });

    // Close Add Account
    $('#new_acc_close').click(function(){
        return_to_item_modal()
    });

    // Close New Item 
    $('#new_itm_close').click(function(){
        $('#item_form')[0].reset();
        $('#unit_form')[0].reset();
        $('#account_form')[0].reset();
        $('#newitem').modal('hide')
    })
</script>

<!-- New Unit -->
<script>
    $('#unit_name').change(function(){
        var unit_name = $('#unit_name').val();
        if (unit_name != ""){
            $.ajax({
                type : 'GET',
                url:"{% url 'Fin_Check_New_Unit' %}",
                data:{
                    'unit_name' : unit_name,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    if(response.is_exist){
                        $('#unit_name').val('')
                        $('#unit-name-error').text(response.message)
                    }else{
                        $('#unit-name-error').text('')
                    }
                },         
            });
        }
    });

    $('#newitem').submit(function(event){
        event.preventDefault();
        if($('.new_modal_type_itm').first().val() == 'Unit'){
            var unit_name = $('#unit_name').val();
            $.ajax({
                url: "{% url 'Fin_New_Unit' %}",
                type : 'GET',
                csrfmiddlewaretoken: '{{ csrf_token }}',
                data:{
                    unit_name : unit_name,
                },
                success: function(response) {
                    if(response.message == 'Success'){
                        var new_option = $(`<option class="text-uppercase" value="${unit_name}">${unit_name}</option>`);
                        $('#nitm_unit').append(new_option)
                    }
                    $('#unit_form')[0].reset();
                    return_to_item_modal()
                },
            });
        }
    });
</script>

<!-- New Account -->
<script>
    $('#subAccountCheckBox').change(function(){
        if($("#subAccountCheckBox").prop('checked')){
            $('#parentAccount').prop('required', true);
        }else{
            $('#parentAccount').prop('required', false);
        }
    });

    $(document).ready(function(){
        var Acnt_desc = document.getElementById("acnt-desc");
        Acnt_desc.innerHTML=`
            <b>Expense</b> <br>Reflects expenses incurred for running normal business operations, such as :<br/>
            <ul>
                <li>1.Advertisements and Marketing</li>
                <li>2.Business Travel Expenses</li>
                <li>3.License Fees</li>
                <li>4.Utility Expenses</li>
            </ul>`;

            var selectedValue = $('#Account_type').val();
            $.ajax({
                type : 'GET',
                url:"/Fin_check_accounts",
                data:{
                    type : selectedValue,
                },
                
                success: function(response) {
                    if(response.status){
                        $('#subAccountCheck').css('display','block');
                        var dropdown = $('#parentAccount');
                        dropdown.empty();
                        dropdown.append(`<option selected hidden value="">--Choose--</option>`)
                        $.each(response, function(key, value) {
                            for(let i=0; i<value.length; i++){
                                dropdown.append($('<option></option>').text(value[i].name).val(value[i].name))
                            }
                        });
                    }else{
                        
                    }
                },         
            });
    })

    function AccountTypeChange(selectBox) {
        var selectElement = document.getElementById("Account_type");
        var selectedValue = selectElement.value;
        var Acnt_desc = document.getElementById("acnt-desc");
        var acctype = document.getElementById("acctype");

        switch(selectedValue) {
            case "Expense":
                Acnt_desc.innerHTML=`
                    <b>Expense</b> <br>Reflects expenses incurred for running normal business operations, such as :<br/>
                    <ul>
                        <li>1.Advertisements and Marketing</li>
                        <li>2.Business Travel Expenses</li>
                        <li>3.License Fees</li>
                        <li>4.Utility Expenses</li>
                    </ul>`;
                    acctype.value="Expense"
                break;
            case "Cost Of Goods Sold":
                Acnt_desc.innerHTML=`
                    <b>Expense</b> <br>This indicates the direct costs attributable to the production of the goods sold by a company such as:<br/>
                    <ul>
                        <li>1.Material and Labor costs</li>
                        <li>2.Cost of obtaining raw materials</li>
                    </ul>`;
                    acctype.value="Expense"
                break;
            case "Other Expense":
                Acnt_desc.innerHTML=`
                    <b>Expense</b> <br>Track miscellaneous expenses incurred for activities other than primary business operations or create additional accounts to track default expenses like insurance or contribution towards charity.<br/>`;
                    acctype.value="Expense"
                break;
            default:
            Acnt_desc.innerHTML=`<b>Account Type</b> <br>Select an account type..<br/>`;
        }

        if(selectedValue !=""){
            $('#subAccountCheck').css('display','none')
            $('#subAccountCheckBox').prop('checked', $('#subAccountCheckBox').prop('checked') ? false : false);
            $('#parentAccountValue').css('display','none');

            $.ajax({
                type : 'GET',
                url:"/Fin_check_accounts",
                data:{
                    type : selectedValue,
                },
                
                success: function(response) {
                    if(response.status){
                        $('#subAccountCheck').css('display','block');
                        var dropdown = $('#parentAccount');
                        dropdown.empty();
                        dropdown.append(`<option selected hidden value="">--Choose--</option>`)
                        $.each(response, function(key, value) {
                            for(let i=0; i<value.length; i++){
                                dropdown.append($('<option></option>').text(value[i].name).val(value[i].name))
                            }
                        });
                    }else{
                        
                    }
                },         
            });
        }
    }

    $(document).ready(function() {
        $('#subAccountCheckBox').change(function() {
            if ($(this).is(':checked')) {
                $('#parentAccountValue').css('display','block');
                $('#parentAccount').prop('required',true);
            } else {
                $('#parentAccountValue').css('display','none');
                $('#parentAccount').prop('required',false);
            }
        });
    });

    $('#newitem').submit(function(event){
        event.preventDefault();
        if($('.new_modal_type_itm').first().val() == 'Account'){
            var name = $("#accountName").val();
            var type = $("#Account_type").val();
            var code = $("#account_code").val();
            var desc = $("#description").val();
            var subAcc = $("#subAccountCheckBox").prop('checked');
            var parentAcc = $("#parentAccount").val();

            if (name !="" && type !="" ){
                $.ajax({
                    url: "{% url 'Fin_New_Account' %}",
                    type : 'GET',
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    data:{
                        'account_name' : name,
                        'account_type' : type,
                        'account_code' : code,
                        'subAccountCheckBox' : subAcc,
                        'parent_account' : parentAcc,
                        'description' : desc,
                    },
                    
                    success: function(response) {
                        if(response.status){
                            var dropdown = $('#nitm_pur_acc');
                            dropdown.append($('<option></option>').text(name).val(name))
                            return_to_item_modal()
                        }else{
                            alert(response.message)
                        }
                    },         
                });
            }
            else{
                alert('Account name or Type cannot be blank.!')
            }
        }
    });
</script>

<!-- New Item -->
<script>
    // Reset Form When Closed
    $('#item_close').click(function(){
        $('#item_form')[0].reset();
        $('#unit_form')[0].reset();
        $('#account_form')[0].reset();
    })

    // If Inclusive Button is Clicked
    $('#inclusive').change(function(){
        $('#taxableDiv').show()
    });

    // If NonInclusive Button is Clicked
    $('#noninclusive').change(function(){
        $('#nitm_intra_tax').val(0)
        $('#nitm_inter_tax').val(0)
        $('#taxableDiv').hide()
    });

    // If Track Inventory is Clicked
    $('#track').change(function() {
        if($(this).is(':checked')){
            $("#inventorytrack").show();
        }else{
            $('#invacc').val('')
            $('#nitm_stock').val(0)
            $('#nitm_stock_rate').val(0)
            $("#inventorytrack").hide();;
        }
    });

    // Validate Item Name
    $('#nitm_name').change(function(){
        var itm_name = $('#nitm_name').val();
        if (itm_name != ""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_Check_New_Item_Name' %}",
                data:{
                    'itm_name' : itm_name,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    if(response.is_exist){
                        $('#nitm_name').val('')
                        $('#item-name-error').text(response.message)
                        $('#nitm_name').css('border', '2px solid red'); 
                    }else{
                        $('#item-name-error').text('')
                        $('#nitm_name').css('border', '2px solid green'); 
                    }
                },         
            });
        }
    });

    // Validate Item HSN
    $('#nitm_hsn').change(function(){
        var itm_hsn = $('#nitm_hsn').val();
        if (itm_hsn != ""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_Check_New_Item_HSN' %}",
                data:{
                    'itm_hsn' : itm_hsn,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    
                    if(response.is_exist===false)
                    {
                        var hsn_string = /^(\d{6}|\d{7})$/; 
                        if (hsn_string.test($('#nitm_hsn').val())) {
                            $('#item-hsn-error').text('')
                            $('#nitm_hsn').css('border', '2px solid green'); 
                        } else {
                            $('#nitm_hsn').val('')
                            $('#item-hsn-error').text('Invalid HSN')
                            $('#nitm_hsn').css('border', '2px solid red'); 
                        }
                    }
                    else {
                        $('#nitm_hsn').val('')
                        $('#item-hsn-error').text(`${itm_hsn} already exists, Try another.!`)
                        $('#nitm_hsn').css('border', '2px solid red'); 
                    }

                },         
            });
        }
    });

    // Validate Item SAC
    $('#sacField').change(function(){
        var itm_sac = $('#sacField').val();
        if (itm_sac != ""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_Check_New_Item_SAC' %}",
                data:{
                    'itm_sac' : itm_sac,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    
                    if(response.is_exist===false)
                    {
                        var sac_string = /^(\d{6}|\d{7})$/; 
                        if (sac_string.test($('#sacField').val())) {
                            $('#item-sac-error').text('')
                            $('#sacField').css('border', '2px solid green'); 
                        } else {
                            $('#sacField').val('')
                            $('#item-sac-error').text('Invalid SAC')
                            $('#sacField').css('border', '2px solid red'); 
                        }
                    }
                    else {
                        // $('#sacField').val('')
                        $('#item-sac-error').text(`${itm_sac} already exists, Try another.!`)
                        $('#sacField').css('border', '2px solid red'); 
                    }
                    
                },         
            });
        }
    });

    // New Item 
    $('#newitem').submit(function(event){
        event.preventDefault();
        if($('.new_modal_type_itm').first().val() == 'Item'){
            if($('#inclusive').is(':checked')){
                taxref = 'Taxable'
            }else{
                taxref = 'Non Taxable'
            }
            
            // if($('#nitm_type').val()=== 'Goods' )
            // {
            //     if(!validateHSN())
            //     {
            //         alert('HSN must contain at least 6 digits')
            //         return
            //     }
            // }
            // else 
            // {
            //     if(!validateSAC())
            //     {
            //         alert('SAC must contain at least 6 digits')
            //         return
            //     }
            // }

            $.ajax({
                url: "{% url 'Fin_New_Item' %}",
                type : 'GET',
                csrfmiddlewaretoken: '{{ csrf_token }}',
                data:{
                    name : $('#nitm_name').val(),
                    type : $('#nitm_type').val(),
                    unit : $('#nitm_unit').val(),
                    hsn : $('#nitm_hsn').val(),
                    sac: $('#sacField').val(),
                    taxref : taxref,
                    intra_st : $('#nitm_intra_tax').val(),
                    inter_st : $('#nitm_inter_tax').val(),
                    pcost : $('#nitm_pur_price').val(),
                    pur_account : $('#nitm_pur_acc').val(),
                    pur_desc : $('#nitm_pur_acc').val(),
                    salesprice : $('#nitm_sale_price').val(),
                    sale_account : $('#nitm_sale_acc').val(),
                    sale_desc : $('#nitm_sale_acc').val(),
                    invacc : $('#invacc').val(),
                    stock : $('#nitm_stock').val(),
                    stock_rate : $('#nitm_stock_rate').val(),
                    min_stock : $('#nitm_min_stock').val(),
                },
                success: function(response) {
                    var tableBody = document.getElementById("items-table-body");
                    var rows = tableBody.getElementsByTagName("tr");
                    for (var i = 1; i <= rows.length; i++) {
                        var $select = $(`#product${i}`);
                        var $option = $('<option>', { 
                            text: `${$('#nitm_name').val()}`, 
                            value: response.id 
                        });
                        $option.attr('data-hsn', $('#nitm_hsn').val());
                        $option.attr('data-sac', $('#sacField').val());
                        $option.attr('data-item_type', $('#nitm_type').val());
                        $option.attr('data-stock', $('#nitm_stock').val());
                        $option.attr('data-price', $('#nitm_pur_price').val());
                        $option.attr('data-intra',$('#nitm_intra_tax').val());
                        $option.attr('data-inter', $('#nitm_inter_tax').val());
                        $select.append($option).trigger('change');
                    }
                    $('#item_form')[0].reset();
                    $('#newitem').modal('hide');
                },
            });
        }
    });
</script>


<script>
    function validateSAC() {
        var sacField = document.getElementById("sacField");
        var errorText = document.getElementById("sacError");
        var sacValue = sacField.value;

        if (sacValue.length < 6) {
            errorText.innerText = "SAC must contain at least 6 digits";
            sacField.setCustomValidity("SAC must contain at least 6 digits");
            sacField.style.borderColor = "red";
            return false;
        } else {
            errorText.innerText = "";
            sacField.setCustomValidity(""); 
            sacField.style.borderColor = ""; 
            return true;
        }
    }
    $(document).ready(function(){
        $('#nitm_type').on('input',function(){
            if($(this).val()=== 'Goods' )
            {
                $('#sacField').val('');
                $('#nitm_hsn').prop('required',true);
                $('#sacField').prop('required',false);
                $('#hsnDiv').show();
                $('#sacDiv').hide();
                $('#sacError').text('');
                $('#sacField').css({'border-color':'white'});
            }
            else
            {
                $('#nitm_hsn').val('')
                $('#nitm_hsn').prop('required',false);
                $('#sacField').prop('required',true);
                $('#sacDiv').show();
                $('#hsnDiv').hide();
                $('#item-hsn-error').text('');
                $('#nitm_hsn').css({'border-color':'white'});
            }
        })
    })
    function validateHSN() {
        var nitm_hsn = document.getElementById("nitm_hsn");
        var errorText = document.getElementById("hsnError");
        var hsnValue = nitm_hsn.value;

        if (hsnValue.length < 6) {
            errorText.innerText = "HSN must contain at least 6 digits";
            nitm_hsn.setCustomValidity("HSN must contain at least 6 digits");
            nitm_hsn.style.borderColor = "red";
            return false
        } else {
            errorText.innerText = "";
            nitm_hsn.setCustomValidity(""); 
            nitm_hsn.style.borderColor = ""; 
            return true
        }
    }
</script>

{% endblock %}