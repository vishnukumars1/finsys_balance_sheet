{% extends 'company/Fin_base.html' %}
{% block body %}
{% load static %}

<!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<style>

    
    /* #button1,#button2{
        background-color: rgba(22,37,50,255);
    }
    #button1:hover,#button2:hover{
        background-color: #2f516f;
        color: white    ;
    } */

    input:read-only, select:disabled, textarea:read-only {
        background-color: #43596c !important;
        color: #fff;
    }
</style>

<script>
    // check gst field
    $(document).ready(function() {
    function checkGstCondition() {
        var gstValue = $("#customerGST").val(); // Assuming you have an input field with id "gstInput"
        var gstValue2 = $("#vendorGST").val();
        if(gstValue == "Unregistered Business" || gstValue == 'Overseas' || gstValue == 'Consumer') {
            $("#customerGstinDiv").hide();
        } else {
            $("#customerGstinDiv").show();
        }
        if(gstValue2 == "Unregistered Business" || gstValue2 == 'Overseas' || gstValue2 == 'Consumer') {
            $("#vendorGstinDiv").hide();
        } else {
            $("#vendorGstinDiv").show();
        }
    }
    // Call the function when the page loads
    checkGstCondition();
    

    // Assuming there's an event that triggers the check, you can bind it here.
    // For example, if you want to check when the value of the GST input changes:
    // $("#gstInput").on("change", function() {
    //     checkGstCondition();
    // });
});
// -----------------------------


    //form save----------
    $(document).ready(function() {
        $('#button1').click(function() {
        $('#buttonClicked').val($(this).val()); // Set the value of the clicked button in the hidden input field
    });

    // Click event listener for the draft button
    $('#button2').click(function() {
        $('#buttonClicked').val($(this).val()); // Set the value of the clicked button in the hidden input field
    });
    
    // $('#rBillForm').submit(function(event) {
    //     // Prevent the default form submission
    //     event.preventDefault();

    //     var isDuplicate = checkUniqueHSN();
    //     var quan = checkQuantity();
    //     if (isDuplicate) {
    //         // alert("Duplicate Items found!");
    //         alert("Item HSN / SAC should not be empty !")
    //     }else if(quan){
    //         alert("quantity cannot be zero or empty !");
    //     }else{

    //         // Get the form data
    //         // var formData = $(this).serialize();
            

    //         // Make the AJAX request
    //         // $.ajax({
    //         //     url: "", // The URL to which the request is sent
    //         //     type: 'POST', // Example: POST method
    //         //     data: formData, // Send form data
    //         //     dataType: 'json', // Expected data type from the server
    //         //     success: function(response) {
    //         //         // Function to be called if the request succeeds
    //         //         console.log(response);
    //         //         alert(response.messages)
    //         //         if (response.relo){
    //         //             window.location.href = "";
    //         //         }
                    
    //         //     },
    //         //     error: function(xhr, status, error) {
    //         //         // Function to be called if the request fails
    //         //         console.error('Error:', error);
    //         //         alert(error)
    //         //     },
    //         //     complete: function(xhr, status) {
    //         //         // Function to be called regardless of success or failure
    //         //     }
    //         // });
    //             $(this).submit();
    //     }

        
    // });
});


function goBack() {
      window.history.back();
    }

</script>


    <div class="page-content" id="body">
        <table id="table2" style="display: none;">
            <tbody>
                <tr class="item-row">
                    <td></td>
                    <td class="border w-25" style="min-width: 150px;"><div style="display: flex;"><select style="text-transform: capitalize;" name="Item[]" id="selectItems" class="form-control item-select"><option value="">Select Item</option>{% for i in items %}<option value="{{i.id}}">{{i.name}}</option>{% endfor %}</select><button type="button" class="btn btn-outline-secondary text-grey ml-1" data-toggle="modal" data-target="#itemsModal">+</button></div></td>
                    <td class="border" style="min-width: 150px;">
                        <input name="hsn[]" type="text" class="form-control item-hsn" placeholder="Enter HSN" id="itemHSN">
                        <input name="sac[]" type="text" class="form-control item-sac" placeholder="Enter SAC" id="itemSAC" readonly style="display: none;">
                    </td>
                    <td class="border" style="min-width: 150px;"><input name="qty[]" type="number" class="form-control item-qty mt-4" value="0"><small class="item-stockinlabel">Available Quantity : </small><small class="item-stockin">0</small></td>
                    <td class="border" style="min-width: 150px;"><input name="price[]" type="text" class="form-control item-price" placeholder="Enter price" id="itemPrice"></td>
                    <td class="border gst" style="min-width: 150px;display: none;" id="gst">
                        <select name="gsttaxrate[]" id="GSTcolumn" onchange="initializeCalculations()" class="form-control item-gst_tax" placeholder="Tax Rate">
                            <option value="0">GST 0 (0%)</option>
                            <option value="3">GST 3 (3%)</option>
                            <option value="5">GST 5 (5%)</option>
                            <option value="12">GST 12 (12%)</option>
                            <option value="18">GST 18 (18%)</option>
                            <option value="28">GST 28 (28%)</option>
                        </select>
                    </td>
                    <td class="border igst" style="min-width: 150px;display: none;" id="igst">
                        <select name="igsttaxrate[]" id="IGSTcolumn" onchange="initializeCalculations()" class="form-control item-igst_tax" placeholder="Tax Rate">
                            <option value="0">IGST 0 (0%)</option>
                            <option value="3">IGST 3 (3%)</option>
                            <option value="5">IGST 5 (5%)</option>
                            <option value="12">IGST 12 (12%)</option>
                            <option value="18">IGST 18 (18%)</option>
                            <option value="28">IGST 28 (28%)</option>
                        </select>
                    </td>
                    <td class="border GSTtext" style="min-width: 150px;" id="GSTtext">
                        <!-- <select name="taxrate[]" id="" class="form-control item-tax mt-4" placeholder="Tax Rate">
                            <option value="">Select Tax</option>
                        </select> -->
                        <input class="form-control " type="text" placeholder="Tax Rate" readonly>
                        <!-- <small style="color: crimson;">Select Vendor & Customer</small> -->
                    </td>
                    <td class="border" style="min-width: 150px;"><input name="discount[]" type="text" class="form-control item-discount" value="0"></td>
                    <td class="border" style="min-width: 150px;"><input name="total[]" type="text" class="form-control item-total" value="0" ></td>
                    <td class="border" style="min-width: 150px;" hidden><input type="text" class="form-control item-totaltax" id="taxTotal" value="0" ></td>
                    <td class="border" ><br> <p class="btn btn-danger remove_row px-2 py-1 mx-1 fa fa-close w-80" onclick="removeRow(this)" id="minus"></p></td>
                </tr>
            </tbody>
        </table>  
        <span class="d-flex justify-content-end p-2" style="cursor: pointer;"  onclick="window.location.href=`{% url 'Fin_purchaseOrder' %}`"><i class="fa fa-times-circle text-white" style="font-size: 1.2rem;"></i></span>
        <form action="{% url 'Fin_purchaseOrderConvertRecBill' purchase.id %}" id="rBillForm" enctype="multipart/form-data" method="post">
            {% csrf_token %}
        <!-- overview -->
        <div id="overview123">
            <div class="card radius-15" id="col33">
                <!-- <div class="ml-auto"><a style="cursor: pointer;" title="Close" onclick="goBack()" ><i class="fa-solid fa-circle-xmark fa-2xl"></i></a></div> -->
               <center><h2 style="padding: 50px;">CONVERT PURCHASE ORDER TO RECURRING BILL</h2></center>
            </div>
                        
                        
                            <div class="card card-registration card-registration-2" id="col11" style="border-radius: 15px;">
                                <div class="card-body p-0">

                                    <!-- company place -->
                                    <input type="text" name="companyPlace" value="{{cmp.State}}" id="companyPlace" style="display: none;" >

                                <div class="ml-4 mr-4">

                                                <!-- <div class="row ml-2 mt-5">
                                                    
                                                    <div class="col-md-3"><label class="">Vendor Email</label></div>
                                                    <div class="col-4"><label class="">Address</label></div>
                                                </div> -->
                                                        <br><br>
                                                        <div class="border-bottom pb-2 m-md-2"><h5 class="ml-4 ">Vendor Details</h5> </div>
                                                        <br>
                                    
                                                <div class="row ml-2 mr-2 mt-5" >
                                                    <div class="col-md-6">
                                                        <div class="row">
                                                            <div class="col-md-6 form-group">
                                                                <label class="">Select Vendors</label>
                                                                <!-- <div style="display: flex;">
                                                                    <select class="form-control" name="select_vendor" id="select_vendor" >
                                                                        <option value="">Select Vendor</option>
                                                                        {% for i in vendors %}
                                                                        <option value="{{i.id}}">{{i.first_name}} {{i.last_name}}</option>
                                                                        {% endfor %}
                                                                    </select>
                                                                    <button type="button" class="btn btn-outline-secondary text-grey ml-1" data-toggle="modal" data-target="#vendorModal" style="height:min-content ;">+</button>
                                                                </div> -->

                                                                <div class="input-group">
                                                                    <input type="text" style="display: none;" value="{{purchase.Vendor.id}}" class="form-control dropdown-toggle" name="select_vendor" id="select_vendor" data-toggle="dropdown" placeholder="Search" aria-haspopup="true" aria-expanded="false">
                                                                    <input required name="vendorName" type="text" autocomplete="off" style="text-transform: capitalize;" value="{{purchase.Vendor.first_name}} {{purchase.Vendor.last_name}}" class="form-control dropdown-toggle" id="select_vendor2" data-toggle="dropdown" placeholder="Search Vendors" aria-haspopup="true" aria-expanded="false">
                                                                    <div class="input-group-append">
                                                                        <div class="dropdown-menu vendorDropdown" style="width:280px;">
                                                                            {% for i in vendors %}
                                                                            <a class="dropdown-item drop1" value="{{i.id}}" style="text-transform: uppercase;">{{i.first_name}} {{i.last_name}}</a>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                    <button type="button" class="btn btn-outline-secondary text-grey ml-1" data-toggle="modal" data-target="#vendorModal" style="height:min-content ;">+</button>
                                                                </div>

                                                                <script>
                                                                    // search
                                                                    $(document).ready(function () {
                                                                        // When a dropdown item is clicked
                                                                        $('.drop1').on('click', function () {
                                                                            var value = $(this).data('value');
                                                                            $('#select_vendor2').val($(this).text());
                                                                            // Handle the selected value as needed (e.g., update form fields or perform an action)
                                                                            
                                                                        });
                                                                
                                                                        // Add an input event listener to the search input
                                                                        $('#select_vendor2').on('input', function () {
                                                                            var searchText = $(this).val().toLowerCase();
                                                                            $('.drop1').each(function () {
                                                                                var itemText = $(this).text().toLowerCase();
                                                                                // Show/hide items based on search input
                                                                                $(this).toggle(itemText.includes(searchText));
                                                                            });
                                                                        });
                                                                    });
                                                                </script>

                                                                <!-- <div style="display: flex;">
                                                                    <select type="searchInput" class="selectpicker form-control" data-live-search="true" title="Select Vendor" id="select_vendor">
                                                                        <option data-tokens="Select Vendor" value="">Select Vendor</option>
                                                                        {% for i in vendors %}
                                                                            <option data-tokens="{{i.first_name}} {{i.last_name}}" value="{{i.id}}">{{i.first_name}} {{i.last_name}}</option>
                                                                        {% endfor %}
                                                                    </select>
                                                                    <button type="button" class="btn btn-outline-secondary text-grey ml-1" data-toggle="modal" data-target="#vendorModal" style="height:min-content;">+</button>
                                                                </div>
                                                                <script>
                                                                    $(document).ready(function () {
                                                                        $('.selectpicker').selectpicker();
                                                                    });
                                                                </script> -->
                                                            </div>
                                                            <script>
                                                                $(document).ready(function () {
                                                                    $('.vendorDropdown').on('click', '.drop1', function() {
                                                                    var vendorId = $(this).attr('value');

                                                                    // Make an AJAX request to the backend to fetch vendor details
                                                                    $.ajax({
                                                                        url: '/Fin_get_vendor_details/' + vendorId + '/',
                                                                        type: 'GET',
                                                                        success: function (data) {
                                                                            // Update the input field with the selected vendor's name
                                                                            $("#select_vendor").val($(this).text());

                                                                            // Update other placeholder elements with the fetched details
                                                                            $("#vendorEmail").val(data.email);
                                                                            $("#vendorAddress").val(data.street + ',' + data.city + '\n' + data.state + ',' + data.pincode + '\n' + data.country);
                                                                            $("#vendorGST").val(data.gst);
                                                                            $("#vendorGSTIN").val(data.gstin);
                                                                            $('#select_vendor2').val(data.firstname + ' ' + data.lastname);
                                                                            $('#select_vendor').val(data.id);

                                                                            if(data.gst == "Unregistered Business" || data.gst == 'Overseas' || data.gst == 'Consumer'){
                                                                                $("#vendorGstinDiv").hide();
                                                                            }else{
                                                                                $("#vendorGstinDiv").show();
                                                                                
                                                                            }


                                                                            var placeOfSupplyDropdown = $("#sourceOFSupply");
                                                                            // Clear existing options
                                                                            // placeOfSupplyDropdown.empty();
                                                                            var option = $('<option>', { value: data.placeofsupply, text: data.placeofsupply });                                                                            
                                                                            option.prop('selected', true);
                                                                            placeOfSupplyDropdown.append(option);

                                                                            // Close the dropdown after selecting an item
                                                                            $('.dropdown-menu').removeClass('show');
                                                                        },
                                                                        error: function (error) {
                                                                            console.log(error);
                                                                        }
                                                                    });
                                                                });
                                                            });


                                                            </script>
                                                            <div class="form-group col-md">
                                                                <label class="" >Vendor Email</label>
                                                                <input readonly name="vendorEmail" required value="{{purchase.vendor_email}}" type="vendorEmail" placeholder="Vendor Email" id="vendorEmail" class="form-control">
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="form-group col-md-6">
                                                                <label class="">GST Type </label>
                                                                <input readonly name="vendorGstType" type="text" value="{{purchase.vendor_gst_type}}" placeholder="Vendor GST Type" id="vendorGST" class="form-control">
                                                            </div>
                                                            <div id="vendorGstinDiv" {% if purchase.Vendor.gstin %} {% else %} style="display: none;" {% endif %}  class="form-group col-md">
                                                                <label class="">GST Number</label>
                                                                <input readonly name="vendorGstNumber" type="text" value="{{purchase.vendor_gstin}}" placeholder="Vendor GST Number" id="vendorGSTIN"  class="form-control">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- <div class="col-md-1">

                                                    </div> -->
                                                    <div class="col-md-3">
                                                        <label class=" ">Place Of Supply</label>
                                                        <select aria-placeholder="Select Place of Supply" required class="form-control source_of_supply_vendor" name="sourceOfSupply" id="sourceOFSupply" >
                                                            <option {% if purchase.vendor_source_of_supply == '' %}selected{% endif %} value="" class="text-grey">Select Place of Supply</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Andaman and Nicobar Islands' %}selected{% endif %} value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Andhra Pradesh' %}selected{% endif %} value="Andhra Pradesh">Andhra Pradesh</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Arunachal Pradesh' %}selected{% endif %} value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Assam' %}selected{% endif %} value="Assam">Assam</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Bihar' %}selected{% endif %} value="Bihar">Bihar</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Chandigarh' %}selected{% endif %} value="Chandigarh">Chandigarh</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Chhattisgarh' %}selected{% endif %} value="Chhattisgarh">Chhattisgarh</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Dadra and Nagar Haveli' %}selected{% endif %} value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Daman and Diu' %}selected{% endif %} value="Daman and Diu">Daman and Diu</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Delhi' %}selected{% endif %} value="Delhi">Delhi</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Goa' %}selected{% endif %} value="Goa">Goa</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Gujarat' %}selected{% endif %} value="Gujarat">Gujarat</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Haryana' %}selected{% endif %} value="Haryana">Haryana</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Himachal Pradesh' %}selected{% endif %} value="Himachal Pradesh">Himachal Pradesh</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Jammu and Kashmir' %}selected{% endif %} value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Jharkhand' %}selected{% endif %} value="Jharkhand">Jharkhand</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Karnataka' %}selected{% endif %} value="Karnataka">Karnataka</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Kerala' %}selected{% endif %} value="Kerala">Kerala</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Ladakh' %}selected{% endif %} value="Ladakh">Ladakh</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Lakshadweep' %}selected{% endif %} value="Lakshadweep">Lakshadweep</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Madhya Pradesh' %}selected{% endif %} value="Madhya Pradesh">Madhya Pradesh</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Maharashtra' %}selected{% endif %} value="Maharashtra">Maharashtra</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Manipur' %}selected{% endif %} value="Manipur">Manipur</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Meghalaya' %}selected{% endif %} value="Meghalaya">Meghalaya</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Mizoram' %}selected{% endif %} value="Mizoram">Mizoram</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Nagaland' %}selected{% endif %} value="Nagaland">Nagaland</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Odisha' %}selected{% endif %} value="Odisha">Odisha</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Puducherry' %}selected{% endif %} value="Puducherry">Puducherry</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Punjab' %}selected{% endif %} value="Punjab">Punjab</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Rajasthan' %}selected{% endif %} value="Rajasthan">Rajasthan</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Sikkim' %}selected{% endif %} value="Sikkim">Sikkim</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Tamil Nadu' %}selected{% endif %} value="Tamil Nadu">Tamil Nadu</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Telangana' %}selected{% endif %} value="Telangana">Telangana</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Tripura' %}selected{% endif %} value="Tripura">Tripura</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Uttar Predesh' %}selected{% endif %} value="Uttar Pradesh">Uttar Pradesh</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Uttarakhand' %}selected{% endif %} value="Uttarakhand">Uttarakhand</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'West Bengal' %}selected{% endif %} value="West Bengal">West Bengal</option>
                                                            <option {% if purchase.vendor_source_of_supply == 'Other Territory' %}selected{% endif %} value="Other Territory">Other Territory</option>
                                                            
                                                        </select>
                                                    </div>
                                                    <div class="form-group col-md mb-3">
                                                        <label class="">Address</label>
                                                        <textarea readonly required name="venaddress" id="vendorAddress" placeholder="Vendor Address" cols="10" rows="5" class="form-control">{{purchase.vendor_address}}</textarea>
                                                    </div>
                                                </div>

                                                
                                                <div class="row ml-2 mr-2 ">
                                                    <!-- <div class="col-md-3">
                                                        <label class="mt-4 ">Place Of Supply</label>
                                                        <select  required class="form-control source_of_supply_vendor" name="sourceOfSupply" id="sourceOFSupply" >
                                                            <option selected value="">Select Place of Supply</option>
                                                            <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islands</option>
                                                            <option value="Andhra Predhesh">Andhra Predhesh</option>
                                                            <option value="Arunachal Predesh">Arunachal Predesh</option>
                                                            <option value="Assam">Assam</option>
                                                            <option value="Bihar">Bihar</option>
                                                            <option value="Chandigarh">Chandigarh</option>
                                                            <option value="Chhattisgarh">Chhattisgarh</option>
                                                            <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                            <option value="Damn anad Diu">Damn anad Diu</option>
                                                            <option value="Delhi">Delhi</option>
                                                            <option value="Goa">Goa</option>
                                                            <option value="Gujarat">Gujarat</option>
                                                            <option value="Haryana">Haryana</option>
                                                            <option value="Himachal Predesh">Himachal Predesh</option>
                                                            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                            <option value="Jharkhand">Jharkhand</option>
                                                            <option value="Karnataka">Karnataka</option>
                                                            <option value="Kerala">Kerala</option>
                                                            <option value="Ladakh">Ladakh</option>
                                                            <option value="Lakshadweep">Lakshadweep</option>
                                                            <option value="Madhya Predesh">Madhya Predesh</option>
                                                            <option value="Maharashtra">Maharashtra</option>
                                                            <option value="Manipur">Manipur</option>
                                                            <option value="Meghalaya">Meghalaya</option>
                                                            <option value="Mizoram">Mizoram</option>
                                                            <option value="Nagaland">Nagaland</option>
                                                            <option value="Odisha">Odisha</option>
                                                            <option value="Puducherry">Puducherry</option>
                                                            <option value="Punjab">Punjab</option>
                                                            <option value="Rajasthan">Rajasthan</option>
                                                            <option value="Sikkim">Sikkim</option>
                                                            <option value="Tamil Nadu">Tamil Nadu</option>
                                                            <option value="Telangana">Telangana</option>
                                                            <option value="Tripura">Tripura</option>
                                                            <option value="Uttar Predesh">Uttar Predesh</option>
                                                            <option value="Uttarakhand">Uttarakhand</option>
                                                            <option value="West Bengal">West Bengal</option>
                                                            <option value="Other Territory">Other Territory</option>
                                                            
                                                        </select>
                                                    </div> -->
                                                </div>

                                                <br><br>
                                                <div class="border-bottom pb-4 m-md-2"><h5 class="ml-4 ">Recurring Bill Details</h5> </div>
                                                <br>

                                                <div class="row m-md-2">
                                                    <div class="col-md mb-3">
                                                        <label for="">Recurring Bill No.</label> <small style="color: orangered;" id="recuringErr"></small>
                                                        <input style="text-transform: uppercase;"  type="text" value="{{nxtRB}}" required class="form-control" placeholder="{{nxtRB}}" name="RecurringBillNo" id="RecurringBillNo" pattern="[A-Za-z]{2}\d*">
                                                        <script>
                                                            $(document).on('change','#RecurringBillNo', function() {
                                                            $('#recuringErr').text('');
                                                            var rb_num = $(this).val();

                                                            if(rb_num != ''){
                                                                var pattern = /^rb\d+$/i;
                                                                if (!pattern.test(rb_num)) {
                                                                    alert("Wrong Format. Please use the code 'RB' followed by digits");
                                                                    $(this).val('');
                                                                    return;
                                                                }
                                                            }
                                                            
                                                            
                                                            if(rb_num != ""){
                                                                $.ajax({
                                                                    type: "GET",
                                                                    url: "{% url 'Fin_check_recurring_bill_number' %}",
                                                                    data: {
                                                                        'invNum' : rb_num,
                                                                    },
                                                                    success: function (response) {
                                                                        if (response.status){
                                                                            $('#recuringErr').text('');
                                                                            
                                                                        }else{
                                                                            $('#recuringErr').text(response.message);
                                                                            
                                                                        }
                                                                    }
                                                                })
                                                            }
                                                        });
                                                        </script>
                                                    </div>
                                                    <div class="col-md mb-3">
                                                        <label for="">Reference Number</label>
                                                        <!-- <input required type="text" class="form-control" value="" disabled > -->
                                                        <input readonly type="text" class="form-control" name="ReferenceNo" id="ReferenceNo" value="{{refData}}">
                                                        
                                                    </div>
                                                    <div class="col-md mb-3">
                                                        <label for="">Profile Name</label>
                                                        <input type="text" value="" class="form-control" name="ProfileName" id="ProfileName">
                                                    </div>
                                                    <div class="col-md mb-3">
                                                        <label for="">Purchase Order No.</label>
                                                        <input readonly type="text" value="{{purchase.purchase_order_no}}" class="form-control" name="PurchaseOrderNo" id="PurchaseOrderNo">
                                                    </div>
                                                </div>

                                                <div class="row ml-md-2 mr-md-2 ">
                                                    <div class="col-md-3 mt-2">
                                                        <label for="">Repeat Every</label>
                                                        <div style="display: flex;">
                                                            <select class="form-control" name="RepeatEvery" id="RepeatEvery" >
                                                                {% for r in RepeatEvery %}
                                                                <option value="{{r.id}}">{{r.repeat_every}}</option>
                                                                {% endfor %}
                                                            </select>
                                                            <button class="btn btn-outline-secondary text-grey ml-1" data-toggle="modal" data-target="#RepeatEveryN">+</button>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3 mb-3 mt-2">
                                                        <label for="">Recurring Bill Date</label>
                                                        <input required type="date" value="{{purchase.purchase_order_date | date:'Y-m-d'}}" class="form-control" onchange="calculateEndDate()" name="startDate" id="startDate">
                                                    </div>
                                                    <div class="col-md-3 mb-3 mt-2">
                                                        <label for="">Expiry Date</label>
                                                        <input type="date" class="form-control" name="endDate" id="endDate" readonly>
                                                    </div>
                                                    <div class="col-md-3 mb-3 mt-2">
                                                        <label for="">Credit Period </label>
                                                        <div style="display: flex;">
                                                            <select required class="custom-select" name="payment_terms" id="termadd2" onchange="calculateEndDate()">
                                                                <option selected id="trmopt2"></option>
                                                                {% for pd in pTerms %}
                                                                {% if purchase.payment_terms.id == pd.id %}
                                                                    <option selected value="{{ pd.id }}">{{ pd.term_name }}</option>
                                                                    {% else %}
                                                                    <option value="{{ pd.id }}">{{ pd.term_name }}</option>
                                                                    {% endif %}
                                                                {% endfor %}
                                                            </select>
                                                            <button class="btn btn-outline-secondary text-grey ml-1" data-toggle="modal" data-target="#newPaymentRe">+</button>
                                                        </div>
                                                    </div>
                                                </div>
                                                

                                                <br><br>
                                                <div class="border-bottom pb-4 m-md-2"><h5 class="ml-4 ">Customer Details</h5> </div>
                                                <br>

                                                <div class="row m-md-2">
                                                    <div class="col-md-8">
                                                        <div class="row">
                                                            <div class="col-md mb-3">
                                                                <label for="">Customer</label>
                                                                <div class="input-group">
                                                                    <input type="text" style="display: none;" value="{{purchase.Customer.id}}" class="form-control dropdown-toggle" name="Customer" id="SelectCustomer" data-toggle="dropdown" placeholder="Search" aria-haspopup="true" aria-expanded="false">
                                                                    <input type="text" name="customerName" style="text-transform: capitalize;" autocomplete="off" value="{{purchase.Customer.first_name}} {{purchase.Customer.last_name}}" class="form-control dropdown-toggle" id="SelectCustomer2" data-toggle="dropdown" placeholder="Search Customer" aria-haspopup="true" aria-expanded="false">
                                                                    <div class="input-group-append">
                                                                        <div class="dropdown-menu customerDropdown" style="width:380px;">
                                                                            {% for i in customers %}
                                                                            <a class="dropdown-item drop2" value="{{i.id}}" style="text-transform: uppercase;">{{i.first_name}} {{i.last_name}}</a>
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                    <button type="button" class="btn btn-outline-secondary text-grey ml-1" data-toggle="modal" data-target="#customerModal">+</button>
                                                                </div>
        
                                                                <script>
                                                                    // search
                                                                    $(document).ready(function () {
                                                                        // When a dropdown item is clicked
                                                                        $('.customerDropdown').on('click', '.drop2', function() {
                                                                            var value = $(this).data('value');
                                                                            $('#SelectCustomer2').val($(this).text());
                                                                            // Handle the selected value as needed (e.g., update form fields or perform an action)
                                                                            
                                                                        });
                                                                
                                                                        // Add an input event listener to the search input
                                                                        $('#SelectCustomer2').on('input', function () {
                                                                            var searchText = $(this).val().toLowerCase();
                                                                            $('.drop2').each(function () {
                                                                                var itemText = $(this).text().toLowerCase();
                                                                                // Show/hide items based on search input
                                                                                $(this).toggle(itemText.includes(searchText));
                                                                            });
                                                                        });
                                                                    });
    
                                                                    $(document).ready(function() {
                                                                $('.customerDropdown').on('click', '.drop2', function() {  
                                                                    var customerID = $(this).attr('value');
                                                        
                                                                    // Make an AJAX request to the backend to fetch vendor details
                                                                    $.ajax({
                                                                        url: '/Fin_get_customer_details/' + customerID + '/',
                                                                        type: 'GET',
                                                                        success: function(data) {
                                                                            // Update the placeholder elements with the fetched details
                                                                            $("#customerEmail").val(data.email);
                                                                            $("#customerGST").val(data.gst);
                                                                            $("#customerGSTIN").val(data.gstin);
                                                                            $('#SelectCustomer2').val(data.firstname + ' ' + data.lastname);
                                                                            $('#SelectCustomer').val(data.id);
                                                                            $("#customerAddress").val(data.street + ',' + data.city + '\n' + data.state + ',' + data.pincode + '\n' + data.country);
    
                                                                            var placeOfSupplyDropdown = $("#PlaceOfSupplyCustomer");
                                                                            // placeOfSupplyDropdown.empty();
                                                                            // Append options from data.placeofsupply
                                                                            var option = $('<option>', { value: data.placeofsupply, text: data.placeofsupply });                                                                        
                                                                            option.prop('selected', true);
                                                                            placeOfSupplyDropdown.append(option); 
    
                                                                            if(data.gst == "Unregistered Business" || data.gst == 'Overseas' || data.gst == 'Consumer' ){
                                                                                    $("#customerGstinDiv").hide();
                                                                                }else{
                                                                                    $("#customerGstinDiv").show();
                                                                                    
                                                                                }
                                                                            
                                                                            
                                                                        },
                                                                        error: function(error) {
                                                                            console.log(error);
                                                                        }
                                                                    });
                                                                });
                                                            });
                                                                </script>
                                                            </div>
                                                            <div class="col-md mb-3">
                                                                <label for="">Email</label>
                                                                <input readonly type="email" value="{{purchase.customer_email}}" placeholder="customer email" required class="form-control" name="customerEmail" id="customerEmail">
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6 mb-3 mt-2">
                                                                <label for="">GST Type</label>
                                                                <input readonly type="text" value="{{purchase.customer_gst_type}}" placeholder="customer gst type" name="GSTType" id="customerGST" class="form-control">                                                        
                                                            </div>
                                                            <div class="col-md-6 mb-3 mt-2" id="customerGstinDiv" style="display: none;">
                                                                <label class="">GST Number</label>
                                                                <input readonly name="customerGstNumber" type="text" value="{{purchase.customer_gstin}}" placeholder="customer gst number" id="customerGSTIN"  class="form-control">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col">
                                                        <div class="col-md">
                                                            <label for="">Address </label>
                                                            <textarea readonly name="cusaddress" id="customerAddress" placeholder="Customer Address " cols="10" rows="5" class="form-control">{{purchase.customer_address}}</textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row m-md-2 border-bottom pb-4">
                                                    <div class="col-md-4 mb-3">
                                                        <label for="">Place Of Supply</label>
                                                        <select name="placeOfSupply" id="PlaceOfSupplyCustomer" class="form-control place_of_supply_customer">
                                                            <option {% if purchase.customer_place_of_supply == '' %}selected{% endif %} value="" class="text-grey">Select Place of Supply</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Andaman and Nicobar Islands' %}selected{% endif %} value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Andhra Pradesh' %}selected{% endif %} value="Andhra Pradesh">Andhra Pradesh</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Arunachal Pradesh' %}selected{% endif %} value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Assam' %}selected{% endif %} value="Assam">Assam</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Bihar' %}selected{% endif %} value="Bihar">Bihar</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Chandigarh' %}selected{% endif %} value="Chandigarh">Chandigarh</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Chhattisgarh' %}selected{% endif %} value="Chhattisgarh">Chhattisgarh</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Dadra and Nagar Haveli' %}selected{% endif %} value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Daman and Diu' %}selected{% endif %} value="Daman and Diu">Daman and Diu</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Delhi' %}selected{% endif %} value="Delhi">Delhi</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Goa' %}selected{% endif %} value="Goa">Goa</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Gujarat' %}selected{% endif %} value="Gujarat">Gujarat</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Haryana' %}selected{% endif %} value="Haryana">Haryana</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Himachal Pradesh' %}selected{% endif %} value="Himachal Pradesh">Himachal Pradesh</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Jammu and Kashmir' %}selected{% endif %} value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Jharkhand' %}selected{% endif %} value="Jharkhand">Jharkhand</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Karnataka' %}selected{% endif %} value="Karnataka">Karnataka</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Kerala' %}selected{% endif %} value="Kerala">Kerala</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Ladakh' %}selected{% endif %} value="Ladakh">Ladakh</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Lakshadweep' %}selected{% endif %} value="Lakshadweep">Lakshadweep</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Madhya Pradesh' %}selected{% endif %} value="Madhya Pradesh">Madhya Pradesh</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Maharashtra' %}selected{% endif %} value="Maharashtra">Maharashtra</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Manipur' %}selected{% endif %} value="Manipur">Manipur</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Meghalaya' %}selected{% endif %} value="Meghalaya">Meghalaya</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Mizoram' %}selected{% endif %} value="Mizoram">Mizoram</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Nagaland' %}selected{% endif %} value="Nagaland">Nagaland</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Odisha' %}selected{% endif %} value="Odisha">Odisha</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Puducherry' %}selected{% endif %} value="Puducherry">Puducherry</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Punjab' %}selected{% endif %} value="Punjab">Punjab</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Rajasthan' %}selected{% endif %} value="Rajasthan">Rajasthan</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Sikkim' %}selected{% endif %} value="Sikkim">Sikkim</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Tamil Nadu' %}selected{% endif %} value="Tamil Nadu">Tamil Nadu</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Telangana' %}selected{% endif %} value="Telangana">Telangana</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Tripura' %}selected{% endif %} value="Tripura">Tripura</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Uttar Predesh' %}selected{% endif %} value="Uttar Pradesh">Uttar Pradesh</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Uttarakhand' %}selected{% endif %} value="Uttarakhand">Uttarakhand</option>
                                                            <option {% if purchase.customer_place_of_supply == 'West Bengal' %}selected{% endif %} value="West Bengal">West Bengal</option>
                                                            <option {% if purchase.customer_place_of_supply == 'Other Territory' %}selected{% endif %} value="Other Territory">Other Territory</option>
                                                        </select> 
                                                    </div>     

                                                    <div class="col-md-4 mb-3 ">
                                                        <label for="">Payment Type</label>
                                                        <select required name="paymentType" id="paymentType" class="form-control">
                                                            <option {% if purchase.payment_method == '' %} selected {% endif %} value="">Select Payment Method</option>
                                                            <option {% if purchase.payment_method == 'Cash' %} selected {% endif %} value="Cash">Cash</option>
                                                            <option {% if purchase.payment_method == 'Cheque' %} selected {% endif %} value="Cheque">Cheque</option>
                                                            <option {% if purchase.payment_method == 'UPI' %} selected {% endif %} value="UPI">UPI</option>
                                                            {% for b in bank %}
                                                            <option {% if purchase.payment_method == b.bank_name %} selected {% endif %} value="{{b.account_number}}">{{b.bank_name}} ({{b.account_number}})</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                    <div class="col-md-4 mb-3 " id="bankAccount" style="display: none;">
                                                        <label for="">Bank Account</label>
                                                        <input value="{{purchase.bank_acc_no}}" id="bankInput" type="text" class="form-control" name="bankAccount" >
                                                    </div>
                                                    <div class="col-md-4 mb-3 " id="Cheque" style="display: none;">
                                                        <label for="">Cheque</label>
                                                        <input value="{{purchase.cheque_no}}" id="chequeInput" type="text" class="form-control" name="Cheque">
                                                    </div>
                                                    <div class="col-md-4 mb-3 " id="UPI" style="display: none;">
                                                        <label for="">UPI</label>
                                                        <input value="{{purchase.upi_no}}" id="upiInput" type="text" class="form-control" name="UPI">
                                                    </div>
                                                     
                                                </div>

                                                

                                                

                                                <!-- <div class="row m-md-2 ">
                                                    <div class="col-md-4 mb-3 mt-2">
                                                        <label for="">Recurring Bill Date</label>
                                                        <input required type="date" class="form-control" onchange="calculateEndDate()" name="startDate" id="startDate">
                                                    </div>
                                                    <div class="col-md-4 mb-3 mt-2">
                                                        <label for="">Expiry Date</label>
                                                        <input type="date" class="form-control" name="endDate" id="endDate" readonly>
                                                    </div>                                                
                                                </div> -->
                                                <script>
                                                    $(document).ready(function() {
                                                    // Bind an event listener to the start event of the input field with ID "startDate"
                                                    $('#startDate').on('change', function() {
                                                        // Call the calculateEndDate() function when the start event occurs
                                                        calculateEndDate();
                                                    });
                                                    $('#startDate').change();
                                                });
                                                    // Function to calculate end date
                                                    function calculateEndDate() {
                                                        // Get the selected start date
                                                        var startDate = document.getElementById("startDate").value;

                                                        // Get the selected payment terms (number of days)
                                                        var paymentTerms = document.getElementById("termadd2").value;
                                                        if (paymentTerms == ''){
                                                            document.getElementById("endDate").value = '';
                                                        }else{

                                                        $.ajax({
                                                            url: '/Fin_end_date',
                                                            type: 'GET',
                                                            data: {
                                                                'payment': paymentTerms
                                                            },
                                                            success: function (data) {
                                                                var countDays = data.countDays; // Correctly access the countDays from the response data
                                                                // Calculate the end date
                                                                var endDate = new Date(startDate);
                                                                endDate.setDate(endDate.getDate() + parseInt(countDays));

                                                                // // Format the end date to YYYY-MM-DD
                                                                var formattedEndDate = endDate.toISOString().split('T')[0];

                                                                

                                                                // Display the calculated end date
                                                                document.getElementById("endDate").value = formattedEndDate;

                                                            },
                                                            error: function (error) {
                                                                console.log(error);
                                                            }
                                                        });
                                                    }
                                                    }

                                                    
                                                    

                                                </script>

                                                <!-- <div class="row m-md-2">
                                                    <div class="col-md-4 mb-3">
                                                        <label for="">Credit Period </label>
                                                        <div style="display: flex;">
                                                            <select required class="custom-select" name="payment_terms" id="termadd2" onchange="calculateEndDate()">
                                                                <option selected id="trmopt2"></option>
                                                                {% for pd in pTerms %}
                                                                    <option value="{{ pd.id }}">{{ pd.term_name }}</option>
                                                                {% endfor %}
                                                            </select>
                                                            <button class="btn btn-outline-secondary text-grey ml-1" data-toggle="modal" data-target="#newPaymentRe">+</button>
                                                        </div>
                                                    </div>
                                                </div> -->
                                       

                                                <!-- <div class="row ml-md-2 mr-md-2 border-bottom pb-3 mb-5">
                                                    <div class="col-md-4 mb-3">
                                                        <label for="">Payment Type</label>
                                                        <select required name="paymentType" id="paymentType" class="form-control">
                                                            <option value="">Select Payment Method</option>
                                                            <option value="Cash">Cash</option>
                                                            <option value="Cheque">Cheque</option>
                                                            <option value="UPI">UPI</option>
                                                            {% for b in bank %}
                                                            <option value="{{b.id}}">{{b.bank_name}}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>

                                                    <div class="col-md-4 mb-3" id="bankAccount" style="display: none;">
                                                        <label for="">Bank Account</label>
                                                        <input type="text" class="form-control" name="bankAccount" >
                                                    </div>
                                                    <div class="col-md-4 mb-3" id="Cheque" style="display: none;">
                                                        <label for="">Cheque</label>
                                                        <input type="text" class="form-control" name="Cheque">
                                                    </div>
                                                    <div class="col-md-4 mb-3" id="UPI" style="display: none;">
                                                        <label for="">UPI</label>
                                                        <input type="text" class="form-control" name="UPI">
                                                    </div>
                                                </div> -->

                                                <script>
                                                    $(document).ready(function () {
                                                    // Event listener for dropdown change
                                                    $('#paymentType').on('change', function () {
                                                        // Get the selected payment method
                                                        var payment = $('#paymentType').val();

                                                        // Show the selected payment method div
                                                        if (payment === '' || payment === 'Cash' ) {
                                                            $('#bankAccount').hide();
                                                            $('#Cheque').hide();
                                                            $('#UPI').hide();
                                                            $('#bankInput').removeAttr('required');
                                                            $('#bankInput').val('')
                                                            $('#chequeInput').removeAttr('required');
                                                            $('#upiInput').removeAttr('required');
                                                        } else if (payment === 'Cheque') {
                                                            $('#bankAccount').hide();
                                                            $('#Cheque').show();
                                                            $('#UPI').hide();
                                                            $('#bankInput').removeAttr('required');
                                                            $('#bankInput').val('')
                                                            $('#chequeInput').attr('required', true);
                                                            $('#upiInput').removeAttr('required');
                                                        } else if (payment === 'UPI') {
                                                            $('#bankAccount').hide();
                                                            $('#Cheque').hide();
                                                            $('#UPI').show();
                                                            $('#bankInput').removeAttr('required');
                                                            $('#bankInput').val('')
                                                            $('#chequeInput').removeAttr('required');
                                                            $('#upiInput').attr('required', true);
                                                        }else{
                                                            $('#bankAccount').show();
                                                            $('#Cheque').hide();
                                                            $('#UPI').hide();
                                                            $('#bankInput').attr('required', true);
                                                            $('#chequeInput').removeAttr('required');
                                                            $('#upiInput').removeAttr('required');
                                                            var bankNum = payment;
                                                                    // Make an AJAX request to the backend to fetch vendor details
                                                                    $.ajax({
                                                                        url: '/Fin_get_bank_details/' + bankNum ,
                                                                        type: 'GET',
                                                                        success: function (data) {
                                                                            
                                                                            $("#bankInput").val(data.acc_number);
                                                                            
                                                                        },
                                                                        error: function (error) {
                                                                            console.log(error);
                                                                            alert(error)
                                                                        }
                                                                    });
                                                        }
                                                    });
                                                    $('#paymentType').change();
                                                });

                                                </script>

                                                <div class="row m-md-2">
                                                    <input class="ml-3" id="priceListCheckbox" name="priceListCheckbox" type="checkbox">&nbsp; Price List
                                                </div>
                                                <div class="row m-md-2">
                                                    <div class="col-md-3 mb-3" id="priceListDiv" >
                                                        <!-- <label for="">Price List</label> -->
                                                        <select name="priceListRB" id="priceListRB" class="form-control">
                                                            <option value="" selected>Choose</option>
                                                            {% for l in list %}
                                                            <option value="{{l.id}}">{{l.name}}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>

                                                <script>
                                                    var priceListCheckbox = document.getElementById("priceListCheckbox");
                                                    var priceListDiv = document.getElementById("priceListDiv");
                                                    var priceListRB = document.getElementById("priceListRB");
                                                    var previousSelection = document.getElementById("priceListRB").value;

                                                    // Add an event listener to the checkbox to toggle the visibility of the select element
                                                    priceListCheckbox.addEventListener("click", function() {
                                                        if (this.checked) {
                                                            // If the checkbox is checked, display the select element
                                                            priceListDiv.style.display = "block";
                                                            priceListRB.required = true;

                                                            if (previousSelection !== null) {
                                                            var option = document.querySelector("#priceListRB option[value='" + previousSelection + "']");
                                                            if (option) {
                                                                option.selected = true; // Select the previous option
                                                                option.dispatchEvent(new Event('click')); // Dispatch the click event
                                                                $("#itemTable .item-select").trigger("change");
                                                            }
                                                        }
                                                        } else{
                                                            // If the checkbox is unchecked, hide the select element
                                                            priceListDiv.style.display = "none";
                                                            priceListRB.required = false;

                                                            // Trigger click event and select first option
                                                            var firstOption = document.querySelector("#priceListRB option:first-child");
                                                            if (firstOption) {
                                                                firstOption.selected = true; // Select the first option
                                                                firstOption.dispatchEvent(new Event('click')); // Dispatch the click event
                                                                $("#itemTable .item-select").trigger("change");
                                                            }
                                                        }
                                                    });


                                                    

                                                </script>


                                                <div class="row m-md-2 pb-3 mt-5 table-responsive">
                                                    
                                                        <table class="table border mt-3" id="itemTable">
                                                            <thead>
                                                                <tr class="border">
                                                                    <th class="border">#</th>
                                                                    <th class="border">ITEM</th>
                                                                    <th class="border">HSN/SAC</th>
                                                                    <th class="border">QTY</th>
                                                                    <th class="border">PRICE</th>
                                                                    <th class="border">TAX(%)</th>
                                                                    <th class="border">DISCOUNT</th>
                                                                    <th class="border">TOTAL</th>
                                                                    <th class="border"></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                {% for itm in purchaseItems %}
                                                                <tr class="item-row">
                                                                    <td></td>
                                                                    <td class="border w-25" style="min-width: 150px;"><div style="display: flex;"><select style="text-transform: capitalize;" name="Item[]" id="selectItems" class="form-control item-select"><option value="">Select Item</option>{% for i in items %}{% if itm.Item.id == i.id %}<option selected value="{{i.id}}">{{i.name}}</option>{% else %}<option value="{{i.id}}">{{i.name}}</option>{% endif %}{% endfor %}</select><button type="button" class="btn btn-outline-secondary text-grey ml-1" data-toggle="modal" data-target="#itemsModal">+</button></div></td>
                                                                    <td class="border" style="min-width: 150px;">
                                                                        <input name="hsn[]" type="text" class="form-control item-hsn" placeholder="Enter HSN" value="{{itm.hsn}}" id="itemHSN" readonly {% if not itm.hsn %} style="display:none;"{% endif %}>
                                                                        <input name="sac[]" type="text" class="form-control item-sac" placeholder="Enter SAC" value="{{itm.sac}}" id="itemSAC" readonly {% if not itm.sac %} style="display:none;"{% endif %}>
                                                                    </td>
                                                                    <td class="border" style="min-width: 150px;"><input name="qty[]" type="number" class="form-control item-qty mt-4" value="{{itm.quantity}}"><small class="item-stockinlabel">Available Quantity : </small><small class="item-stockin">{{itm.Item.current_stock}}</small></td>
                                                                    <td class="border" style="min-width: 150px;"><input name="price[]" type="text" class="form-control item-price" value="{{itm.price}}" placeholder="Enter price" id="itemPrice"></td>
                                                                    <td class="border gst" style="min-width: 150px;display: none;" id="gst">
                                                                        <select name="gsttaxrate[]" id="GSTcolumn" onchange="initializeCalculations()" class="form-control item-gst_tax" placeholder="Tax Rate">
                                                                            <option {% if itm.tax == "0" %} selected {% endif %} value="0">GST 0 (0%)</option>
                                                                            <option {% if itm.tax == "3" %} selected {% endif %} value="3">GST 3 (3%)</option>
                                                                            <option {% if itm.tax == "5" %} selected {% endif %} value="5">GST 5 (5%)</option>
                                                                            <option {% if itm.tax == "12" %} selected {% endif %} value="12">GST 12 (12%)</option>
                                                                            <option {% if itm.tax == "18" %} selected {% endif %} value="18">GST 18 (18%)</option>
                                                                            <option {% if itm.tax == "28" %} selected {% endif %} value="28">GST 28 (28%)</option>
                                                                        </select>
                                                                    </td>
                                                                    <td class="border igst" style="min-width: 150px;display: none;" id="igst">
                                                                        <select name="igsttaxrate[]" id="IGSTcolumn" onchange="initializeCalculations()" class="form-control item-igst_tax" placeholder="Tax Rate">
                                                                            <option {% if itm.tax == "0" %} selected {% endif %} value="0">IGST 0 (0%)</option>
                                                                            <option {% if itm.tax == "3" %} selected {% endif %} value="3">IGST 3 (3%)</option>
                                                                            <option {% if itm.tax == "5" %} selected {% endif %} value="5">IGST 5 (5%)</option>
                                                                            <option {% if itm.tax == "12" %} selected {% endif %} value="12">IGST 12 (12%)</option>
                                                                            <option {% if itm.tax == "18" %} selected {% endif %} value="18">IGST 18 (18%)</option>
                                                                            <option {% if itm.tax == "28" %} selected {% endif %} value="28">IGST 28 (28%)</option>
                                                                        </select> 
                                                                    </td>
                                                                    <td class="border GSTtext" style="min-width: 150px;" id="GSTtext">
                                                                        <!-- <select name="taxrate[]" id="" class="form-control item-tax mt-4" placeholder="Tax Rate">
                                                                            <option value="">Select Tax</option>
                                                                        </select> -->
                                                                        <input class="form-control " type="text" placeholder="Tax Rate" readonly>
                                                                        <!-- <small style="color: crimson;">Select Vendor & Customer</small> -->
                                                                    </td>
                                                                    <td class="border" style="min-width: 150px;"><input name="discount[]" type="text" class="form-control item-discount" value="{{itm.discount}}"></td>
                                                                    <td class="border" style="min-width: 150px;"><input name="total[]" type="text" class="form-control item-total" value="{{itm.total}}" ></td>
                                                                    <td class="border" style="min-width: 150px;" hidden><input type="hidden" class="form-control item-totaltax" id="taxTotal" value="0" ></td>
                                                                    <td class="border" ><br> <p class="btn btn-danger remove_row px-2 py-1 mx-1 fa fa-close w-80" onclick="removeRow(this)" id="minus"></p></td>
                                                                </tr>
                                                                {% endfor %}
                                                            </tbody>
                                                            <tr>
                                                                <td class="border"><p class="btn btn-outline-secondary text-grey mb-1 w-100 " onclick="addRow()" id="plus">+</p></td>
                                                            </tr>
                                                        </table>
                                                    


                                                    <script>
                                                        // check for qty
                                                        function checkQuantity() {
                                                        var isValid = false;

                                                        $("#itemTable .item-qty").each(function() {
                                                            var qtyValue = $(this).val().trim();

                                                            if (qtyValue === '' || parseFloat(qtyValue) === 0) {
                                                                // alert("Quantity cannot be zero or empty");
                                                                isValid = true;
                                                                return false; // Exit the loop if a zero or empty quantity is found
                                                            }
                                                        });

                                                        return isValid;
                                                    }

                                                        // duplicate items check
                                                        // ---------------------------------
                                                        function checkUniqueHSN() {
                                                        var hsnArray = [];
                                                        var sacArray = [];
                                                        var duplicateFound = false;

                                                        // Loop through each row
                                                        $(".item-hsn").each(function() {
                                                            var hsn = $(this).val().trim();
                                                            var sac = $(this).next().val().trim()

                                                            // Check if the HSN exists in the array
                                                            if (hsnArray.indexOf(hsn) !== -1 && hsn !== "" && hsnArray.indexOf(sac) !== -1 && sac !== "") {
                                                                alert($(this).next().val())
                                                                duplicateFound = true;
                                                                return false; // Exit the loop if duplicate is found
                                                            }

                                                            // If not found, add to array
                                                            hsnArray.push(hsn);
                                                        });

                                                        return duplicateFound;
                                                    }

                                                    


                                                        // --------------------------------
                                                        $(document).ready(function () {
                                                            setInterval(checkPlaceOfSupply, 1000);
                                                        // Function to check and handle visibility based on the values of 'PlaceOfSupplyCustomer' and 'sourceOFSupply'
                                                        function checkPlaceOfSupply() {
                                                            var companyPlaceValue = $('#companyPlace').val();
                                                            var sourceOFSupplyValue = $('#sourceOFSupply').val();
                                                            
                                                            // Check if 'PlaceOfSupplyCustomer' and 'sourceOFSupply' have the same value
                                                            if (companyPlaceValue === 'Kerala' && sourceOFSupplyValue === 'Kerala' && companyPlaceValue !== '' && sourceOFSupplyValue !== '' ) {
                                                                // Display 'gst' and hide 'igst'
                                                                $('.gst').show();
                                                                $('.igst').hide();
                                                                $('.GSTtext').hide();
                                                                $('#ifIGST').hide();
                                                                $('#ifGST').show();
                                                                $('#ifOR').hide();
                                                                $('#GST1').show();
                                                                $('#GST2').show();
                                                            } else if ( companyPlaceValue !== '' && sourceOFSupplyValue !== '' ) {
                                                                // Display 'igst' and hide 'gst'
                                                                $('.gst').hide();
                                                                $('.GSTtext').hide();
                                                                $('#ifGST').hide();
                                                                $('.igst').show();
                                                                $('#ifGST').hide();
                                                                $('#ifIGST').show();
                                                                $('#ifOR').hide();
                                                                $('#GST1').hide();
                                                                $('#GST2').hide();
                                                            }else{
                                                                $('.gst').hide();
                                                                $('.igst').hide();
                                                                $('.GSTtext').show();
                                                                $('#ifOR').show();
                                                                $('#GST1').show();
                                                                $('#GST2').show();
                                                            }
                                                        }
                                                        
                                                        // Event listener for change in 'PlaceOfSupplyCustomer' or 'sourceOFSupply'
                                                        $('#sourceOFSupply').on('change', checkPlaceOfSupply);

                                                        // Trigger the change event on page load to initialize the visibility
                                                        $('#sourceOFSupply').change();

                                                        $('#SelectCustomer2, #select_vendor2').on('click', function () {
                                                            setTimeout(function () {
                                                                // Trigger the logic after 1 second when 'SelectCustomer' or 'select_vendor' is changed
                                                                checkPlaceOfSupply();
                                                                initializeCalculations()
                                                                

                                                            }, 1500); // 1000 milliseconds = 1 second
                                                        });
                                                        
                                                    });


                                                        // --------------------------------------------------------------------------
                                                        // table row fill
                                                        $(document).ready(function () {
                                                        // Use event delegation on the table
                                                        // $("#itemTable").on("change", ".item-select", function () {
                                                        //     var $select = $(this);
                                                        //     var $row = $select.closest('.item-row'); // Find the closest row

                                                        //     var itemsId = $select.val();

                                                        //     // Make an AJAX request to the backend to fetch item details
                                                        //     $.ajax({
                                                        //         url: '/Fin_get_item_details/' + itemsId + '/',
                                                        //         type: 'GET',
                                                        //         success: function (data) {
                                                        //             // Update the placeholder elements with the fetched details
                                                        //             $row.find(".item-hsn").val(data.hsn);
                                                        //             $row.find(".item-stockin").data("initial", data.current_stock); // Store the initial value
                                                        //             $row.find(".item-stockin").html(data.current_stock);
                                                        //             $row.find(".item-gst_tax").val(data.gst_tax).change();
                                                        //             $row.find(".item-igst_tax").val(data.igst_tax).change();
                                                        //             console.log('4545454545',data.id);
                                                        //             plistID = document.getElementById('priceListRB').value;
                                                        //             if(plistID!=''){
                                                        //                     $.ajax({
                                                        //                     url: '/Fin_get_pricelist_details/' + plistID + '/' + itemsId + '/',
                                                        //                     type: 'GET',
                                                        //                     success: function (response) {
                                                        //                         if (response.opr == 'UP'){
                                                        //                             prce = data.price*(1+(response.perc/100));
                                                        //                             $row.find(".item-price").val(prce.toFixed(2));
                                                        //                         }else if(response.opr == 'DOWN'){
                                                        //                             prce = data.price*(1-(response.perc/100));
                                                        //                             $row.find(".item-price").val(prce.toFixed(2));
                                                        //                         }else if(response.opr == 'Custom'){
                                                        //                             $row.find(".item-price").val(response.customerRate);
                                                        //                         }else{
                                                        //                             alert('something went wrong!')
                                                        //                         }
                                                        //                     },
                                                        //                     error: function (error) {
                                                        //                         console.log(error);
                                                        //                         alert(error)
                                                        //                     }
                                                        //                     });
                                                        //             }else{
                                                        //                 $row.find(".item-price").val(data.price);
                                                        //             }

                                                        //             updateStockin($row);
                                                        //         },
                                                        //         error: function (error) {
                                                        //             console.log(error);
                                                        //         }
                                                        //     });
                                                        //     // Add change event listener to the priceListRB dropdown
                                                        //     $('#priceListRB').on('change', function () {
                                                        //         // Trigger change event for each .item-select element inside #itemTable
                                                        //         $("#itemTable .item-select").trigger("change");
                                                        //     });
                                                        // });




// ------- get item details and price according to pricelist ----------------------
function changePrice(itemsId, $row, data) {
    var plistID = document.getElementById('priceListRB').value;
    console.log(plistID,'pricelist selection')

    if (plistID != '') {
        $.ajax({
            url: '/Fin_get_pricelist_details/' + plistID + '/' + itemsId + '/',
            type: 'GET',
            success: function (response) {
                if (response.opr == 'UP') {
                    prce = data.price * (1 + (response.perc / 100));
                    $row.find(".item-price").val(prce.toFixed(2));
                } else if (response.opr == 'DOWN') {
                    prce = data.price * (1 - (response.perc / 100));
                    $row.find(".item-price").val(prce.toFixed(2));
                } else if (response.opr == 'Custom') {
                    $row.find(".item-price").val(response.customerRate);
                } else {
                    alert('something went wrong!')
                }
            },
            error: function (error) {
                console.log(error);
                alert(error)
            }
        });
    } else {
        $row.find(".item-price").val(data.price);
    }
}

$("#itemTable").on("change", ".item-select", function () {
    var $select = $(this);
    var $row = $select.closest('.item-row'); // Find the closest row

    var itemsId = $select.val();
    console.log('item selection');

    // Make an AJAX request to the backend to fetch item details
    $.ajax({
        url: '/Fin_get_item_details/' + itemsId + '/',
        type: 'GET',
        success: function (data) {
            // Update the placeholder elements with the fetched details
            if(data.item_type==='Goods')
            {
                $row.find(".item-hsn").val(data.hsn);
                $row.find(".item-hsn").show();
                $row.find(".item-sac").hide();
            }
            else
            {
                $row.find(".item-sac").val(data.sac);
                $row.find(".item-sac").show();
                $row.find(".item-hsn").hide();
            }
            $row.find(".item-stockin").data("initial", data.current_stock); // Store the initial value
            $row.find(".item-stockin").html(data.current_stock);
            $row.find(".item-gst_tax").val(data.gst_tax).change();
            $row.find(".item-igst_tax").val(data.igst_tax).change();
            console.log('4545454545', data.id);

            changePrice(itemsId, $row, data);

            updateStockin($row);
        },
        error: function (error) {
            console.log(error);
        }
    });
});



$("#priceListRB").on("click", function() {
    $("#itemTable").find(".item-select").trigger("change");
});


// -------item details and pricelist  end----------------





                                                        // Function to check and update item-stockin based on item-qty
                                                        function updateStockin($row) {
                                                            var qty = parseInt($row.find(".item-qty").val());
                                                            var initialStockin = parseInt($row.find(".item-stockin").data("initial"));

                                                            // Set the maximum value for item-qty to the initial count of item-stockin
                                                            // $row.find(".item-qty").attr("max", initialStockin);

                                                            // Check if item-qty is valid
                                                            if (!isNaN(qty) && qty >= 0 ) {
                                                                // Update item-stockin based on the change in item-qty
                                                                var updatedStockin = initialStockin + qty; // Decrease stockin based on qty
                                                                $row.find(".item-stockin").html(updatedStockin);
                                                                $row.find(".item-stockin").css('color', 'white');

                                                                // Display "Out of Stock" message if item-stockin is 0
                                                                
                                                            } else {
                                                                // Handle invalid item-qty (e.g., display an error message)
                                                                alert("Invalid quantity");
                                                                // Reset item-qty to a valid value (you can modify this based on your requirements)
                                                                $row.find(".item-qty").val(0);
                                                                $row.find(".item-stockin").html(initialStockin);

                                                            }
                                                        }

                                                        $("#itemTable").on("input", ".item-qty", function () {
                                                        var $input = $(this);
                                                        var $row = $input.closest('.item-row'); // Find the closest row

                                                        updateStockin($row);
                                                    });
                                                    });

// $(document).ready(function() {
//     // Iterate through each item row in the #itemTable table
//     $("#itemTable .item-row").each(function() {
//         var $row = $(this); // Current row
//         var $input = $row.find('.item-select'); // Find the item-qty input field within the row
        
//         // Trigger a custom event named "item-select" on the item-qty input field
//         $input.trigger('change');
//     });
// });




                                                    // item save
                                                    $(document).ready(function() {
                                                    $('#saveItemsButton').click(function() {
                                                        var itemsData = [];

                                                        // Iterate through each row in the table
                                                        $('#itemTable tbody tr').each(function() {
                                                            // Get quantity value
                                                            var quantity = $(this).find('.item-qty').val();

                                                            // Check if quantity is not 0
                                                            if (quantity !== "0") {
                                                                var item = {
                                                                    'items': $(this).find('.item-select').val(),
                                                                    'hsn': $(this).find('.item-hsn').val(),
                                                                    'sac': $(this).find('.item-sac').val(),
                                                                    'quantity': quantity,
                                                                    'price': $(this).find('.item-price').val(),
                                                                    'tax_rate': $(this).find('.item-tax').val(),
                                                                    'discount': $(this).find('.item-discount').val(),
                                                                    'total': $(this).find('.item-total').val()
                                                                };

                                                                itemsData.push(item);
                                                            }
                                                        });

                                                        // Send data to the Django view using AJAX
                                                        $.ajax({
                                                            url: '/your_save_items_view_url/',
                                                            type: 'GET',
                                                            data: { 'items': itemsData },
                                                            success: function(response) {
                                                                console.log(response);
                                                            },
                                                            error: function(error) {
                                                                console.error(error);
                                                            }
                                                        });
                                                    });
                                                });

                                                       
                                                    </script>
                                                </div>

                                                 

                                                <div class="row ">
                                                    <div class="col-md-6 mt-4">
                                                        <label for="">Note</label>
                                                        <textarea name="Note" id="" class="form-control" cols="30" rows="5">{{purchase.note}}</textarea><br>
                                                        <input type="file" class="form-control" name="Document" id="">
                                                    </div>

                                                    <div class="col-md-1 mb-5"></div>

                                                    <div class="col-md-4 mb-3 m-md-5 p-4" style="background-color: rgba(22,37,50,255);border-radius: 5px;">
                                                        
                                                            <div class="row mb-3">
                                                                <div class="col-4 d-flex justify-content-start">
                                                                    <label style="color: white;" > Sub Total </label>
                                                                </div>
                                                                <div class="col-2 d-flex justify-content-center">
                                                                    <p>:</p>
                                                                </div>
                                                                <div class="col-md-6 d-flex justify-content-start">
                                                                    <input type="text" value="{{purchase.subtotal}}" name="subTotal" id="subTotal" class="form-control">
                                                                </div>
                                                            </div>
                                                            <div class="row mb-3" id="GST1">
                                                                <div class="col-4 d-flex justify-content-start" >
                                                                    <label style="color: white;" > CGST </label>
                                                                </div>
                                                                <div class="col-2 d-flex justify-content-center">
                                                                    <p>:</p>
                                                                </div>
                                                                <div class="col-md-6 d-flex justify-content-start">
                                                                    <input type="text" value="{{purchase.cgst}}" name="cgst" id="cgst" class="form-control">
                                                                </div>
                                                            </div>
                                                            <div class="row mb-3" id="GST2">
                                                                <div class="col-4 d-flex justify-content-start">
                                                                    <label style="color: white;" > SGST </label>
                                                                </div>
                                                                <div class="col-2 d-flex justify-content-center">
                                                                    <p>:</p>
                                                                </div>
                                                                <div class="col-md-6 d-flex justify-content-start">
                                                                    <input type="text" value="{{purchase.sgst}}" name="sgst" id="sgst" class="form-control">
                                                                </div>
                                                            </div>
                                                            <div id="ifIGST" class="row mb-3" >
                                                                <div class="col-4 d-flex justify-content-start">
                                                                    <label style="color: white;" > <span >IGST</span> </label>
                                                                </div>
                                                                <div class="col-2 d-flex justify-content-center">
                                                                    <p>:</p>
                                                                </div>
                                                                <div class="col-md-6 d-flex justify-content-start">
                                                                    <input type="text" value="{{purchase.igst}}" name="igstAmount" id="igstAmount" class="form-control">
                                                                </div>
                                                            </div>
                                                            <div class="row mb-3" >
                                                                <div class="col-4 d-flex justify-content-start">
                                                                    <label style="color: white;" > <span >Tax Amount</span> </label>
                                                                </div>
                                                                <div class="col-2 d-flex justify-content-center">
                                                                    <p>:</p>
                                                                </div>
                                                                <div class="col-md-6 d-flex justify-content-start">
                                                                    <input type="text" value="{{purchase.tax_amount}}" name="taxAmount" id="taxAmount" class="form-control">
                                                                </div>
                                                            </div>
                                                            <div class="row mb-3">
                                                                <div class="col-4 d-flex justify-content-start">
                                                                    <label style="color: white;" > Shipping Charge </label>
                                                                </div>
                                                                <div class="col-2 d-flex justify-content-center">
                                                                    <p>:</p>
                                                                </div>
                                                                <div class="col-md-6 d-flex justify-content-start">
                                                                    <input type="text" value="{{purchase.shipping_charge}}" oninput="updateSubTotal()" name="shippingCharge" id="shippingCharge" class="form-control">
                                                                </div>
                                                            </div>
                                                            <div class="row mb-3">
                                                                <div class="col-4 d-flex justify-content-start">
                                                                    <label style="color: white;" > Adjustment </label>
                                                                </div>
                                                                <div class="col-2 d-flex justify-content-center">
                                                                    <p>:</p>
                                                                </div>
                                                                <div class="col-md-6 d-flex justify-content-start">
                                                                    <input type="text" value="{{purchase.adjustment}}" oninput="updateSubTotal()" name="adjustment" id="adjustment" class="form-control">
                                                                </div>
                                                            </div>
                                                            <div class="row mb-3">
                                                                <div class="col-4 d-flex justify-content-start">
                                                                    <label style="color: white;" > Grand Total </label>
                                                                </div>
                                                                <div class="col-2 d-flex justify-content-center">
                                                                    <p>:</p>
                                                                </div>
                                                                <div class="col-md-6 d-flex justify-content-start">
                                                                    <input type="text" value="{{purchase.grandtotal}}" name="grandTotal" id="grandTotal" class="form-control">
                                                                </div>
                                                            </div>
                                                            
                                                            
                                                    </div>
                                                </div>

                                                    <div class="row">
                                                        <div class="col-md-6 mt-4"></div>
                                                        <div class="col-md-1 mb-5"></div>
                                                        <div class="col-md-4 mb-3 m-md-5 p-4" style="background-color: rgba(22,37,50,255);border-radius: 5px;">
                                                            <div class="row mb-3">
                                                                <div class="col-4 justify-content-start">
                                                                    <!-- <input type="checkbox" name="paid" id="paid" >  -->
                                                                    Paid
                                                                </div>
                                                                <div class="col-2 d-flex justify-content-center">
                                                                    <p>:</p>
                                                                </div>
                                                                <div class="col-md-6 d-flex justify-content-start">
                                                                    <input type="text" value="{{purchase.paid_off}}" oninput="updateSubTotal()" name="paidAmount" id="paidAmount" class="form-control">
                                                                </div>
                                                            </div>
                                                            <div class="row mb-3">
                                                                <div class="col-4 d-flex justify-content-start">
                                                                    <label style="color: white;" > Balance Due </label>
                                                                </div>
                                                                <div class="col-2 d-flex justify-content-center">
                                                                    <p>:</p>
                                                                </div>
                                                                <div class="col-md-6 d-flex justify-content-start"> 
                                                                    <input type="text" value="{{purchase.balance}}" name="balanceDue" id="balanceDue" class="form-control">
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>

                                                    <script>
                                                    

                                                        // Function to calculate and update the total for a row
                                                        function updateTotal(row) { 
                                                            var qty = parseFloat(row.querySelector('.item-qty').value) || 0;
                                                            var price = parseFloat(row.querySelector('.item-price').value) || 0;
                                                            var gst_tax = parseFloat(row.querySelector('.item-gst_tax').value) || 0;
                                                            var igst_tax = parseFloat(row.querySelector('.item-igst_tax').value) || 0;
                                                            var discount = parseFloat(row.querySelector('.item-discount').value) || 0;
                                                            var source = document.querySelector('.source_of_supply_vendor').value;
                                                            var place = document.getElementById('companyPlace').value;
                                                            
                                                            console.log('source',source)
                                                            console.log('place',place)
                                                            if (source === 'Kerala' && place === 'Kerala' && source !== '' && place !== ''){
                                                                var total = qty * price * (1 + gst_tax / 100) - discount;
                                                                var taxtotal = qty * price * (gst_tax / 100);
                                                                row.querySelector('.item-total').value = total.toFixed(2);
                                                                row.querySelector('.item-totaltax').value = taxtotal.toFixed(2);
                                                            }else if (source !== '' && place !== ''){
                                                                var total = qty * price * (1 + igst_tax / 100) - discount;
                                                                var taxtotal = qty * price * (igst_tax / 100);
                                                                row.querySelector('.item-total').value = total.toFixed(2);
                                                                row.querySelector('.item-totaltax').value = taxtotal.toFixed(2);
                                                            }else{
                                                                var total = qty * price - discount;
                                                                row.querySelector('.item-total').value = total.toFixed(2);
                                                                
                                                            }
                                                    
                                                            // Update only the grand total for the current row
                                                            
                                                            updateSubTotal();
                                                            
                                                        }

                                                    //     function updateSubTotal() {
                                                    //     var subTotal = 0;
                                                    //     var taxTotal = 0;
                                                    //     // Iterate over all rows and sum up the individual totals
                                                    //     var allRows = document.querySelectorAll('.item-row');
                                                    //     var source = document.querySelector('.source_of_supply_vendor').value;
                                                    //     var place = document.querySelector('.place_of_supply_customer').value;
                                                    //     var grandTotal = document.getElementById('grandTotal');
                                                    //     var shipping = parseFloat(document.getElementById('shippingCharge').value) || 0;
                                                    //     var adjustment = parseFloat(document.getElementById('adjustment').value) || 0;
                                                    //     var paid= parseFloat(document.getElementById('paidAmount').value) || 0;
                                                    //     var grandInput = document.getElementById('grandTotal');
                                                    //     var balanceInput = document.getElementById('balanceDue');

                                                    //     allRows.forEach(function (row) {
                                                    //         var rowTotal = parseFloat(row.querySelector('.item-total').value) || 0;
                                                    //         subTotal += rowTotal;
                                                    //         var rowTaxTotal = parseFloat(row.querySelector('.item-totaltax').value) || 0;
                                                    //         taxTotal += rowTaxTotal;
                                                    //     });

                                                    //     // Update the grand total in your HTML (replace 'your-grand-total-id' with the actual ID)
                                                    //     document.getElementById('subTotal').value = subTotal.toFixed(2);
                                                    //     if (source === place && source !== '' && place !== ''){
                                                    //         cgst = taxTotal/2.0;
                                                    //         document.getElementById('cgst').value = cgst.toFixed(2);
                                                    //         document.getElementById('sgst').value = cgst.toFixed(2);
                                                    //         document.getElementById('taxAmount').value = taxTotal.toFixed(2);
                                                    //     }else if (source !== place && source !== '' && place !== ''){
                                                    //         document.getElementById('taxAmount').value = taxTotal.toFixed(2);
                                                    //     }
                                                        
                                                    //     Gtotal = subTotal + shipping + adjustment ;
                                                    //     var balance = Gtotal - paid;
                                                    //     grandInput.value = Gtotal;
                                                    //     balanceInput.value = balance;
                                                        
                                                    // }

                                                    function updateSubTotal() {
                                                        var subTotal = 0;
                                                        var taxTotal = 0;

                                                        // Iterate over all rows and sum up the individual totals
                                                        var allRows = document.querySelectorAll('.item-row');
                                                        var source = document.querySelector('.source_of_supply_vendor').value;
                                                        var place = document.getElementById('companyPlace').value;
                                                        var grandTotalElement = document.getElementById('grandTotal');
                                                        var shipping = parseFloat(document.getElementById('shippingCharge').value) || 0;
                                                        var adjustment = parseFloat(document.getElementById('adjustment').value) || 0;
                                                        var paidAmountElement = document.getElementById('paidAmount');
                                                        var grandInput = document.getElementById('grandTotal');
                                                        var balanceInput = document.getElementById('balanceDue');

                                                        allRows.forEach(function (row) {
                                                            var rowTotal = parseFloat(row.querySelector('.item-total').value) || 0;
                                                            subTotal += rowTotal;
                                                            var rowTaxTotal = parseFloat(row.querySelector('.item-totaltax').value) || 0;
                                                            taxTotal += rowTaxTotal;
                                                        });

                                                        // Update the grand total in your HTML
                                                        document.getElementById('subTotal').value = subTotal.toFixed(2);

                                                        // Handle tax calculation based on source and place
                                                        if (source === 'Kerala' && place === 'Kerala' && source !== '' && place !== '') {
                                                            var cgst = taxTotal / 2.0;
                                                            document.getElementById('cgst').value = cgst.toFixed(2);
                                                            document.getElementById('sgst').value = cgst.toFixed(2);
                                                            document.getElementById('taxAmount').value = taxTotal.toFixed(2);
                                                        } else if (source !== '' && place !== '') {
                                                            document.getElementById('taxAmount').value = taxTotal.toFixed(2);
                                                            document.getElementById('igstAmount').value = taxTotal.toFixed(2);
                                                        }

                                                        // Calculate grand total, balance, and handle paid amount not exceeding grand total
                                                        var Gtotal = subTotal + shipping + adjustment;
                                                        var paidAmount = parseFloat(paidAmountElement.value) || 0;

                                                        if (paidAmount > Gtotal) {
                                                            // If paid amount exceeds grand total, set paid amount to zero
                                                            paidAmountElement.value = 0;
                                                            paidAmount = 0;  // Update the paidAmount variable accordingly
                                                            alert('Cannot be more than Grand Total')
                                                        }

                                                        var balance = Gtotal - paidAmount;
                                                        grandInput.value = Gtotal.toFixed(2);
                                                        balanceInput.value = balance.toFixed(2);
                                                    }

                                                    
                                                        // Function to initialize calculations on page start
                                                        function initializeCalculations() {
                                                            addIndexToTable()
                                                        var itemRows = document.querySelectorAll('.item-row');

                                                        itemRows.forEach(function (row) {
                                                            updateTotal(row);
                                                            attachInputEventListener(row);
                                                        });
                                                    }
                                                        // Attach event listener for input fields in the row
                                                        var itemRows = document.querySelectorAll('.item-row');
                                                        itemRows.forEach(function (itemRow) {
                                                            itemRow.addEventListener('input', function (event) {
                                                                if (event.target.classList.contains('item-qty') ||
                                                                    event.target.classList.contains('item-price') ||
                                                                    event.target.classList.contains('item-gst_tax') ||
                                                                    event.target.classList.contains('item-igst_tax') ||
                                                                    event.target.classList.contains('item-discount')) {
                                                                    updateTotal(itemRow);
                                                                }
                                                            });
                                                        });
                                                    
                                                        // Attach event listener for the "Add Row" button
                                                    //     function addRow() {
                                                    //     var clone = itemRows[0].cloneNode(true);
                                                    //     document.querySelector('tbody').appendChild(clone);

                                                    //     // Reset values for the new row
                                                    //     clone.querySelectorAll('input').forEach(function (input) {
                                                    //         input.value = 0;
                                                    //     });
                                                        
                                                    //     clone.querySelectorAll('.item-stockin').forEach(function (element) {
                                                    //         element.innerText = '0';
                                                    //     });

                                                    //     initializeCalculations();
                                                        
                                                    // }

                                                    function addRow() {
                                                    var defaultRow = document.querySelector('#table2 tr');
                                                    // Clone the default row HTML
                                                    var clone = defaultRow.cloneNode(true); // true to clone all child elements as well

                                                    // Append the cloned row to the tbody element
                                                    document.querySelector('#itemTable tbody').appendChild(clone); 

                                                    initializeCalculations();
                                                }

                                                    
                                                                                                        
                                                        // Attach event listener for the "Remove Row" button
                                                        
                                                        function removeRow(clickedButton) {
                                                        // Get the parent row of the clicked button
                                                        var rowToRemove = clickedButton.closest('.item-row');
                                                        
                                                        // Ensure the row to remove is not null
                                                        if (rowToRemove) {
                                                            // Remove the specified row from the DOM
                                                            rowToRemove.parentNode.removeChild(rowToRemove);

                                                            // Reinitialize event listeners for the remaining rows
                                                            itemRows = document.querySelectorAll('.item-row');
                                                            itemRows.forEach(function (itemRow) {
                                                                attachInputEventListener(itemRow);
                                                            });

                                                            // Perform any other necessary calculations or updates
                                                            initializeCalculations();
                                                            
                                                        } else {
                                                            // Alert if the provided row is null
                                                            alert("Invalid row to remove.");
                                                        }
                                                    }

                                                    function addIndexToTable() {
                                                    // Get the table element
                                                    var table = document.getElementById('itemTable');

                                                    // Get all rows in the table body
                                                    var rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

                                                    // Loop through each row and add an index number
                                                    for (var i = 0; i < rows.length; i++) {
                                                        // Update the index cell content
                                                        rows[i].cells[0].textContent = i + 1; // Assuming the index cell is the first cell (cells[0])
                                                    }
                                                }

                                                        function attachInputEventListener(row) {
                                                            row.addEventListener('input', function (event) {
                                                                if (event.target.classList.contains('item-qty') ||
                                                                    event.target.classList.contains('item-price') ||
                                                                    event.target.classList.contains('item-tax') ||
                                                                    event.target.classList.contains('item-discount')) {
                                                                    updateTotal(row);
                                                                }
                                                            });
                                                        }
                                 
                                                    
                                                        // Call initializeCalculations on page load
                                                        window.onload = function () {
                                                        initializeCalculations();

                                                        // Set up an interval to continuously check for changes
                                                         setInterval(function () {
                                                             itemRows.forEach(function (row) {
                                                                 updateTotal(row);
                                                             });
                                                         }, 1000);
                                                    };


                                                    
                                                    </script>
                                                    
                                                    
                                                

                                                <div class="row">
                                                    <input type="hidden" id="buttonClicked" name="button" value="">
                                                    <div class="col-md-7 mb-4"><input type="checkbox" required> Agree To Terms & Conditions.</div>
                                                    <div class="col-md-5 mb-4 ">
                                                        <div class="row">
                                                            <div class="col-md mb-3"><button type="submit" class="ml-2 btn btn-outline-secondary text-grey form-control " id="button1">CONVERT</button></div>
                                                            <div class="col-md mb-3"><button type="reset" class="ml-2 btn btn-outline-secondary text-grey form-control " id="button2" onclick="window.location.href=`{% url 'Fin_purchaseOrder' %}`">CANCEL</button></div>
                                                        </div>                                                        
                                                    </div>
                                                </div><br><br>



                                </div>   
                                </div>
                                </div>
                            </div>
                        </div>
                    </form>

<!---------------------------------- modals ------------------------------------------------->
    
                         <!-- New Repeat Every Modal -->
                                        
                         <div class="modal fade" id="RepeatEveryN">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content" style="background-color: #213b52;">
                                    <div class="modal-header">
                                        <h5 class="m-3">Add Repeat Every Duration</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="card p-3">
                                            <form method="post" id="newRepeatEveryForm">
                                                {% csrf_token %}
                                                <div class="row mt-2">
                                                    <div class="col-6">
                                                        <label for="name">Duration</label>
                                                        <input type="number" name="repeat_duration" min="0" step="any" id="repeatEveryDuration" class="form-control w-100">
                                                    </div>
                                                    <div class="col-6">
                                                        <label for="name">Type</label>
                                                        <select name="repeat_type" id="repeatEveryType" class="form-control w-100">
                                                            <option value="Month">Month</option>
                                                            <option value="Year">Year</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row mt-4">
                                                    <div class="col-4"></div>
                                                    <div class="col-4 d-flex justify-content-center">
                                                        <button class="btn btn-outline-secondary text-grey w-75" data-dismiss="modal" type="submit" id="saveRepeatEvery">Save</button>
                                                    </div>
                                                    <div class="col-4"></div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>   
                            </div>
                        </div>
                        <script>
                            $(document).on("click","#saveRepeatEvery",function(){
                            var duration = $('#repeatEveryDuration').val();
                            var type = $("#repeatEveryType").val();
                            if (! isNaN(duration) && type !=""){
                                $.ajax({
                                    type : 'POST',
                                    url:"{% url 'Fin_newRepeatEveryType' %}",
                                    data:{
                                        'duration' : duration,
                                        'type' : type,
                                        csrfmiddlewaretoken: '{{ csrf_token }}'
                                    },
                                    
                                    success: function(response) {
                                        if(response.status){
                                            document.getElementById("newRepeatEveryForm").reset();
                                            
                                            var dropdown = $('#RepeatEvery');
                                            dropdown.empty();
                                            dropdown.append(`<option value=""> Select Repeat Duration</option>`);
                                            $.each(response, function(key, value) {
                                                for(let i=0; i<value.length; i++){
                                                    if(value[i].repeat_every == (duration+" "+type).toString()){
                                                        dropdown.append($('<option selected></option>').text(value[i].repeat_every).val(value[i].id))
                                                    }else{
                                                        dropdown.append($('<option></option>').text(value[i].repeat_every).val(value[i].id))
                                                    }   
                                                }
                                            });
                                        }else{
                                            alert("Something went wrong.!")
                                        }
                                    },         
                                });
                            }
                            else{
                                alert('Invalid.!')
                            }
                        });
                        </script>
                        
                        <!-- repeat every end-->
                        
                                <!-- pterms modal -->
                                <div class="modal fade" id="newPaymentRe">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content" style="background-color: #213b52;">
                                            <div class="modal-header">
                                                <h5 class="m-3">New Payment Term</h5>
                                                <button type="button" class="close" onclick="$('#newPaymentRe').modal('hide')" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="card p-3">
                                                    <form method="PlaceOfSupplyCustomert" id="newTermForm1">
                                                        {% csrf_token %}
                                                        <div class="row mt-2">
                                                            <div class="col-6">
                                                                <label for="name">Term Name</label>
                                                                <input type="text" name="term_name" id="termName1" class="form-control w-100">
                                                            </div>
                                                            <div class="col-6">
                                                                <label for="name">Days</label>
                                                                <input type="number" name="days" id="termDays1" class="form-control w-100" min="0" step="1">
                                                            </div>
                                                        </div>
                                                        <div class="row mt-4">
                                                            <div class="col-4"></div>
                                                            <div class="col-4 d-flex justify-content-center">
                                                                <button class="btn btn-outline-secondary text-grey w-75" data-dismiss="modal" type="submit" id="paymentTermSaveNormal">Save</button>
                                                            </div>
                                                            <div class="col-4"></div>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>   
                                    </div>
                                </div>
                                
                                
                               
                                <script>
                                   $(document).on("click", "#paymentTermSaveNormal", function () {
                                    var trm = $('#termName1').val();
                                    var dys = $("#termDays1").val();
                                    
                                    if (trm !== "" && dys !== "") {
                                        $.ajax({
                                            type: 'POST',
                                            data: {
                                                'term_name': trm,
                                                'days': dys,
                                                csrfmiddlewaretoken: '{{ csrf_token }}'
                                            },
                                            url: '/Fin_new_payment_terms_recurring',
                                            success: function (response) {
                                                
                                                    document.getElementById("newTermForm1").reset();

                                                    var dropdown = $('#paymentTermsCustomer');                                    
                                                    $.each(response.terms, function (index, term) {
                                                        dropdown.append($('<option selected></option>').text(term.term_name).val(term.id))
                                                    });

                                                    var dropdown1 = $('#termadd2');
                                                    $.each(response.terms, function (index, term) {
                                                        dropdown1.append($('<option selected></option>').text(term.term_name).val(term.id))
                                                    });

                                                    var dropdown2 = $('#paymentTerms');
                                                    $.each(response.terms, function (index, term) {
                                                        dropdown2.append($('<option selected></option>').text(term.term_name).val(term.id))
                                                    });

                                                    alert('successfully added')
                                                
                                            },
                                        });
                                    } else {
                                        alert('Invalid');
                                    }
                                });

                                  </script>
                                <!-- paymentTermsModal end -->

                    
<!-- Modal vendor-->
<div class="modal fade" id="vendorModal">
    <div class="modal-dialog modal-lg" style="max-width: 1000px;" >
        <div class="modal-content" style="background-color: #213b52;">
            <div class="modal-header">
          <h5 class="modal-title" id="vendorModalLongTitle">ADD VENDORS</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            
            <div class="page-content">
                
                <div class="card radius-15" style="background-color: #243e54;">
                    <div class="card-body">
                        <div class="card-title">
                            <h4 class="mb-0">Vendor Details</h4>
                        </div>
                        <hr/>
                        <form method="post" id="vendorForm" class="needs-validation">
                            {% csrf_token %}
                                <div class="row mt-3">
                                    <div class="col-md-3">
                                        <label for="title">Title</label>
                                        <select name="title" id="title" class="form-control">
                                            <option value="Mr">Mr</option>
                                            <option value="Mrs">Mrs</option>
                                            <option value="Ms">Ms</option>
                                            <option value="Dr">Dr</option>
                                        </select>
                                        <div class="valid-feedback">Looks good!</div>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="firstName">First Name</label>
                                        <input type="text" class="form-control" id="firstName" name="first_name" required style="background-color: #43596c;color: white;">
                                        <div class="valid-feedback">Looks good!</div>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="lastName">Last Name</label>
                                        <input type="text" class="form-control" id="lastName" name="last_name" required style="background-color: #43596c;color: white;">
                                        <div class="valid-feedback">Looks good!</div>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="companyName">Company</label>
                                        <input type="text" class="form-control" id="companyName" name="company_name" style="background-color: #43596c;color: white;">
                                        <div class="valid-feedback">Looks good!</div>
                                    </div>
                                </div>
            
                                <div class="row mt-3">
                                    <div class="col-md-3">
                                        <label for="location">Location</label>
                                        <input type="text" class="form-control" id="location" name="location" style="background-color: #43596c;color: white;">
                                        <div class="valid-feedback">Looks good!</div>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="vendorEmail">Email</label>
                                        <input type="email" class="form-control" required id="vendorEmail" name="email" onchange="checkEmail(this)" style="background-color: #43596c;color: white;" placeholder="finsys@gmail.com">
                                        <div class="invalid-feedback">Please provide a valid Email</div>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="vendorWebsite">Website</label>
                                        <input type="text" class="form-control" id="vendorWebsite" placeholder="www.finsys.com" onchange="checkWebsite(this)" name="website" style="background-color: #43596c;color: white;">
                                        <div id="warnweb" class="text-danger"></div>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="vendorMobile">Mobile</label>
                                        <input type="text" class="form-control" id="vendorMobile" required onchange="checkPhone(this)" name="mobile" style="background-color: #43596c;color: white;">
                                        <div class="text-danger m-2" id="warnphone"></div>
                                    </div>
                                </div>
            
                                <hr>
                                <h4>Other Options</h4>
                                <hr>
            
                                <div class="row mt-3">
                                    <div class="col-md-3">
                                        <label for="gstTypeVen">GST Type</label>
                                        <select class="form-control" id="gstTypeVen" name="gst_type" onclick="toggleGSTIN('gstInValue', this)" style="background-color: #43596c; color: white;" required>
                                            <option selected value="">Select GST Type</option>
                                            <option value="Registered Business - Regular">Registered Business - Regular <span><i>(Business that is registered under gst)</i></span></option>
                                            <option value="Registered Business - ComPlaceOfSupplyCustomerition">Registered Business - ComPlaceOfSupplyCustomerition (Business that is registered under comPlaceOfSupplyCustomerition scheme in gst)</option>
                                            <option value="Unregistered Business">Unregistered Business (Business that has not been registered under gst)</option>
                                            <option value="Overseas">Overseas (Import/Export of supply outside india)</option>
                                            <option value="Consumer">Consumer</option>
                                            <option value="Special Economic Zone (SEZ)">Special Economic Zone (SEZ) (Business that is located in a special economic zone of india or a SEZ developer)</option>
                                            <option value="Demed Exports">Demed Exports (Supply of woods to an exports oriented unit or againsed advanced authorization or export promotion capital woods)</option>
                                            <option value="Tax Deductor">Tax Deductor (State of central gov,government agencies or local authority)</option>
                                            <option value="SEZ Developer">SEZ Developer (A person or organization who owns atleast 26% equality in creating business units in special economic zone)</option>
                                        </select>
                                        <div class="invalid-feedback">Please select a valid registration type.</div>
                                    </div>
            
                                    <div class="col-md-3 gstrow d-block" id="gstInValue">
                                        <div>
                                            <label for="gstIN">GSTIN</label>
                                            <input type="text" class="form-control" onchange="checkGSTIN(this)" id="gstIN" name="gstin" style="background-color: #43596c;color: white;" placeholder="29APPCK7465F1Z1">
                                            <a data-toggle="modal" href="#exampleModal" style="color:#3dd5f3">Get Taxpayer Details</a>
                                            <div class="text-danger m-2" id="warngst"></div>
                                        </div>
                                    </div>
            
                                    <div class="col-md-3">
                                        <label for="panNo">PAN No.</label>
                                        <input type="text" class="form-control" id="panNo" name="pan_no" style="background-color: #43596c;color: white;" required onchange="checkPAN(this)" placeholder="APPCK7465F">
                                        <div class="text-danger m-2" id="warnpan"></div>
                                    </div>
            
                                    <div class="col-md-3">
                                        <label for="placeOfSupply">Place of Supply</label>
                                        <select class="custom-select form-control" id="placeOfSupply" name="place_of_supply" style="background-color: #43596c; color: white;" required>
                                            <option selected value="">Select Place of Supply</option>
                                            <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islands</option>
                                            <option value="Andhra Predhesh">Andhra Predhesh</option>
                                            <option value="Arunachal Predesh">Arunachal Predesh</option>
                                            <option value="Assam">Assam</option>
                                            <option value="Bihar">Bihar</option>
                                            <option value="Chandigarh">Chandigarh</option>
                                            <option value="Chhattisgarh">Chhattisgarh</option>
                                            <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                            <option value="Damn anad Diu">Damn anad Diu</option>
                                            <option value="Delhi">Delhi</option>
                                            <option value="Goa">Goa</option>
                                            <option value="Gujarat">Gujarat</option>
                                            <option value="Haryana">Haryana</option>
                                            <option value="Himachal Predesh">Himachal Predesh</option>
                                            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                            <option value="Jharkhand">Jharkhand</option>
                                            <option value="Karnataka">Karnataka</option>
                                            <option value="Kerala">Kerala</option>
                                            <option value="Ladakh">Ladakh</option>
                                            <option value="Lakshadweep">Lakshadweep</option>
                                            <option value="Madhya Predesh">Madhya Predesh</option>
                                            <option value="Maharashtra">Maharashtra</option>
                                            <option value="Manipur">Manipur</option>
                                            <option value="Meghalaya">Meghalaya</option>
                                            <option value="Mizoram">Mizoram</option>
                                            <option value="Nagaland">Nagaland</option>
                                            <option value="Odisha">Odisha</option>
                                            <option value="Puducherry">Puducherry</option>
                                            <option value="Punjab">Punjab</option>
                                            <option value="Rajasthan">Rajasthan</option>
                                            <option value="Sikkim">Sikkim</option>
                                            <option value="Tamil Nadu">Tamil Nadu</option>
                                            <option value="Telangana">Telangana</option>
                                            <option value="Tripura">Tripura</option>
                                            <option value="Uttar Predesh">Uttar Predesh</option>
                                            <option value="Uttarakhand">Uttarakhand</option>
                                            <option value="West Bengal">West Bengal</option>
                                            <option value="Other Territory">Other Territory</option>
                                        </select>
                                        <div class="invalid-feedback">Please select a valid registration type.</div>
                                    </div>
            
                                </div>
            
                                <div class="row">
                                    <div class="col-md-3 mt-3">
                                        <label for="">Currency</label>
                                        <select name="currency" id="currency" class="form-control">
                                            <option value="INR - Indian Rupee">INR - Indian Rupee</option>
                                        </select>
                                    </div>
            
                                    <div class="col-md-3 mt-3">
                                        <label for="">Opening Balance</label>
                                        <div class="d-flex">
                                            <select name="balance_type" id="bal_type" class="form-select text-white mr-1" style="background-color: #243e54; border-radius: 5px;">
                                                <option value="credit">Credit</option>
                                                <option value="debit">Debit</option>
                                            </select>
                                            <input type="text" class="form-control" name="open_balance" id="openbalance" step="any" style="background-color: #43596c;color: white;">
                                            <div class="text-danger m-2" ></div>
                                        </div>
                                    </div>
            
                                    <div class="col-md-3 mt-3">
                                        <label for="creditLimit">Credit Limit</label>
                                        <input type="text" class="form-control" name="credit_limit" style="background-color: #43596c;color: white;" value="0" step="any" id="creditLimit">
                                        <div class="text-danger m-2" ></div>
                                    </div>
            
                                    <div class="col-md-3 mt-3">
                                        <label for="paymentTerms">Payment Terms</label>
                                        <div class="d-flex">
                                            <select name="payment_terms" id="paymentTerms" class="form-control">
                                                <option value="" selected>Choose</option>
                                                {% for p in pTerms %}
                                                <option value="{{p.id}}">{{p.term_name}}</option>
                                                {% endfor %}
                                            </select>
                                            <a data-target="#newPaymentTerm" onclick="$('#newPaymentTerm').modal('show');" data-toggle="modal" class="btn btn-outline-secondary ml-1">+</a>
                                        </div>
                                    </div>
            
                                    <div class="col-md-3 mt-3">
                                        <label for="priceList">Price List</label>
                                        <select name="price_list" id="priceList" class="form-control">
                                            <option value="" selected>Choose</option>
                                            {% for l in list %}
                                            <option value="{{l.id}}">{{l.name}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
            
                                <hr>
                                <div class="row mt-5">
                                    <div class="col-md-6">
                                        <div class="row">
                                            <div class="col-md-12 card-title">
                                                <h5 class="mb-0">Billing Address</h5>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mt-3">
                                                <div class="form-row">
                                                    <label for="street">Street</label>
                                                    <textarea class="form-control street" required id="street" name="street" style="background-color: #43596c;color: white;"></textarea>
                                                    <div class="invalid-feedback">Please provide a valid Street</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="city">City</label>
                                                    <input type="text" class="form-control" required id="city" name="city" style="background-color: #43596c;color: white;" placeholder="City">
                                                    <div class="invalid-feedback">Please provide a valid City</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="state">State</label>
                                                    <select type="text" class="form-control" id="state" name="state" required style="background-color: #43596c; color: white;">
                                                        <option value="" selected hidden>Choose</option>
                                                        <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islands</option>
                                                        <option value="Andhra Predhesh">Andhra Predhesh</option>
                                                        <option value="Arunachal Predesh">Arunachal Predesh</option>
                                                        <option value="Assam">Assam</option>
                                                        <option value="Bihar">Bihar</option>
                                                        <option value="Chandigarh">Chandigarh</option>
                                                        <option value="Chhattisgarh">Chhattisgarh</option>
                                                        <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                        <option value="Damn anad Diu">Damn anad Diu</option>
                                                        <option value="Delhi">Delhi</option>
                                                        <option value="Goa">Goa</option>
                                                        <option value="Gujarat">Gujarat</option>
                                                        <option value="Haryana">Haryana</option>
                                                        <option value="Himachal Predesh">Himachal Predesh</option>
                                                        <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                        <option value="Jharkhand">Jharkhand</option>
                                                        <option value="Karnataka">Karnataka</option>
                                                        <option value="Kerala">Kerala</option>
                                                        <option value="Ladakh">Ladakh</option>
                                                        <option value="Lakshadweep">Lakshadweep</option>
                                                        <option value="Madhya Predesh">Madhya Predesh</option>
                                                        <option value="Maharashtra">Maharashtra</option>
                                                        <option value="Manipur">Manipur</option>
                                                        <option value="Meghalaya">Meghalaya</option>
                                                        <option value="Mizoram">Mizoram</option>
                                                        <option value="Nagaland">Nagaland</option>
                                                        <option value="Odisha">Odisha</option>
                                                        <option value="Puducherry">Puducherry</option>
                                                        <option value="Punjab">Punjab</option>
                                                        <option value="Rajasthan">Rajasthan</option>
                                                        <option value="Sikkim">Sikkim</option>
                                                        <option value="Tamil Nadu">Tamil Nadu</option>
                                                        <option value="Telangana">Telangana</option>
                                                        <option value="Tripura">Tripura</option>
                                                        <option value="Uttar Predesh">Uttar Predesh</option>
                                                        <option value="Uttarakhand">Uttarakhand</option>
                                                        <option value="West Bengal">West Bengal</option>
                                                        <option value="Other Territory">Other Territory</option>
                                                    </select>
                                                    <div class="invalid-feedback">Please provide a valid State</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="pinco">Pin Code</label>
                                                    <input type="text" class="form-control" required id="pinco" name="pincode" style="background-color: #43596c;color: white;" placeholder="PIN code">
                                                    <div class="invalid-feedback">Please provide a valid Pin Code</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="country">Country</label>
                                                    <input type="text" class="form-control" required id="country" name="country" style="background-color: #43596c;color: white;" placeholder="Country">
                                                    <div class="invalid-feedback">Please provide a valid Country</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row">
                                            <div class="col-md-12 d-flex">
                                                <h5>Shipping Address</h5>
                                                <input class="ml-4 ml-5" type="checkbox" onclick="placeShipAddress()" id="shipAddress" name="ship_address">
                                                <label class="ml-2 mt-1 ml-2" for="shipAddress">Same As Billing Address</label>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mt-3">
                                                <div class="form-row">
                                                    <label for="shipstreet">Street</label>
                                                    <textarea class="form-control" id="shipstreet" name="shipstreet" style="background-color: #43596c;color: white;"></textarea>
                                                    <div class="invalid-feedback">Please provide a valid Street</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="shipcity">City</label>
                                                    <input type="text" class="form-control" id="shipcity" name="shipcity" style="background-color: #43596c;color: white;" placeholder="City">
                                                    <div class="invalid-feedback">Please provide a valid City</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="shipstate">State</label>
                                                    <select type="text" class="form-control" id="shipState" name="shipstate" style="background-color: #43596c; color: white;">
                                                        <option value="" selected>Choose</option>
                                                        <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islands</option>
                                                        <option value="Andhra Predhesh">Andhra Predhesh</option>
                                                        <option value="Arunachal Predesh">Arunachal Predesh</option>
                                                        <option value="Assam">Assam</option>
                                                        <option value="Bihar">Bihar</option>
                                                        <option value="Chandigarh">Chandigarh</option>
                                                        <option value="Chhattisgarh">Chhattisgarh</option>
                                                        <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                        <option value="Damn anad Diu">Damn anad Diu</option>
                                                        <option value="Delhi">Delhi</option>
                                                        <option value="Goa">Goa</option>
                                                        <option value="Gujarat">Gujarat</option>
                                                        <option value="Haryana">Haryana</option>
                                                        <option value="Himachal Predesh">Himachal Predesh</option>
                                                        <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                        <option value="Jharkhand">Jharkhand</option>
                                                        <option value="Karnataka">Karnataka</option>
                                                        <option value="Kerala">Kerala</option>
                                                        <option value="Ladakh">Ladakh</option>
                                                        <option value="Lakshadweep">Lakshadweep</option>
                                                        <option value="Madhya Predesh">Madhya Predesh</option>
                                                        <option value="Maharashtra">Maharashtra</option>
                                                        <option value="Manipur">Manipur</option>
                                                        <option value="Meghalaya">Meghalaya</option>
                                                        <option value="Mizoram">Mizoram</option>
                                                        <option value="Nagaland">Nagaland</option>
                                                        <option value="Odisha">Odisha</option>
                                                        <option value="Puducherry">Puducherry</option>
                                                        <option value="Punjab">Punjab</option>
                                                        <option value="Rajasthan">Rajasthan</option>
                                                        <option value="Sikkim">Sikkim</option>
                                                        <option value="Tamil Nadu">Tamil Nadu</option>
                                                        <option value="Telangana">Telangana</option>
                                                        <option value="Tripura">Tripura</option>
                                                        <option value="Uttar Predesh">Uttar Predesh</option>
                                                        <option value="Uttarakhand">Uttarakhand</option>
                                                        <option value="West Bengal">West Bengal</option>
                                                        <option value="Other Territory">Other Territory</option>
                                                    </select>
                                                    <div class="invalid-feedback">Please provide a valid State</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="shippinco">Pin Code</label>
                                                    <input type="text" class="form-control" id="shippinco" name="shippincode" style="background-color: #43596c;color: white;" placeholder="PIN code">
                                                    <div class="invalid-feedback">Please provide a valid Pin Code</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="shipcountry">Country</label>
                                                    <input type="text" class="form-control" id="shipcountry" name="shipcountry" style="background-color: #43596c;color: white;" placeholder="Country">
                                                    <div class="invalid-feedback">Please provide a valid Country</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="" id="agreeTerms" required style="background-color: #43596c;">
                                            <label for="agreeTerms">Agree to Terms and Conditions</label>
                                            <div class="invalid-feedback">You must agree before submitting.</div>
                                        </div>
                                    </div>
                                </div>
            
                                <div class="row mt-5 mb-5">
                                    <div class="col-md-4">
                                    </div>
                                    <div class="col-md-4 d-flex justify-content-center">
                                        <button class="btn btn-outline-secondary w-50 text-light" type="submit">SAVE</button>
                                        
                                    </div>
                                    <div class="col-md-4"></div>
                                </div>
                        </form>
                        <script>
                            $(document).ready(function() {
                            $("#vendorForm").submit(function(e) {
                                e.preventDefault();

                                var formData = $(this).serialize(); // Serialize form data

                                $.ajax({
                                    type: "POST",
                                    url: "{% url 'Fin_createVendor_modal' %}",
                                    data: formData,
                                    dataType: "json",  // Expect JSON response
                                    success: function(response) {
                                        if (response.success) {
                                            alert('Vendor created successfully!');

                                            // Update dropdown with the newly created vendor
                                            var dropdown = $('.vendorDropdown');
                                            
                                            // Add each vendor from the response to the dropdown
                                            $.each(response.vendors, function(index, vendor) {
                                            // Assuming each vendor has properties 'first_name', 'last_name', and 'id'
                                            var fullName = vendor.first_name + ' ' + vendor.last_name;
                                            newVen = $('<a class="dropdown-item drop1" style="text-transform: uppercase;" ></a>').addClass('').attr('value', vendor.id).text(fullName);
                                            dropdown.append(newVen);
                                            $('#vendorModal').modal('hide');
                                            $("#vendorForm").reset();
                                        });
                                        } else {
                                            alert(response.msg);
                                        }
                                    },
                                    error: function(xhr, errmsg, err) {
                                        alert("Error occurred: " + errmsg);
                                    }
                                });
                            });
                        });
                            </script>
                    </div>
                </div>
            </div>
            
            
            <!-- payment term, Modal -->
            
            <div class="modal fade" id="newPaymentTerm">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content" style="background-color: #213b52;">
                        <div class="modal-header">
                            <h5 class="m-3">New Payment Term</h5>
                            <button type="button" class="close" onclick="$('#newPaymentTerm').modal('hide');$('#vendorModal').modal('show')" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="card p-3">
                                <form method="PlaceOfSupplyCustomert" id="newTermForm">
                                    {% csrf_token %}
                                    <div class="row mt-2">
                                        <div class="col-6">
                                            <label for="name">Term Name</label>
                                            <input type="text" name="term_name" id="termName" class="form-control w-100">
                                        </div>
                                        <div class="col-6">
                                            <label for="name">Days</label>
                                            <input type="number" name="days" id="termDays" class="form-control w-100" min="0" step="1">
                                        </div>
                                    </div>
                                    <div class="row mt-4">
                                        <div class="col-4"></div>
                                        <div class="col-4 d-flex justify-content-center">
                                            <button class="btn btn-outline-secondary text-grey w-75" data-dismiss="modal" id="savePaymentTerm">Save</button>
                                        </div>
                                        <div class="col-4"></div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>   
                </div>
            </div>
            
            
            
            
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
            <script>
                function placeShipAddress() {
                    var chkbtn = document.getElementById('shipAddress');
                    if (chkbtn.checked == true) {
                        document.getElementById('shipstreet').value = document.getElementById('street').value;
                        document.getElementById('shipcity').value = document.getElementById('city').value;
                        document.getElementById('shippinco').value = document.getElementById('pinco').value;
                        document.getElementById('shipcountry').value = document.getElementById('country').value;
                        document.getElementById('shipState').value = document.getElementById('state').value;
                    } else {
                        document.getElementById('shipstreet').value = '';
                        document.getElementById('shipcity').value = '';
                        document.getElementById('shippinco').value = '';
                        document.getElementById('shipcountry').value = '';
                        document.getElementById('shipState').value = '';
                        
                    }
                }
            
                $(document).on("click","#savePaymentTerm",function(){
                    var trm = $('#termName').val();
                    var dys = $("#termDays").val();
                    if (trm !="" && dys !=""){
                        $.ajax({
                            type : 'POST',
                            url:'/Fin_new_payment_terms_recurring',
                            data:{
                                'term_name' : trm,
                                'days' : dys,
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            
                            success: function(response) {
                                    document.getElementById("newTermForm").reset();
                                    
                                    var dropdown = $('#paymentTermsCustomer');                                    
                                    $.each(response.terms, function (index, term) {
                                        dropdown.append($('<option></option>').text(term.term_name).val(term.id))
                                    });

                                    var dropdown1 = $('#termadd2');
                                    $.each(response.terms, function (index, term) {
                                        dropdown1.append($('<option></option>').text(term.term_name).val(term.id))
                                    });

                                    var dropdown2 = $('#paymentTerms');
                                    $.each(response.terms, function (index, term) {
                                        dropdown2.append($('<option selected></option>').text(term.term_name).val(term.id))
                                    });

                                    alert('successfully added')
                            },         
                        });
                    }
                    else{
                        alert('Invalid')
                    }
                });
            
                // function toggleGSTIN(divId, element) {
                //     if (element.value == 'GST-registered-Regular'  || element.value == 'Consumer' || element.value == 'Overseas') {
                //         document.getElementById(divId).style.display = 'block';
                //     } else {
                //         document.getElementById(divId).style.display = 'none';
                //         document.getElementById("gstIN").value = '';
                //     }
                // }
            
                $(document).ready(function() {
                    $("#gstTypeVen").change(function() {
                        var x=$('#gstTypeVen').val();
                        if(x == "Unregistered Business" || x == 'Overseas' || x == 'Consumer'){
                            $(".gstrow").removeClass('d-block');
                            $(".gstrow").addClass('d-none');
                            $('#gstIN').prop('required',false);
                        }else {
                            $('#gstIN').prop('required',true);
                            $(".gstrow").removeClass('d-none');
                            $(".gstrow").addClass('d-block');
                        }
                    });
                });
            
                    
                function showMessage(input) {
                    const gstin = input.value;
            
                    if (gstin.length === 15) {
                        // document.getElementById("message").textContent = "Please wait, validating GSTIN format...";
                        setTimeout(() => checkGSTIN(input), 1000);  // Wait for a second and then validate GSTIN
                    } else {
                        document.getElementById("message").textContent = "";
                    }
                }
            
                
            
            
                function checkGSTIN(element) {
                    var gstinput = element.value;
                    var gstregexp = "[0-9]{2}[a-zA-Z]{5}[0-9]{4}[a-zA-Z]{1}[1-9A-Za-z]{1}[Z]{1}[0-9a-zA-Z]{1}";
            
                    if (gstinput.length === 15) {
                        if (gstinput.match(gstregexp)) {
                            document.getElementById('warngst').innerHTML = '';
                            checkVendorGSTIN(gstinput)
                        } else {
                            document.getElementById('warngst').innerHTML = 'Please provide a valid GST Number';
                            alert('Please provide a valid GST Number');
                        }
                    }
                        else {
                        document.getElementById('warngst').innerHTML = 'Please provide a valid GST Number';
                        alert('Please provide a valid GST Number');
                    }
                }
            
                function checkPAN(element) {
                    var paninput = element.value;
                    var panregexp = ["[a-zA-Z]{5}[0-9]{4}[a-zA-Z]{1}"]
                    if (paninput.match(panregexp)) {
                        document.getElementById('warnpan').innerHTML = '';
                        checkVendorPAN(paninput)
                    } else {
                        document.getElementById('warnpan').innerHTML = 'Please provide a valid PAN Number';
                        alert('Please provide a valid PAN Number')
                    }
                }
            
                function checkWebsite(element) {
                    var webinput = element.value;
                    var webregexp = "www."
                    if (webinput.startsWith(webregexp)) {
                        document.getElementById('warnweb').innerHTML = '';
                    } else {
                        document.getElementById('warnweb').innerHTML = 'Please provide a valid Website Address';
                        alert('Please provide a valid Website Address')
                    }
                }
            
                function checkPhone(element) {
                    var phoneinput = element.value;
                    var phoneregexp = /^\d{10}$/;
                    if (phoneinput.match(phoneregexp)) {
                        document.getElementById('warnphone').innerHTML = '';
                        checkVendorPhone(phoneinput)
                    } else {
                        document.getElementById('warnphone').innerHTML = 'Please provide a valid Phone Number';
                        alert('Please provide a valid Phone Number')
                    }
                }
            
                function checkEmail(element) {
                    var emailinput = element.value;
                    var emailregexp = /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/;
                    if (emailinput.match(emailregexp)) {
                        document.getElementById('warnemail').innerHTML = '';
                        checkVendorEmail(emailinput)
                    } else {
                        document.getElementById('warnemail').innerHTML = 'Please provide a valid Email ID';
                        alert('Please provide a valid Email id')
                    }
                }
            
                // (function () {
                //     'use strict';
                //     window.addEventListener('load', function () {
                //         // Fetch all the forms we want to apply custom Bootstrap validation styles to
                //         var forms = document.getElementsByClassName('needs-validation');
                //         // Loop over them and prevent submission
                //         var validation = Array.prototype.filter.call(forms, function (form) {
                //             form.addEventListener('submit', function (event) {
                //                 if (form.checkValidity() === false) {
                //                     event.preventDefault();
                //                     event.stopPropagation();
                //                 }
                //                 form.classList.add('was-validated');
                //             }, false);
                //         });
                //     }, false);
                // })();
            
                $(document).on('change', '#openbalance',function () {
                    openbal = $("#openbalance").val()
                    if($('#bal_type').val()=='credit'){
                        if(openbal.slice(0,1) != '-'){
                            if(parseFloat(openbal) != 0){
                                document.getElementById("openbalance").value = "-"+openbal
                            }else{
                                document.getElementById("openbalance").value = openbal
                            }
                        }else{
                            if(parseFloat(openbal) != 0){
                                document.getElementById("openbalance").value = openbal
                            }else{
                                document.getElementById("openbalance").value = -1 * parseFloat(openbal)
                            }
                        }
                    }else{
                        document.getElementById("openbalance").value = openbal
                    }
                });
            
                $(document).on('change', '#bal_type',function () {
                    openbal = $("#openbalance").val()
                    if(openbal != ""){
                        if($('#bal_type').val()=='credit'){
                            openbal = $("#openbalance").val()
                            if (parseFloat(openbal) != 0){
                                document.getElementById("openbalance").value = "-"+openbal
                            }else{
                                document.getElementById("openbalance").value = openbal
                            }
                        }else{
                            openbal = $("#openbalance").val()
                            document.getElementById("openbalance").value = -1*(parseFloat(openbal))
                        }
                    }
                });
            
                $(document).ready(function(){
                    $('#lastName').on('change',()=>{
                        var fName = $('#firstName').val().replace(/\d/g, '');
                        var lName = $('#lastName').val().replace(/\d/g, '');
                        if(fName !="" && lName !=""){
                            checkVendorName(fName,lName)
                        }else{
                            alert('Please enter a valid Full Name.!')
                            return false
                        }
                    });
            
                    $('#firstName').on('change',()=>{
                        var fName = $('#firstName').val().replace(/\d/g, '');
                        var lName = $('#lastName').val().replace(/\d/g, '');
                        if(fName !="" && lName !=""){
                            checkVendorName(fName,lName)
                        }else if(fName == "" && lName !=""){
                            alert('Please enter a valid First Name.!')
                        }
            
                    })
                });
            
                function checkVendorName(fname,lname){
                    if (fname != "" && lname !=""){
                        $.ajax({
                            type : 'PlaceOfSupplyCustomerT',
                            url:"{% url 'Fin_checkVendorName' %}",
                            data:{
                                'fname' : fname,
                                'lname' : lname,
            
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            
                            success: function(response) {
                                if(response.is_exist){
                                    alert(response.message)
                                }
                            },         
                        });
                    }
                }
            
                function checkVendorGSTIN(gstin){
                    var gstNo = gstin;
                    if (gstNo != ""){
                        $.ajax({
                            type : 'PlaceOfSupplyCustomerT',
                            url:"{% url 'Fin_checkVendorGSTIN' %}",
                            data:{
                                'gstin' : gstNo,
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            
                            success: function(response) {
                                if(response.is_exist){
                                    alert(response.message)
                                }
                            },         
                        });
                    }
                }
            
                function checkVendorPAN(pan){
                    var panNo = pan;
                    if (panNo != ""){
                        $.ajax({
                            type : 'PlaceOfSupplyCustomerT',
                            url:"{% url 'Fin_checkVendorPAN' %}",
                            data:{
                                'pan' : panNo,
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            
                            success: function(response) {
                                if(response.is_exist){
                                    alert(response.message)
                                }
                            },         
                        });
                    }
                }
            
                function checkVendorPhone(phone){
                    var phoneNo = phone;
                    if (phoneNo != ""){
                        $.ajax({
                            type : 'PlaceOfSupplyCustomerT',
                            url:"{% url 'Fin_checkVendorPhone' %}",
                            data:{
                                'phone' : phoneNo,
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            
                            success: function(response) {
                                if(response.is_exist){
                                    alert(response.message)
                                }
                            },         
                        });
                    }
                }
            
                function checkVendorEmail(email){
                    var vendorEmail = email;
                    if (vendorEmail != ""){
                        $.ajax({
                            type : 'PlaceOfSupplyCustomerT',
                            url:"{% url 'Fin_checkVendorEmail' %}",
                            data:{
                                'email' : vendorEmail,
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            
                            success: function(response) {
                                if(response.is_exist){
                                    alert(response.message)
                                }
                            },         
                        });
                    }
                }
            </script>
            
            
        </div>
        <!-- <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div> -->
      </div>
    </div>
  </div>
<!-- modal vendor end -->


<!-- modal customer -->
<div class="modal fade" id="customerModal">
    <div class="modal-dialog modal-lg" style="max-width: 1000px;" role="document">
        <div class="modal-content" style="background-color: #213b52;">
            <div class="modal-header">
          <h5 class="modal-title" id="customerModalTitle">ADD CUSTOMER</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            
            
            
            <div class="page-content">
                
                <div class="card radius-15" style="background-color: #243e54;">
                    <div class="card-body">
                        <div class="card-title">
                            <h4 class="mb-0">Customer Information</h4>
                        </div>
                        <hr/>
                        <form method="post" id="customerForm" class="needs-validation">
                            {% csrf_token %}
            
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <label for="title">Title</label>
                                        <select name="title" id="title" class="form-control">
                                            <option value="Mr">Mr</option>
                                            <option value="Mrs">Mrs</option>
                                            <option value="Miss">Miss</option>
                                            <option value="Ms">Ms</option>
                                        </select>
                                        <div class="valid-feedback">Looks good!</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="firstName">First Name</label>
                                        <input type="text" class="form-control" id="firstName" name="first_name" required style="background-color: #43596c;color: white;">
                                        <div class="valid-feedback">Looks good!</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="lastName">Last Name</label>
                                        <input type="text" class="form-control" id="lastName" name="last_name" required style="background-color: #43596c;color: white;">
                                        <div class="valid-feedback">Looks good!</div>
                                    </div>
                                </div>
            
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <label for="companyName">Company</label>
                                        <input type="text" class="form-control" id="companyName" name="company_name" style="background-color: #43596c;color: white;">
                                        <div class="valid-feedback">Looks good!</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="location">Location</label>
                                        <input type="text" class="form-control" id="location" name="location" style="background-color: #43596c;color: white;">
                                        <div class="valid-feedback">Looks good!</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="placeOfSupply">Place of Supply</label>
                                        <select class="custom-select form-control" id="placeOfSupply" name="place_of_supply" style="background-color: #43596c; color: white;" required>
                                            <option selected value="">Select Place of Supply</option>
                                            <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islands</option>
                                            <option value="Andhra Predhesh">Andhra Predhesh</option>
                                            <option value="Arunachal Predesh">Arunachal Predesh</option>
                                            <option value="Assam">Assam</option>
                                            <option value="Bihar">Bihar</option>
                                            <option value="Chandigarh">Chandigarh</option>
                                            <option value="Chhattisgarh">Chhattisgarh</option>
                                            <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                            <option value="Damn anad Diu">Damn anad Diu</option>
                                            <option value="Delhi">Delhi</option>
                                            <option value="Goa">Goa</option>
                                            <option value="Gujarat">Gujarat</option>
                                            <option value="Haryana">Haryana</option>
                                            <option value="Himachal Predesh">Himachal Predesh</option>
                                            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                            <option value="Jharkhand">Jharkhand</option>
                                            <option value="Karnataka">Karnataka</option>
                                            <option value="Kerala">Kerala</option>
                                            <option value="Ladakh">Ladakh</option>
                                            <option value="Lakshadweep">Lakshadweep</option>
                                            <option value="Madhya Predesh">Madhya Predesh</option>
                                            <option value="Maharashtra">Maharashtra</option>
                                            <option value="Manipur">Manipur</option>
                                            <option value="Meghalaya">Meghalaya</option>
                                            <option value="Mizoram">Mizoram</option>
                                            <option value="Nagaland">Nagaland</option>
                                            <option value="Odisha">Odisha</option>
                                            <option value="Puducherry">Puducherry</option>
                                            <option value="Punjab">Punjab</option>
                                            <option value="Rajasthan">Rajasthan</option>
                                            <option value="Sikkim">Sikkim</option>
                                            <option value="Tamil Nadu">Tamil Nadu</option>
                                            <option value="Telangana">Telangana</option>
                                            <option value="Tripura">Tripura</option>
                                            <option value="Uttar Predesh">Uttar Predesh</option>
                                            <option value="Uttarakhand">Uttarakhand</option>
                                            <option value="West Bengal">West Bengal</option>
                                            <option value="Other Territory">Other Territory</option>
                                        </select>
                                        <div class="invalid-feedback">Please select a valid registration type.</div>
                                    </div>
                                </div>
            
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <label for="gstTypeCus">GST Type</label>
                                        <select class="form-control" id="gstTypeCus" name="gst_type" onclick="toggleGSTIN('gstInValue', this)" style="background-color: #43596c; color: white;" required>
                                            <option selected value="">Select GST Type</option>
                                            <option value="Registered Business - Regular">Registered Business - Regular <span><i>(Business that is registered under gst)</i></span></option>
                                            <option value="Registered Business - ComPlaceOfSupplyCustomerition">Registered Business - ComPlaceOfSupplyCustomerition (Business that is registered under comPlaceOfSupplyCustomerition scheme in gst)</option>
                                            <option value="Unregistered Business">Unregistered Business (Business that has not been registered under gst)</option>
                                            <option value="Overseas">Overseas (Import/Export of supply outside india)</option>
                                            <option value="Consumer">Consumer</option>
                                            <option value="Special Economic Zone (SEZ)">Special Economic Zone (SEZ) (Business that is located in a special economic zone of india or a SEZ developer)</option>
                                            <option value="Demed Exports">Demed Exports (Supply of woods to an exports oriented unit or againsed advanced authorization or export promotion capital woods)</option>
                                            <option value="Tax Deductor">Tax Deductor (State of central gov,government agencies or local authority)</option>
                                            <option value="SEZ Developer">SEZ Developer (A person or organization who owns atleast 26% equality in creating business units in special economic zone)</option>
                                        </select>
                                        <div class="invalid-feedback">Please select a valid registration type.</div>
                                    </div>
            
                                    <div class="col-md-4 gstrow d-block" id="gstInValue">
                                        <div>
                                            <label for="gstIN">GSTIN</label>
                                            <input type="text" class="form-control" onchange="showMessage(this)" id="gstIN" name="gstin" style="background-color: #43596c;color: white;" placeholder="29APPCK7465F1Z1">
                                            <a data-toggle="modal" href="#exampleModal" style="color:#3dd5f3">Get Taxpayer Details</a>
                                            <div class="text-danger m-2" id="warngst"></div>
                                        </div>
                                    </div>
            
                                    <div class="col-md-4">
                                        <label for="panNo">PAN No.</label>
                                        <input type="text" class="form-control" id="panNo" name="pan_no" style="background-color: #43596c;color: white;" required onchange="checkpan(this)" placeholder="APPCK7465F">
                                        <div class="text-danger m-2" id="warnpan"></div>
                                    </div>
                                </div>
            
                                <div class="row">
                                    <div class="col-md-4 mt-3">
                                        <label for="validationCustom05">Opening Balance</label>
                                        <div class="d-flex">
                                            <select name="balance_type" id="bal" class="form-select text-white mr-1" style="background-color: #243e54; width: 25%; border-radius: 5px;">
                                                <option value="debit">Debit</option>
                                                <option value="credit">Credit</option>
                                            </select>
                                            <input type="text" class="form-control" name="open_balance" id="openbalance" step="any" style="background-color: #43596c;color: white;">
                                            <div class="text-danger m-2" ></div>
                                        </div>
                                    </div>
            
                                    <div class="col-md-4 mt-3">
                                        <label for="creditLimit">Credit Limit</label>
                                        <input type="text" class="form-control" name="credit_limit" style="background-color: #43596c;color: white;" step="any" id="creditLimit">
                                        <div class="text-danger m-2" ></div>
                                    </div>
            
                                    <div class="col-md-4 mt-3">
                                        <label for="paymentTerms">Payment Terms</label>
                                        <div class="d-flex">
                                            <select name="payment_terms" id="paymentTermsCustomer" class="form-control">
                                                <option value="" selected>Choose</option>
                                                {% for p in pTerms %}
                                                <option value="{{p.id}}">{{p.term_name}}</option>
                                                {% endfor %}
                                            </select>
                                            <a href="#newPaymentTerm2" data-toggle="modal" class="btn btn-outline-secondary ml-1">+</a>
                                        </div>
                                    </div>
            
                                    <div class="col-md-4 mt-3">
                                        <label for="priceList">Price List</label>
                                        <select name="price_list" id="priceList" class="form-control">
                                            <option value="" selected>Choose</option>
                                            {% for l in list_s %}
                                            <option value="{{l.id}}">{{l.name}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
            
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <label for="custEmail">Email</label>
                                        <input type="email" class="form-control" required id="custEmail" name="email" onchange="checkemail(this)" style="background-color: #43596c;color: white;" placeholder="finsys@gmail.com">
                                        <div class="invalid-feedback">Please provide a valid Email</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="custWebsite">Website</label>
                                        <input type="text" class="form-control" id="custWebsite" placeholder="www.finsys.com" onchange="checkweb(this)" name="website" style="background-color: #43596c;color: white;">
                                        <div id="warnweb" class="text-danger"></div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="custMobile">Mobile</label>
                                        <input type="text" class="form-control" id="custMobile" required onchange="checkphone(this)" name="mobile" style="background-color: #43596c;color: white;">
                                        <div class="text-danger m-2" id="warnphone"></div>
                                    </div>
                                </div>
                                <hr>
                                <div class="row mt-5">
                                    <div class="col-md-6">
                                        <div class="row">
                                            <div class="col-md-12 card-title">
                                                <h5 class="mb-0">Billing Address</h5>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mt-3">
                                                <div class="form-row">
                                                    <label for="street">Street</label>
                                                    <textarea class="form-control street" required id="street1" name="street" style="background-color: #43596c;color: white;"></textarea>
                                                    <div class="invalid-feedback">Please provide a valid Street</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="city">City</label>
                                                    <input type="text" class="form-control" required id="city1" name="city" style="background-color: #43596c;color: white;" placeholder="City">
                                                    <div class="invalid-feedback">Please provide a valid City</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="state">State</label>
                                                    <select type="text" class="form-control" id="state" name="state1" required style="background-color: #43596c; color: white;">
                                                        <option value="" selected hidden>Choose</option>
                                                        <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islands</option>
                                                        <option value="Andhra Predhesh">Andhra Predhesh</option>
                                                        <option value="Arunachal Predesh">Arunachal Predesh</option>
                                                        <option value="Assam">Assam</option>
                                                        <option value="Bihar">Bihar</option>
                                                        <option value="Chandigarh">Chandigarh</option>
                                                        <option value="Chhattisgarh">Chhattisgarh</option>
                                                        <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                        <option value="Damn anad Diu">Damn anad Diu</option>
                                                        <option value="Delhi">Delhi</option>
                                                        <option value="Goa">Goa</option>
                                                        <option value="Gujarat">Gujarat</option>
                                                        <option value="Haryana">Haryana</option>
                                                        <option value="Himachal Predesh">Himachal Predesh</option>
                                                        <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                        <option value="Jharkhand">Jharkhand</option>
                                                        <option value="Karnataka">Karnataka</option>
                                                        <option value="Kerala">Kerala</option>
                                                        <option value="Ladakh">Ladakh</option>
                                                        <option value="Lakshadweep">Lakshadweep</option>
                                                        <option value="Madhya Predesh">Madhya Predesh</option>
                                                        <option value="Maharashtra">Maharashtra</option>
                                                        <option value="Manipur">Manipur</option>
                                                        <option value="Meghalaya">Meghalaya</option>
                                                        <option value="Mizoram">Mizoram</option>
                                                        <option value="Nagaland">Nagaland</option>
                                                        <option value="Odisha">Odisha</option>
                                                        <option value="Puducherry">Puducherry</option>
                                                        <option value="Punjab">Punjab</option>
                                                        <option value="Rajasthan">Rajasthan</option>
                                                        <option value="Sikkim">Sikkim</option>
                                                        <option value="Tamil Nadu">Tamil Nadu</option>
                                                        <option value="Telangana">Telangana</option>
                                                        <option value="Tripura">Tripura</option>
                                                        <option value="Uttar Predesh">Uttar Predesh</option>
                                                        <option value="Uttarakhand">Uttarakhand</option>
                                                        <option value="West Bengal">West Bengal</option>
                                                        <option value="Other Territory">Other Territory</option>
                                                    </select>
                                                    <div class="invalid-feedback">Please provide a valid State</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="pinco">Pin Code</label>
                                                    <input type="text" class="form-control" required id="pinco1" name="pincode" style="background-color: #43596c;color: white;" placeholder="PIN code">
                                                    <div class="invalid-feedback">Please provide a valid Pin Code</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="country">Country</label>
                                                    <input type="text" class="form-control" required id="country1" name="country" style="background-color: #43596c;color: white;" placeholder="Country">
                                                    <div class="invalid-feedback">Please provide a valid Country</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row">
                                            <div class="col-md-12 d-flex">
                                                <h5>Shipping Address</h5>
                                                <input class="ml-4 ml-5" type="checkbox" onclick="placeShipAddress1()" id="shipAddress1" name="ship_address">
                                                <label class="ml-2 mt-1 ml-2" for="shipAddress">Same As Billing Address</label>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mt-3">
                                                <div class="form-row">
                                                    <label for="shipstreet">Street</label>
                                                    <textarea class="form-control" id="shipstreet1" name="shipstreet" style="background-color: #43596c;color: white;"></textarea>
                                                    <div class="invalid-feedback">Please provide a valid Street</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="shipcity">City</label>
                                                    <input type="text" class="form-control" id="shipcity1" name="shipcity" style="background-color: #43596c;color: white;" placeholder="City">
                                                    <div class="invalid-feedback">Please provide a valid City</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="shipstate">State</label>
                                                    <select type="text" class="form-control" id="shipState1" name="shipstate" style="background-color: #43596c; color: white;">
                                                        <option value="" selected>Choose</option>
                                                        <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islands</option>
                                                        <option value="Andhra Predhesh">Andhra Predhesh</option>
                                                        <option value="Arunachal Predesh">Arunachal Predesh</option>
                                                        <option value="Assam">Assam</option>
                                                        <option value="Bihar">Bihar</option>
                                                        <option value="Chandigarh">Chandigarh</option>
                                                        <option value="Chhattisgarh">Chhattisgarh</option>
                                                        <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                        <option value="Damn anad Diu">Damn anad Diu</option>
                                                        <option value="Delhi">Delhi</option>
                                                        <option value="Goa">Goa</option>
                                                        <option value="Gujarat">Gujarat</option>
                                                        <option value="Haryana">Haryana</option>
                                                        <option value="Himachal Predesh">Himachal Predesh</option>
                                                        <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                        <option value="Jharkhand">Jharkhand</option>
                                                        <option value="Karnataka">Karnataka</option>
                                                        <option value="Kerala">Kerala</option>
                                                        <option value="Ladakh">Ladakh</option>
                                                        <option value="Lakshadweep">Lakshadweep</option>
                                                        <option value="Madhya Predesh">Madhya Predesh</option>
                                                        <option value="Maharashtra">Maharashtra</option>
                                                        <option value="Manipur">Manipur</option>
                                                        <option value="Meghalaya">Meghalaya</option>
                                                        <option value="Mizoram">Mizoram</option>
                                                        <option value="Nagaland">Nagaland</option>
                                                        <option value="Odisha">Odisha</option>
                                                        <option value="Puducherry">Puducherry</option>
                                                        <option value="Punjab">Punjab</option>
                                                        <option value="Rajasthan">Rajasthan</option>
                                                        <option value="Sikkim">Sikkim</option>
                                                        <option value="Tamil Nadu">Tamil Nadu</option>
                                                        <option value="Telangana">Telangana</option>
                                                        <option value="Tripura">Tripura</option>
                                                        <option value="Uttar Predesh">Uttar Predesh</option>
                                                        <option value="Uttarakhand">Uttarakhand</option>
                                                        <option value="West Bengal">West Bengal</option>
                                                        <option value="Other Territory">Other Territory</option>
                                                    </select>
                                                    <div class="invalid-feedback">Please provide a valid State</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="shippinco">Pin Code</label>
                                                    <input type="text" class="form-control" id="shippinco1" name="shippincode" style="background-color: #43596c;color: white;" placeholder="PIN code">
                                                    <div class="invalid-feedback">Please provide a valid Pin Code</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mt-3">
                                                <div class="form-row">
                                                    <label for="shipcountry">Country</label>
                                                    <input type="text" class="form-control" id="shipcountry1" name="shipcountry" style="background-color: #43596c;color: white;" placeholder="Country">
                                                    <div class="invalid-feedback">Please provide a valid Country</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="" id="agreeTerms" required style="background-color: #43596c;">
                                            <label for="agreeTerms">Agree to Terms and Conditions</label>
                                            <div class="invalid-feedback">You must agree before submitting.</div>
                                        </div>
                                    </div>
                                </div>
            
                                <div class="row mt-5 mb-5">
                                    <div class="col-md-4">
                                    </div>
                                    <div class="col-md-4 d-flex justify-content-center">
                                        <button class="btn btn-outline-secondary w-50 text-light" type="submit">SAVE</button>
                                        <!-- <a href="{% url 'Fin_customers' %}"class="btn btn-outline-secondary w-25 ml-1 text-light">CANCEL</a> -->
                                    </div>
                                    <div class="col-md-4"></div>
                                </div>
                        </form>
                        <script>
                            $(document).ready(function() {
                            $("#customerForm").submit(function(e) {
                                e.preventDefault();

                                var formData = $(this).serialize(); // Serialize form data

                                $.ajax({
                                    type: "POST",
                                    url: '/Fin_createCustomer_modal',
                                    data: formData,
                                    dataType: "json",  // Expect JSON response
                                    success: function(response) {
                                        if (response.success) {
                                            alert('Customer created successfully!');

                                            // Update dropdown with the newly created vendor
                                            var dropdown = $('.customerDropdown');
                                            
                                            // Add each vendor from the response to the dropdown
                                            $.each(response.customers, function(index, customer) {
                                            // Assuming each customer has properties 'first_name', 'last_name', and 'id'
                                            var fullName = customer.first_name + ' ' + customer.last_name;
                                            newCus = $('<a class="dropdown-item drop2" style="text-transform: uppercase;" ></a>').attr('value', customer.id).text(fullName);
                                            dropdown.append(newCus);
                                            $('#customerModal').modal('hide');
                                            $("#customerForm").reset()
                                        });
                                        } else {
                                            alert(response.msg);
                                        }
                                    },
                                    error: function(xhr, errmsg, err) {
                                        alert("Error occurred: " + errmsg);
                                    }
                                });
                            });
                        });
                            </script>
                    </div>
                </div>
            </div>
            
            
            <!-- payment term Modal -->
            
            <div class="modal fade" id="newPaymentTerm2">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content" style="background-color: #213b52;">
                        <div class="modal-header">
                            <h5 class="m-3">New Payment Term</h5>
                            <button type="button" class="close" onclick="$('#newPaymentTerm2').modal('hide')" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="card p-3">
                                <form method="PlaceOfSupplyCustomert" id="newTermFormCustomer">
                                    {% csrf_token %}
                                    <div class="row mt-2">
                                        <div class="col-6">
                                            <label for="name">Term Name</label>
                                            <input type="text" name="term_name" id="termNameCustomer" class="form-control w-100">
                                        </div>
                                        <div class="col-6">
                                            <label for="name">Days</label>
                                            <input type="number" name="days" id="termDaysCustomer" class="form-control w-100" min="0" step="1">
                                        </div>
                                    </div>
                                    <div class="row mt-4">
                                        <div class="col-4"></div>
                                        <div class="col-4 d-flex justify-content-center">
                                            <button class="btn btn-outline-secondary text-grey w-75" data-dismiss="modal" type="submit" id="savePaymentTermCustomer">Save</button>
                                        </div>
                                        <div class="col-4"></div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>   
                </div>
            </div>
            
            
            
            
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
            <script>
                function placeShipAddress1() {
                    var chkbtn = document.getElementById('shipAddress1');
                    if (chkbtn.checked == true) {
                        document.getElementById('shipstreet1').value = document.getElementById('street1').value;
                        document.getElementById('shipcity1').value = document.getElementById('city1').value;
                        document.getElementById('shippinco1').value = document.getElementById('pinco1').value;
                        document.getElementById('shipcountry1').value = document.getElementById('country1').value;
                        document.getElementById('shipState1').value = document.getElementById('state1').value;
                    } else {
                        document.getElementById('shipstreet').value = '';
                        document.getElementById('shipcity').value = '';
                        document.getElementById('shippinco').value = '';
                        document.getElementById('shipcountry').value = '';
                        document.getElementById('shipState').value = '';
                        
                    }
                }
            
                $(document).on("click","#savePaymentTermCustomer",function(){
                    var trm = $('#termNameCustomer').val();
                    var dys = $("#termDaysCustomer").val();
                    if (trm !="" && dys !=""){
                        $.ajax({
                            type : 'POST',
                            url:'/Fin_new_payment_terms_recurring',
                            data:{
                                'term_name' : trm,
                                'days' : dys,
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            
                            success: function(response) {
                                
                                    document.getElementById("newTermFormCustomer").reset();
                                    
                                    var dropdown = $('#paymentTermsCustomer');                                    
                                    $.each(response.terms, function (index, term) {
                                        dropdown.append($('<option></option>').text(term.term_name).val(term.id))
                                    });

                                    var dropdown1 = $('#termadd2');
                                    $.each(response.terms, function (index, term) {
                                        dropdown1.append($('<option></option>').text(term.term_name).val(term.id))
                                    });

                                    var dropdown2 = $('#paymentTerms');
                                    $.each(response.terms, function (index, term) {
                                        dropdown2.append($('<option selected></option>').text(term.term_name).val(term.id))
                                    });

                                    alert('successfully added')
            
                                
                            },         
                        });
                    }
                    else{
                        alert('Invalid')
                    }
                });
            
                // function toggleGSTIN(divId, element) {
                //     if (element.value == 'GST-registered-Regular'  || element.value == 'Consumer' || element.value == 'Overseas') {
                //         document.getElementById(divId).style.display = 'block';
                //     } else {
                //         document.getElementById(divId).style.display = 'none';
                //         document.getElementById("gstIN").value = '';
                //     }
                // }
            
                $(document).ready(function() {
                    $("#gstTypeCus").change(function() {
                        var x=$('#gstTypeCus').val();
                        if(x == "Unregistered Business" || x == 'Overseas' || x == 'Consumer'){
                            $(".gstrow").removeClass('d-block');
                            $(".gstrow").addClass('d-none');
                            $('#gstIN').prop('required',false);
                        }else {
                            $('#gstIN').prop('required',true);
                            $(".gstrow").removeClass('d-none');
                            $(".gstrow").addClass('d-block');
                        }
                    });
                });
            
                    
                function showMessage(input) {
                    const gstin = input.value;
            
                    if (gstin.length === 15) {
                        // document.getElementById("message").textContent = "Please wait, validating GSTIN format...";
                        setTimeout(() => checkgst(input), 1000);  // Wait for a second and then validate GSTIN
                    } else {
                        document.getElementById("message").textContent = "";
                    }
                }
            
                
            
            
                function checkgst(element) {
                    var gstinput = element.value;
                    var gstregexp = "[0-9]{2}[a-zA-Z]{5}[0-9]{4}[a-zA-Z]{1}[1-9A-Za-z]{1}[Z]{1}[0-9a-zA-Z]{1}";
            
                    if (gstinput.length === 15) {
                        if (gstinput.match(gstregexp)) {
                            document.getElementById('warngst').innerHTML = '';
                            checkCustomerGSTIN(gstinput)
                        } else {
                            document.getElementById('warngst').innerHTML = 'Please provide a valid GST Number';
                            alert('Please provide a valid GST Number');
                        }
                    }
                        else {
                        document.getElementById('warngst').innerHTML = 'Please provide a valid GST Number';
                        alert('Please provide a valid GST Number');
                    }
                }
            
                function checkpan(element) {
                    var paninput = element.value;
                    var panregexp = ["[a-zA-Z]{5}[0-9]{4}[a-zA-Z]{1}"]
                    if (paninput.match(panregexp)) {
                        document.getElementById('warnpan').innerHTML = '';
                        checkCustomerPAN(paninput)
                    } else {
                        document.getElementById('warnpan').innerHTML = 'Please provide a valid PAN Number';
                        alert('Please provide a valid PAN Number')
                    }
                }
            
                function checkweb(element) {
                    var webinput = element.value;
                    var webregexp = "www."
                    if (webinput.startsWith(webregexp)) {
                        document.getElementById('warnweb').innerHTML = '';
                    } else {
                        document.getElementById('warnweb').innerHTML = 'Please provide a valid Website Address';
                        alert('Please provide a valid Website Address')
                    }
                }
            
                function checkphone(element) {
                    var phoneinput = element.value;
                    var phoneregexp = /^\d{10}$/;
                    if (phoneinput.match(phoneregexp)) {
                        document.getElementById('warnphone').innerHTML = '';
                        checkCustomerPhone(phoneinput)
                    } else {
                        document.getElementById('warnphone').innerHTML = 'Please provide a valid Phone Number';
                        alert('Please provide a valid Phone Number')
                    }
                }
            
                function checkemail(element) {
                    var emailinput = element.value;
                    var emailregexp = /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/;
                    if (emailinput.match(emailregexp)) {
                        document.getElementById('warnemail').innerHTML = '';
                        checkCustomerEmail(emailinput)
                    } else {
                        document.getElementById('warnemail').innerHTML = 'Please provide a valid Email ID';
                        alert('Please provide a valid Email id')
                    }
                }
            
                // (function () {
                //     'use strict';
                //     window.addEventListener('load', function () {
                //         // Fetch all the forms we want to apply custom Bootstrap validation styles to
                //         var forms = document.getElementsByClassName('needs-validation');
                //         // Loop over them and prevent submission
                //         var validation = Array.prototype.filter.call(forms, function (form) {
                //             form.addEventListener('submit', function (event) {
                //                 if (form.checkValidity() === false) {
                //                     event.preventDefault();
                //                     event.stopPropagation();
                //                 }
                //                 form.classList.add('was-validated');
                //             }, false);
                //         });
                //     }, false);
                // })();
            
                $(document).on('change', '#openbalance',function () {
                    openbal = $("#openbalance").val()
                    if($('#bal').val()=='credit'){
                        if(openbal.slice(0,1) != '-'){
                            if(parseFloat(openbal) != 0){
                                document.getElementById("openbalance").value = "-"+openbal
                            }else{
                                document.getElementById("openbalance").value = openbal
                            }
                        }else{
                            if(parseFloat(openbal) != 0){
                                document.getElementById("openbalance").value = openbal
                            }else{
                                document.getElementById("openbalance").value = -1 * parseFloat(openbal)
                            }
                        }
                    }else{
                        document.getElementById("openbalance").value = openbal
                    }
                });
            
                $(document).on('change', '#bal',function () {
                    openbal = $("#openbalance").val()
                    if(openbal != ""){
                        if($('#bal').val()=='credit'){
                            openbal = $("#openbalance").val()
                            if (parseFloat(openbal) != 0){
                                document.getElementById("openbalance").value = "-"+openbal
                            }else{
                                document.getElementById("openbalance").value = openbal
                            }
                        }else{
                            openbal = $("#openbalance").val()
                            document.getElementById("openbalance").value = -1*(parseFloat(openbal))
                        }
                    }
                });
            
                $(document).ready(function(){
                    $('#lastName').on('change',()=>{
                        var fName = $('#firstName').val().replace(/\d/g, '');
                        var lName = $('#lastName').val().replace(/\d/g, '');
                        if(fName !="" && lName !=""){
                            checkCustomerName(fName,lName)
                        }else{
                            alert('Please enter a valid Full Name.!')
                            return false
                        }
                    });
            
                    $('#firstName').on('change',()=>{
                        var fName = $('#firstName').val().replace(/\d/g, '');
                        var lName = $('#lastName').val().replace(/\d/g, '');
                        if(fName !="" && lName !=""){
                            checkCustomerName(fName,lName)
                        }else if(fName == "" && lName !=""){
                            alert('Please enter a valid First Name.!')
                        }
            
                    })
                });
            
                function checkCustomerName(fname,lname){
                    if (fname != "" && lname !=""){
                        $.ajax({
                            type : 'PlaceOfSupplyCustomerT',
                            url:"{% url 'Fin_checkCustomerName' %}",
                            data:{
                                'fname' : fname,
                                'lname' : lname,
            
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            
                            success: function(response) {
                                if(response.is_exist){
                                    alert(response.message)
                                }
                            },         
                        });
                    }
                }
            
                function checkCustomerGSTIN(gstin){
                    var gstNo = gstin;
                    if (gstNo != ""){
                        $.ajax({
                            type : 'PlaceOfSupplyCustomerT',
                            url:"{% url 'Fin_checkCustomerGSTIN' %}",
                            data:{
                                'gstin' : gstNo,
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            
                            success: function(response) {
                                if(response.is_exist){
                                    alert(response.message)
                                }
                            },         
                        });
                    }
                }
            
                function checkCustomerPAN(pan){
                    var panNo = pan;
                    if (panNo != ""){
                        $.ajax({
                            type : 'PlaceOfSupplyCustomerT',
                            url:"{% url 'Fin_checkCustomerPAN' %}",
                            data:{
                                'pan' : panNo,
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            
                            success: function(response) {
                                if(response.is_exist){
                                    alert(response.message)
                                }
                            },         
                        });
                    }
                }
            
                function checkCustomerPhone(phone){
                    var phoneNo = phone;
                    if (phoneNo != ""){
                        $.ajax({
                            type : 'PlaceOfSupplyCustomerT',
                            url:"{% url 'Fin_checkCustomerPhone' %}",
                            data:{
                                'phone' : phoneNo,
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            
                            success: function(response) {
                                if(response.is_exist){
                                    alert(response.message)
                                }
                            },         
                        });
                    }
                }
            
                function checkCustomerEmail(email){
                    var custEmail = email;
                    if (custEmail != ""){
                        $.ajax({
                            type : 'PlaceOfSupplyCustomerT',
                            url:"{% url 'Fin_checkCustomerEmail' %}",
                            data:{
                                'email' : custEmail,
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            
                            success: function(response) {
                                if(response.is_exist){
                                    alert(response.message)
                                }
                            },         
                        });
                    }
                }
            </script>
            
            
            
        </div>
        <!-- <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div> -->
      </div>
    </div>
  </div>
<!-- modal customer end -->


<!-- items modal -->
<div class="modal fade" id="itemsModal">
    <div class="modal-dialog modal-lg" style="max-width: 1000px;" role="document">
        <div class="modal-content" style="background-color: #213b52;">
            <div class="modal-header">
          <h5 class="modal-title" id="ItemsTitle">Add Item</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          

          


<style type="text/css">

    select.list-dt {
        border: none;
        outline: 0;
        border-bottom: 1px solid #ccc;
        padding: 2px 5px 3px 5px;
        margin: 2px
    }

    select.list-dt:focus {
        border-bottom: 2px solid skyblue
    }

    .card {
        z-index: 0;
        border: none;
        border-radius: 0.5rem;
        position: relative
    }

</style>

<div class="page-content">
    <div class="card radius-15">
        <div class="card-body">
            <div class="row">
                <div class="col-12 col-lg-12 col-xl-12">
                    <!-- <span class="d-flex justify-content-end p-2" style="cursor: pointer;" onclick="javascript:window.history.back()"><i class="fa fa-times text-white" style="font-size: 1.2rem;"></i></span> -->
                    <div class="card" style="background-color: #2a4964;">
                        <div class="row no-gutters">
                            <div class="col-md-2"></div>
                            <!-- <div class="col-md-8 mt-4 mb-4">
                                <center>
                                    <h5 class="card-title"><h3> ADD ITEM </h3></h5>
                                </center>
                            </div> -->
                            <div class="col-md-2"></div>
                        </div>
                    </div>
                </div>
            </div>
            <form action="" method="post" id="itemForm" class="needs-validation"  validate>
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-12 mx-0">
                        <div class="row">
                            <div class="col-md-6 mt-3">
                                <label for="itemName" style="color: white;">Name</label>
                                <input type="text" id="itemName" name="name" class="form-control" style="background-color: #2a4964; color: white;" autocomplete="off" required>
                            </div>
                            <div class="col-md-6 mt-3">
                                <label for="itemType" style="color: white;">Type</label>
                                <select name="type" class="form-control" id="itemType" style="background-color: #2a4964; color: white;" required>
                                    <option selected disabled value="">Choose...</option>
                                    <option value="Goods">Goods</option>
                                    <option value="Services">Services</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mt-3">
                                <label for="itemUnit" style="color: white;">Unit</label>
                                <div class="d-flex">
                                    <select class="custom-select" name="unit" id="itemUnit" required style="background-color: #2a4964; color: white;">
                                        <option selected disabled value="">Choose...</option>
                                        {% for a in units %}
                                        <option class="text-uppercase">{{ a.name }}</option>
                                        {% endfor %}
                                    </select>
                                    <a href="#">
                                        <button type="button" class="btn btn-outline-secondary ml-1" data-toggle="modal" data-target="#createNewUnit">+</button>
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-6 mt-3" id="hsnDiv">
                                <label for="hsnField" style="color: white;">HSN Code</label>
                                <input type="number" name="hsn" class="form-control" style="background-color: #2a4964; color: white;" placeholder="Enter a valid HSN code" required id="hsnField" oninput="validateHSN()">
                                <div id="hsnError" style="color: red;"></div>
                            </div>
                            <div class="col-md-6 mt-3" id="sacDiv" style="display: none;">
                                <label for="sacField" style="color: white;">SAC Code</label>
                                <input type="number" name="sac" class="form-control" style="background-color: #2a4964; color: white;" placeholder="Enter a valid SAC code" id="sacField" oninput="validateSAC()">
                                <div id="sacError" style="color: red;"></div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-3 mt-3">
                                <label style="color: white;">Tax Reference</label>
                            </div>
                            <div class="col-md-3">
                                <div class="form-check mt-1">
                                    <input class="form-check-input" name="taxref" type="radio" id="inclusive" value="taxable" onclick="showdiv()" required>
                                    <label style="color: white;" for="inclusive">taxable</label>
                                </div>
                            </div>
                            <div class="form-check mt-1">
                                <input class="form-check-input" name="taxref" type="radio" value="non taxable" id="check" onclick="hidediv()">
                                <label style="color: white;" for="check">non taxable</label>
                            </div>
                        </div>
                        <div class="row"  id="taxableDiv" style="display: none;">
                            <div class="col-md-6 mt-3">
                                <label for="intraStateTax" style="color: white;">Intra State Tax Rate</label>
                                <select name="intra_st" class="form-control" style="background-color: #2a4964; color: white;" id="intraStateTax" >
                                    <option value=0>GST 0 (0%)</option>
                                    <option value=3>GST 3 (3%)</option>
                                    <option value=5>GST 5 (5%)</option>
                                    <option value=12>GST 12 (12%)</option>
                                    <option value=18>GST 18 (18%)</option>
                                    <option value=28>GST 28 (28%)</option>        
                                </select>
                            </div>
                            <div class="col-md-6 mt-3">
                                <label for="interStateTax" style="color: white;">Inter State Tax Rate</label>
                                <select name="inter_st" class="form-control" style="background-color: #2a4964; color: white;" id="interStateTax" >
                                    <option value=0>IGST 0 (0%)</option>
                                    <option value=3>IGST 3 (3%)</option>
                                    <option value=5>IGST 5 (5%)</option>
                                    <option value=12>IGST 12 (12%)</option>
                                    <option value=18>IGST 18 (18%)</option>
                                    <option value=28>IGST 28 (28%)</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mt-3">
                                <label style="color: white;">Purchase Price</label>
                                <div class="row">
                                    <div class="col-md-12 d-flex">
                                        <input type="text" class="form-control mr-1" value="INR" style="width:60px;background-color: #2a4960; color: white;">
                                        <input type="number" name="pcost" class="form-control" id="purprice" style="background-color: #2a4964; color: white;" value="0">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mt-3">
                                <label style="color: white;">Sales Price</label>
                                <div class="row">
                                    <div class="col-md-12 d-flex">
                                        <input type="text" class="form-control mr-1" value="INR" style="width:60px;background-color: #2a4960; color: white;">
                                        <input type="number" name="salesprice" class="form-control" id="saleprice" style="background-color: #2a4964; color: white;" value="0">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mt-3">
                                <label for="purchaseAccount" style="color: white;">Account</label>
                                <div class="d-flex">
                                    <select name="pur_account" class="form-control" style="background-color: #2a4964; color: white;" id="purchaseAccount">
                                        <option value="" selected disabled>--Choose--</option>
                                        {% for a in accounts %}
                                        <option value="{{ a.account_name }}">{{ a.account_name }}</option>
                                        {% endfor %}
                                    </select>
                                    <a href="#">
                                        <button type="button" class="btn btn-outline-secondary ml-1" data-toggle="modal" data-target="#createNewAccount">+</button>
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-6 mt-3">
                                <label for="salesAccount" style="color: white;">Account</label>
                                <select name="sale_account" class="form-control" style="background-color: #2a4964; color: white;" id="salesAccount">
                                    <option value="" selected disabled>--Choose--</option>
                                    <option value="General Income">General Income</option>
                                    <option value="Interest Income">Interest Income</option>
                                    <option value="Late Fee Income">Late Fee Income</option>
                                    <option value="Discount Income">Discount Income</option>
                                    <option value="Shipping Charges">Shipping Charges</option>
                                    <option value="Other Charges">Other Charges</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mt-3">
                                <label for="purchaseDescription" style="color: white;">Description</label>
                                <textarea class="form-control" name="pur_desc" id="purchaseDescription" style="background-color: #2a4964; color: white;"></textarea>  
                            </div>
                            <div class="col-md-6 mt-3">
                                <label for="salesDescription" style="color: white;">Description</label>
                                <textarea class="form-control" name="sale_desc" id="salesDescription" style="background-color: #2a4964; color: white;"></textarea>
                            </div>
                        </div>
                                    
                        <div class="row mt-3" >
                            <div class="col-md-3">
                                <div class="form-check">
                                    <input class="form-check-input" onclick="ShowHideDiv(this)" type="checkbox"  id="track">
                                    <label class="form-check-label" for="track">Track Inventory</label>
                                </div>  
                            </div>
                        </div>
                        <div class="row" id="inventorytrack" style="display: none">
                            <div class="col-md-6 mt-3">
                                <label style="color: white;">Inventory Account</label>
                                <select name="invacc" class="form-control" style="background-color: #2a4964; color: white;">
                                    <option selected disabled value="" >Choose...</option>
                                    <option value="Inventory Assets">Inventory Assets</option>    
                                </select>
                            </div>
                            <div class="col-md-3 mt-3">
                                <label style="color: white;">Stock on hand</label>
                                <input type="number" name="stock" class="form-control" style="background-color: #2a4964; color: white;" value="0">
                            </div>
                            <div class="col-md-3 mt-3">
                                <label style="color: white;">Stock Rate per Unit</label>
                                <input type="number" name="stock_rate" class="form-control" style="background-color: #2a4964; color: white;" value="0">
                            </div>
                        </div>

                        <div class="row" >
                            <div class="col-md-3 mt-3">
                                <label style="color: white;">Minimum Stock to maintain</label>
                                <input type="number" name="min_stock" class="form-control" style="background-color: #2a4964; color: white;" value="0">
                            </div>
                        </div>
                        
                        <div class="row mt-5 mb-5">
                            <div class="col-md-3">
                            </div>
                            <div class="col-md-6 d-flex justify-content-center">
                                <button class="btn btn-outline-secondary w-50 text-light" type="submit">SAVE</button>
                                <!-- <a  class="btn btn-outline-secondary w-50 ml-1 text-light" >CANCEL</a> -->
                            </div>
                            <div class="col-md-4"></div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    

    $(document).ready(function() {
    $("#itemForm").submit(function(e) {
        e.preventDefault();
        var formData = $(this).serialize(); // Serialize form
        $.ajax({
            type: "POST",
            url: "{% url 'Fin_createNewItem_modal' %}",
            data: formData,
            dataType: "json",  // Expect JSON response
            success: function(response) {
                if (response.success) {
                    alert('Item Saved successfull')
                    // Update dropdown with the newly created vendor
                    var dropdown = $('.item-select');
                    
                    // Add each vendor from the response to the dropdown
                    $.each(response.Items, function(index, item) {
                    // Assuming each vendor has properties 'first_name', 'last_name', and 'id'
                    var fullName = item.name ;
                    dropdown.append($('<option></option>').text(fullName).val(item.id));
                    $('#itemsModal').modal('hide');
                    document.getElementById("itemForm").reset();
                });
                } else {
                    alert(response.msg);
                }
            },
            error: function(xhr, errmsg, err) {
                alert("Error occurred: " + err);
            }
        });
    });
});

  


</script>
<!-- Unit Create Modal -->

<div class="modal fade" id="createNewUnit">
    <div class="modal-dialog">
        <div class="modal-content" style="background-color: #213b52;">
            <div class="modal-header">
                <h5 class="m-3">New Item Unit</h5>
                <button type="button" class="close" onclick="$('#createNewUnit').modal('hide')" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card p-3">
                    <form method="post" id="newUnitForm">
                        {% csrf_token %}
                        <div class="row mt-2">
                            <div class="col-12">
                                <label for="name">Unit Name</label>
                                <input name="name" id="unit_name" class="form-control text-uppercase w-100">
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12 d-flex justify-content-center">
                                <button class="btn btn-outline-info text-grey" data-dismiss="modal" type="submit" id="saveItemUnit">Save</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>   
    </div>
</div> 


<!-- Account Create Modal -->

<div class="modal fade" id="createNewAccount">
    <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background-color: #213b52;">
            <div class="modal-header">
                <h5 class="m-3">New Account</h5>
                <button type="button" class="close" onclick="$('#createNewAccount').modal('hide')" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card p-3">
                    <form method="post" action="{% url 'Fin_createAccount' %}" id="newAccountForm">
                        {% csrf_token %}
                        <div class="row mt-2 mb-2">
                            <div class="col-md-6">
                                <div class="row mt-2">
                                    <div class="col-12">
                                        <label for="acctyp">Account Type</label>
                                        <input type="text" value="Assets" id="acctype" name="acctype" hidden>
                                        <select name="account_type" id="Account_type" class="custom-select-md form-control w-100"  onchange="AccountTypeChange(this)" required>
                                            <!-- <optgroup label="Assets" style="background-color: rgb(47 81 111);">
                                                <option value="Other Asset"> Other Asset </option>
                                                <option value="Other Current Asset"> Other Current Asset </option>
                                                <option value="Cash"> Cash </option>
                                                <option value="Bank"> Bank </option>
                                                <option value="Fixed Asset"> Fixed Asset </option>
                                                <option value="Stock"> Stock</option>
                                                <option value="Payment Clearing"> Payment Clearing</option>
                                            </optgroup>
                                        
                                            <optgroup label="Liability" style="background-color: rgb(47 81 111);">
                                                <option value="Other Current Liability">Other Current Liability </option>
                                                <option value="Credit Card"> Credit Card </option>
                                                <option value="Long Term Liability"> Long Term Liability </option>
                                                <option value="Other Liability"> Other Liability </option>
                                                <option value="Overseas Tax Payable"> Overseas Tax Payable </option>
                                            </optgroup>
                                        
                                            <optgroup label="Equity" style="background-color: rgb(47 81 111);">
                                                <option value="Equity"> Equity </option>
                                            </optgroup>
                                        
                                            <optgroup label="Income" style="background-color: rgb(47 81 111);">
                                                <option value="Income"> Income </option>
                                                <option value="Other Income"> Other Income </option>
                                            </optgroup> -->
                                        
                                            <optgroup label="Expense" style="background-color: rgb(47 81 111);">
                                                <option value="Expense"> Expense </option>
                                                <option value="Cost Of Goods Sold"> Cost Of Goods Sold </option>
                                                <option value="Other Expense"> Other Expense </option>
                                            </optgroup>
                                        
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-12">
                                        <label for="name">*Name</label>
                                        <input name="account_name" id="accountName" required class="custom-select-md form-control w-100">
                                    </div>
                                </div>
                                <div class="row mt-1" id="subAccountCheck" style="display: none;">
                                    <div class="col-12">
                                        <div class="form-check">
                                            <input type="checkbox" name="subAccountCheckBox" class="form-check-input" id="subAccountCheckBox">
                                            <label class="form-check-label" for="subAccountCheckBox">Make this a sub-account</label>
                                            <span><i class="fa fa-question-circle" data-toggle="tooltip" data-placement="bottom" title="Select this option if you are creating a sub-account."></i></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2" id="parentAccountValue" style="display: none;">
                                    <div class="col-12">
                                        <label for="parentAccount">Parent Account</label>
                                        <select name="parent_account" id="parentAccount" class="custom-select-md form-control w-100">
        
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-12">
                                        <label for="acc_code">Account Code</label>
                                        <input type="text" name="account_code" id="account_code" class="form-control">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-12">
                                        <label>Description</label>
                                        <textarea class="form-control" rows="3" id="description" name="description" placeholder="Max. 500 Characters"></textarea>
                                    </div>
                                </div>
                                
                            </div>
                            <div class="col-md-6 mt-4"> 
                                <div id="acnt-desc" class="form-control" name="detype" style="font-size: small;  height: fit-content;"></div>
                            </div>
                        </div>
                            
                        <div class="mt-3">
                            <div class="row">
                                <div class="col-md-4"></div>
                                <div class="col-md-4 d-flex justify-content-center">
                                    <button type="button" data-dismiss="modal" id="saveNewAccount" class="btn btn-outline-info">Save</button>
                                </div>
                                <div class="col-md-4"></div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>   
    </div>
</div>

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="{% static 'assets/plugins/select2/js/select2.min.js' %}"></script> -->

<script>

    function ShowHideDiv(track) {
        var inventorytrack = document.getElementById("inventorytrack");
        inventorytrack.style.display = track.checked ? "flex" : "none";
    }

    function ShowHideDivi(inclusive) {
        var inter = document.getElementById("intrastateFiled");
        inter.style.display = inclusive.checked ? "block" : "none";
    }

    function validateForm() {
        let x = document.forms["myForm"]["fname"].value;
        if (x == "") {
            alert("Name must be filled out");
            return false;
        }
    }

    function validateHSN() {
        var hsnField = document.getElementById("hsnField");
        var errorText = document.getElementById("hsnError");
        var hsnValue = hsnField.value;

        if (hsnValue.length < 6) {
            errorText.innerText = "HSN must contain at least 6 digits";
            hsnField.setCustomValidity("HSN must contain at least 6 digits");
            hsnField.style.borderColor = "red";
            return false
        } else {
            errorText.innerText = "";
            hsnField.setCustomValidity(""); 
            hsnField.style.borderColor = ""; 
            return true
        }
    }

    function showdiv() {
        document.getElementById("taxableDiv").style.display = "flex";
    }
    
    function hidediv() {
        document.getElementById("taxableDiv").style.display = "none";
    }

    $(document).on("click","#saveItemUnit",function(){
        var name = $("#unit_name").val();
        if (name !=""){
            $.ajax({
                type : 'POST',
                url:"{% url 'Fin_saveItemUnit_modal' %}",
                data:{
                    'name' : name,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                
                success: function(response) {
                    if(response.status){
                        document.getElementById("newUnitForm").reset();
                        reloadUnits();
                    }else{
                        alert(response.message)
                    }
                },         
            });
        }
        else{
            alert('Invalid')
        }
    });

    function reloadUnits() {
        $.ajax({
        url: "{% url 'Fin_getItemUnits' %}",
        type: "GET",
        dataType: "json",
        data: $(this).serialize(),
        csrfmiddlewaretoken: '{{ csrf_token }}',

        success: function(data) {
            console.log("AJAX Success - Dropdown Data:", data);
            var dropdown = $('#itemUnit');
            dropdown.empty()
            dropdown.append(`<option selected disabled value="">Choose...</option>`);
            $.each(data, function(key, value) {
                for(let i=0; i<value.length; i++){
                    dropdown.append($('<option></option>').attr('class', 'text-uppercase').text(value[i].name))
                }
            });
        },
        error: function(xhr, status, error) {
        console.error(xhr.responseText);
        }
        });
    }

    // Account add modal js

    $(document).ready(function(){
        var Acnt_desc = document.getElementById("acnt-desc");
        Acnt_desc.innerHTML=`
            <b>Expense</b> <br>Reflects expenses incurred for running normal business operations, such as :<br/>
            <ul>
                <li>1.Advertisements and Marketing</li>
                <li>2.Business Travel Expenses</li>
                <li>3.License Fees</li>
                <li>4.Utility Expenses</li>
            </ul>`;

            var selectedValue = $('#Account_type').val();
            $.ajax({
                type : 'GET',
                url:"{% url 'Fin_checkAccounts' %}",
                data:{
                    type : selectedValue,
                },
                
                success: function(response) {
                    if(response.status){
                        $('#subAccountCheck').css('display','block');
                        var dropdown = $('#parentAccount');
                        dropdown.empty();
                        dropdown.append(`<option selected disabled value="">--Choose--</option>`)
                        $.each(response, function(key, value) {
                            for(let i=0; i<value.length; i++){
                                dropdown.append($('<option></option>').text(value[i].name).val(value[i].name))
                            }
                        });
                    }else{
                        
                    }
                },         
            });
    })
    
    function AccountTypeChange(selectBox) {
        var selectElement = document.getElementById("Account_type");
        var selectedValue = selectElement.value;
        var Acnt_desc = document.getElementById("acnt-desc");
        var acctype = document.getElementById("acctype");

        switch(selectedValue) {
            case "Expense":
                Acnt_desc.innerHTML=`
                    <b>Expense</b> <br>Reflects expenses incurred for running normal business operations, such as :<br/>
                    <ul>
                        <li>1.Advertisements and Marketing</li>
                        <li>2.Business Travel Expenses</li>
                        <li>3.License Fees</li>
                        <li>4.Utility Expenses</li>
                    </ul>`;
                    acctype.value="Expense"
                break;
            case "Cost Of Goods Sold":
                Acnt_desc.innerHTML=`
                    <b>Expense</b> <br>This indicates the direct costs attributable to the production of the goods sold by a company such as:<br/>
                    <ul>
                        <li>1.Material and Labor costs</li>
                        <li>2.Cost of obtaining raw materials</li>
                    </ul>`;
                    acctype.value="Expense"
                break;
            case "Other Expense":
                Acnt_desc.innerHTML=`
                    <b>Expense</b> <br>Track miscellaneous expenses incurred for activities other than primary business operations or create additional accounts to track default expenses like insurance or contribution towards charity.<br/>`;
                    acctype.value="Expense"
                break;
            
                // case "Other Asset":
            //     Acnt_desc.innerHTML=`<b>Asset</b> <br> Track special assets like goodwill and other intangible assets<br/>`;
            //     acctype.value="Asset";
            //     break;

            // case "Other Current Asset":
            //     Acnt_desc.innerHTML=`
            //         <b>Asset</b> <br> Any short term asset that can be converted into cash or cash equivalents easily<br/>
            //         <ul>
            //             <li>1.Prepaid expenses</li>
            //             <li>2.Stocks and Mutual Funds</li>
            //         </ul>`;
            //     acctype.value="Asset";
            //     break;
            // case "Cash":
            //     Acnt_desc.innerHTML=`<b>Asset</b> <br> To keep track of cash and other cash equivalents like petty cash, undeposited funds, etc.<br/>`;
            //     acctype.value="Asset";
            //     break;
            // case "Bank":
            //     Acnt_desc.innerHTML=`<b>Asset</b> <br> To keep track of bank accounts like Savings, Checking, and Money Market accounts<br/>`;
            //         acctype.value="Asset";
            //     break;
            // case "Fixed Asset":
            //     Acnt_desc.innerHTML=`
            //         <b>Asset</b> <br> Any long term investment or an asset that cannot be converted into cash easily like:<br/>
            //         <ul>
            //             <li>1.Land and Buildings</li>
            //             <li>2.Plant, Machinery and Equipment</li>
            //             <li>3.Computers</li>
            //             <li>3.Furniture</li>
            //         </ul>`;
            //         acctype.value="Asset";
            //     break;
            // case "Stock":
            //     Acnt_desc.innerHTML=`<b>Asset</b> <br> To keep track of your inventory assets.<br/>`;
            //     acctype.value="Asset";
            //     break;
            // case "Payment Clearing":
            //     Acnt_desc.innerHTML=`<b>Asset</b> <br> To keep track of funds moving in and out via payment processors like Stripe, PayPal, etc.<br/>`;
            //     acctype.value="Asset";
            //     break;
            // case "Other Current Liability":
            //     Acnt_desc.innerHTML=`
            //         <b>Liability</b> <br> Any short term liability like:<br/>
            //         <ul>
            //             <li>1.Customer Deposits</li>
            //             <li>2.Tax Payable</li>
            //         </ul>`;
            //         acctype.value="Liability"
            //     break;
            // case "Credit Card":
            //     Acnt_desc.innerHTML=`<b>Liability</b> <br>Create a trail of all your credit card transactions by creating a credit card account<br/>`;
            //     acctype.value="Liability"
            //     break;
            // case "Long Term Liability":
            //     Acnt_desc.innerHTML=`<b>Liability</b> <br> Liabilities that mature after a minimum period of one year like Notes Payable, Debentures, and Long Term Loans<br/>`;
            //     acctype.value="Liability"
            //     break;
            // case "Other Liability":
            //     Acnt_desc.innerHTML=`
            //         <b>Liability</b> <br>Obligation of an entity arising from past transactions or events which would require repayment.<br/>
            //         <ul>
            //             <li>1.Tax to be paid</li>
            //             <li>2.Loan to be Repaid</li>
            //             <li>3.Accounts Payable etc</li>
            //         </ul>`;
            //         acctype.value="Liability"
            //     break;
            // case "Overseas Tax Payable":
            //     Acnt_desc.innerHTML=`<b>Liability</b> <br> Track your taxes in this account if your business sells digital services to foreign customers.<br/>`;
            //     acctype.value="Liability"
            //     break;
            // case "Equity":
            //     Acnt_desc.innerHTML=`<b>Equity</b> <br>Owners or stakeholders interest on the assets of the business after deducting all the liabilities<br/>`;
            //     acctype.value="Equity"
            //     break;
            // case "Income":
            //     Acnt_desc.innerHTML=`<b>Income</b> <br>Income or Revenue earned from normal business activities like sale of goods and services to customers<br/>`;
            //     acctype.value="Income"
            //     break;
            // case "Other Income":
            //     Acnt_desc.innerHTML=`
            //         <b>Income</b> <br>Income or revenue earned from activities not directly related to your business like :<br/>
            //         <ul>
            //             <li>1.Interest Earned</li>
            //             <li>2.Dividend Earned</li>
            //         </ul>`;
            //         acctype.value="Income"
            //     break;

            default:
            Acnt_desc.innerHTML=`<b>Account Type</b> <br>Select an account type..<br/>`;
        }

        if(selectedValue !=""){
            $('#subAccountCheck').css('display','none')
            $('#subAccountCheckBox').prop('checked', $('#subAccountCheckBox').prop('checked') ? false : false);
            $('#parentAccountValue').css('display','none');

            $.ajax({
                type : 'GET',
                url:"{% url 'Fin_checkAccounts' %}",
                data:{
                    type : selectedValue,
                },
                
                success: function(response) {
                    if(response.status){
                        $('#subAccountCheck').css('display','block');
                        var dropdown = $('#parentAccount');
                        dropdown.empty();
                        dropdown.append(`<option selected disabled value="">--Choose--</option>`)
                        $.each(response, function(key, value) {
                            for(let i=0; i<value.length; i++){
                                dropdown.append($('<option></option>').text(value[i].name).val(value[i].name))
                            }
                        });
                    }else{
                        
                    }
                },         
            });

        }

        // if(selectedValue == 'Bank'){
        //     $('#bankAccNum').css('display','block');
        //     $('#account_number').prop('required',true);
        // }else{
        //     $('#bankAccNum').css('display','none');
        //     $('#account_number').prop('required',false);
        // }

}

$(document).ready(function() {
    $('#subAccountCheckBox').change(function() {
        if ($(this).is(':checked')) {
            $('#parentAccountValue').css('display','block');
            $('#parentAccount').prop('required',true);
        } else {
            $('#parentAccountValue').css('display','none');
            $('#parentAccount').prop('required',false);
        }
    });
});

$(document).on("click","#saveNewAccount",function(){
    var name = $("#accountName").val();
    var type = $("#Account_type").val();
    var code = $("#account_code").val();
    var desc = $("#description").val();
    var subAcc = $("#subAccountCheckBox").prop('checked');
    var parentAcc = $("#parentAccount").val();
    console.log(name,type,code,desc,subAcc,parentAcc);

    if(subAcc && (parentAcc =="" || parentAcc == undefined) ){
        alert('Select a parent account.!')
        return;
    }

    if (name !="" && type !="" ){
        $.ajax({
            type : 'POST',
            url:"{% url 'Fin_createNewAccountFromItems' %}",
            data:{
                'account_name' : name,
                'account_type' : type,
                'account_code' : code,
                'subAccountCheckBox' : subAcc,
                'parent_account' : parentAcc,
                'description' : desc,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            
            success: function(response) {
                if(response.status){
                    document.getElementById("newAccountForm").reset();
                    
                    var dropdown = $('#purchaseAccount');
                    dropdown.empty();
                    dropdown.append(`<option value="" disabled>--Choose--<option/>`);
                    $.each(response, function(key, value) {
                        for(let i=0; i<value.length; i++){
                            if(value[i].name == name){
                                dropdown.append($('<option selected></option>').text(value[i].name).val(value[i].name))
                            }else{
                                dropdown.append($('<option></option>').text(value[i].name).val(value[i].name))
                            }   
                        }
                    });

                }else{
                    alert("Something went wrong.!")
                }
            },         
        });
    }
    else{
        alert('Account name or Type cannot be blank.!')
    }
});
</script>



      

        </div>
        <!-- <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div> -->
      </div>
    </div>
  </div>
  <!-- items modal end -->
  
  


<!---------------------------------------------- modals end ----------------------------------------------->
                        
    



<script>
    function validateSAC() {
        var sacField = document.getElementById("sacField");
        var errorText = document.getElementById("sacError");
        var sacValue = sacField.value;

        if (sacValue.length < 6) {
            errorText.innerText = "SAC must contain at least 6 digits";
            sacField.setCustomValidity("SAC must contain at least 6 digits");
            sacField.style.borderColor = "red";
            return false;
        } else {
            errorText.innerText = "";
            sacField.setCustomValidity(""); 
            sacField.style.borderColor = ""; 
            return true;
        }
    }
    $(document).ready(function(){
        $('#itemType').on('input',function(){
            if($(this).val()=== 'Goods' )
            {
                $('#sacField').val('');
                $('#hsnField').prop('required',true);
                $('#sacField').prop('required',false);
                $('#hsnDiv').show();
                $('#sacDiv').hide();
                $('#sacError').text('');
                $('#sacField').css({'border-color':'white'});
            }
            else
            {
                $('#hsnField').val('')
                $('#hsnField').prop('required',false);
                $('#sacField').prop('required',true);
                $('#sacDiv').show();
                $('#hsnDiv').hide();
                $('#hsnError').text('');
                $('#hsnField').css({'border-color':'white'});
            }
        })
    })
</script>

{% endblock %}