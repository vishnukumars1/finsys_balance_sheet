{% extends 'company/Fin_base.html' %}
{% block body %}
{% load static %}
{% load social_share %}

<style>
    #overviewlink{
        padding: 10px;
        cursor: pointer;
        border-radius: 1vh;
        background-color: rgba(22,37,50,255);
    }

    #templatelink, #sliplink{
        padding: 10px;
        cursor: pointer;
        border-radius: 1vh;
    }

    .vl {
        border-left: 6px solid gray;
    }

    .overview_details{
        background-color: #243e54; 
        border-top-left-radius: 2vh; 
        border-bottom-left-radius: 2vh;
    }

    .overview_head{
        border-bottom: 1px solid rgba(128, 128, 128, 0.6); 
        width: fit-content;
    }

    .overview_bill{
        background-color: rgba(22,37,50,255); 
        border-top-right-radius:2vh; 
        border-bottom-right-radius: 2vh;
    }

    .ribbon .ribbon-inner {
        text-align: center;
        color: #fff;
        top: -20px;
        left: -90px;
        width: 120px;
        padding: 3px;
        /* position: relative;
        transform: rotate(-45deg); */
    }

    .ribbon .ribbon-open {
        background-color: #268ddd;
        border-color: #1c72b4;
    }

    :root {
        --body-bg: rgb(204, 204, 204);
        --white: #ffffff;
        --darkWhite: #ccc;
        --black: #000000;
        --dark: #615c60;
        --themeColor: #22b8d1;
        --pageShadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
    }

    /* Font Include */
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@600&display=swap');

    body {
        background-color: var(--body-bg);
    }

    .page {
        background: var(--white);
        display: block;
        margin: 0 auto;
        position: relative;
        box-shadow: var(--pageShadow);
    }

    .page[size="A4"] {
        width: 21cm;
        height: 29.7cm;
        overflow: hidden;
    }

    .bb {
        border-bottom: 3px solid var(--darkWhite);
    }

    .top-content {
        padding-bottom: 15px;
    }

    .top-left p {
        margin: 0;
        color: #000000;
    }

    .top-left .graphic-path {
        height: 40px;
        position: relative;
    }

    .top-left .graphic-path::before {
        content: "";
        height: 20px;
        background-color: var(--dark);
        position: absolute;
        left: 15px;
        right: 0;
        top: -15px;
        z-index: 2;
    }

    .top-left .graphic-path::after {
        content: "";
        height: 22px;
        width: 17px;
        background: var(--black);
        position: absolute;
        top: -13px;
        left: 6px;
        transform: rotate(45deg);
    }

    .top-left .graphic-path p {
        /* color: var(--white); */
        height: 40px;
        left: 0;
        right: -100px;
        text-transform: uppercase;
        background-color: var(--themeColor);
        font: 26px;
        z-index: 3;
        position: absolute;
        padding-left: 10px;
    }

    .store-user {
        padding-bottom: 25px;
    }

    .store-user p {
        margin: 0;
        font-weight: 600;
        color: #000000;
    }

    .store-user .address {
        font-weight: 400;
    }

    .store-user h5 {
        color: var(--themeColor);
        font-family: 'Rajdhani', sans-serif;
    }

    .extra-info p span {
        font-weight: 400;
    }

    .balance-info .table td,
    .balance-info .table th {
        padding: 0;
        border: 0;
    }

    .balance-info tr td:first-child {
        font-weight: 600;
    }

    .print-only {
        /* display: none; */
        height: auto;
        width: auto;
        overflow-y: auto;
        border: none;
        /* box-shadow: 5px 2px 5px 2px  grey; */
    }

    @media print{
        body{
            visibility: hidden !important; /* hide everything in body when in print mode*/
        }

        .printContainer {
            visibility: visible !important; /* Override the rule above to only show the printables*/
            position: absolute;
            z-index: 99999;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            font-size: large;
        } 
    }

    .equal-length-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 100%; /* Make the container fill the height of the column */
        margin-left: 2vh;
        margin-right: 2vh;
    }

    .equal-length-item {
        flex: 1;
        text-align: center;
    }

    #table1 thead tr td{
        color: black;
        text-align: center;
        font-weight: bold;
    }

    #table1 tbody tr td{
        text-align: center;
        color: black;
    }

    .table_data tbody tr td{
        color: black;
    }

    .temp2_rib{
        background-color: #999999; 
        border-top-right-radius: 4vh; 
        border-bottom-right-radius: 4vh;
    }

    .temp2_name{
        font-weight: bold;
    }

    .temp2_add{
        font-weight: bold;
        color: black;
    }

    #table2 tbody tr td{
        color: black;
    }

    #temp3_head{
        background-image: linear-gradient(#1b83e8, black); 
        color: white;
    }

    .table3_data tbody tr td{
        color: black;
    }

    #table3 thead tr th{
        color: black;
    }

    #table3 tbody tr td{
        color: black;
    }

    #slipdiv{
        border-radius: 2vh;
        background-color: #243e54;
        padding-top: 2%;
        padding-bottom: 2%;
    }

    .slip h5{
        font-family: serif;
    }

    .slip p {
        font-size: 1.2em;
    }

    .slip .address{
        display: flex;
        flex-direction: column;
    }

    .slip .address p,.slip-footer p{
        font-size: 1rem;
        margin: 0;
    }

    .slip-container{
        width: 105mm;
        margin: 2rem auto;
        padding: 2rem;
        border: 1px dotted black;
        box-shadow: rgba(60, 64, 67, 0.5) 0px 1px 2px 0px, rgba(60, 64, 67, 0.35) 0px 2px 6px 2px;
    }

    .divider{
        margin: 1rem 0;
        border-bottom: 3px dotted black;
    }

    .slip .datetime p, .createdby p{
        font-size: 0.85rem;
        margin: 0;
    }

    .slip .equal-length-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 100%;
        margin-left: 2vh;
        margin-right: 2vh;
    }

    .slip .equal-length-item {
        flex: 1;
        text-align: center;
    }

    #whatToPrint{
        background-color: #243e54; 
        border-radius: 2vh;
    }

    ::-webkit-scrollbar{
        display: none;
    }
</style>

<div class="page-content" id="page-content">

    <div class="modal fade" id="additional_file" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Add File</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form action="{% url 'Fin_Add_Additional_Files' pbill.id %}" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="modal-body">
                        <input type="file" class="form-control" name="file">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-info text-white" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-outline-info text-white">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="comment_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" style="background-color: #213b52;">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Add Comment</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form action="{% url 'Fin_Purchase_Bill_Add_Edit_Comment' pbill.id %}" method="POST" enctype="multipart/form-data" id="comment_form">
                    {% csrf_token %}
                    <div class="modal-body">
                        <textarea type="text" class="form-control" name="comment" id="comment" required></textarea>
                        <input type="text" class="form-control" name="comment_id" id="comment_id" hidden>
                        {% if comments %}
                        <div class="table-responsive">
                            <br>
                            <table class="table">
                                <thead class="text-center bg-info">
                                    <th>#</th>
                                    <th>Comment</th>
                                    <th>By</th>
                                    <th>Action</th>
                                </thead>
                                <tbody>
                                    {% for c in comments %}
                                    <tr class="text-center">
                                        <td>{{ forloop.counter }}</td>
                                        <td>{{ c.comment }}</td>
                                        <td hidden>{{c.id}}</td>
                                        <td>{{ c.logindetails.First_name }} {{ c.logindetails.Last_name }}</td>
                                        <td>
                                            <a class="btn btn-outline-info text-white edit_com_btn">
                                                <i class="fa fa-edit" style="font-size: x-small;"></i>
                                            </a>
                                            <a class="btn btn-outline-info text-white" href="{% url 'Fin_Purchase_Bill_Delete_Comment' c.id %}">
                                                <i class="fa fa-trash-alt" style="font-size: x-small;"></i>
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="text-center">
                            <br>
                            <p>No comments !!</p>
                        </div>
                        {% endif %}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-info text-white" data-dismiss="modal" id="comment_close">Close</button>
                        <button type="submit" class="btn btn-outline-info text-white" name="comment_save" id="comment_save">Save</button>
                        <button type="submit" class="btn btn-outline-info text-white" name="comment_edit" id="comment_edit" style="display: none;">Edit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="snd_mail">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-10 p-4">
                            <h2 class="text-uppercase" style="color: white; font-weight: bolder;">ADD Documents</h2>
                        </div>
                        <div class="col-md-2 p-3">
                            <button type="button" class="btn close" data-dismiss="modal" aria-label="Close" style="float: right;">
                                <span aria-hidden="true" style="color: white; font-weight: bolder;">&times;</span>
                            </button>
                        </div>
                    </div><br>
                    <form action="{% url 'Fin_Share_Purchase_Bill' pbill.id %}" method="post" class="needs-validation" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="emailIds">Email IDs</label>
                            <textarea class="form-control" name="email_ids" id="emailIds" rows="3" placeholder="Multiple emails can be added by separating with a comma(,)." required></textarea>
                        </div>
                        <div class="form-group mt-2">
                            <label for="item_unitname">Message(optional)</label>
                            <textarea name="email_message" id="email_message" class="form-control" cols="" rows="4" placeholder="This message will be sent along with Bill details."></textarea>
                        </div>
                        <div class="d-flex justify-content-center">
                          <button type="submit" id="share_with_email" class="submitShareEmailBtn w-50 text-uppercase">SEND MAIL</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div style="margin-right: 1%; margin-top: 1%; margin-bottom: -2%; z-index: 100;">
            <a href="{% url 'Fin_List_Purchase_Bill' %}" class="float-right" style="cursor: pointer;">
                <i class="fa fa-times-circle"></i>
            </a>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3 mt-3">
                    <a onclick="showOverview()" id="overviewlink" >Overview</a>
                    <a onclick="showTemplate()" id="templatelink" >Template</a>
                    <a onclick="showSlip()" id="sliplink" >Order Slip</a>
                </div>
                <div class="col-md-9">
                    <nav class="navbar navbar-expand-lg navbar-light">
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarScroll" aria-controls="navbarScroll" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarScroll">
                            <ul class="navbar-nav ml-auto mt-lg-0">
                                {% if pbill.status == 'Draft' %}
                                <li class="nav-item mx-1" id="active_btn">
                                    <a class="btn btn-outline-secondary text-white" href="{% url 'Fin_Convert_To_Active' pbill.id %}" role="button">
                                        <i class="fa fa-exchange" style="font-size: small;">&nbsp;&nbsp;Convert</i>
                                    </a>
                                </li>
                                {% endif %}

                                <li class="nav-item mx-1" id="edit_btn">
                                    <a class="btn btn-outline-secondary text-white" href="{% url 'Fin_Purchase_Bill_Edit' pbill.id %}" role="button">
                                        <i class="fa fa-edit" style="font-size: small;">&nbsp;&nbsp;Edit</i>
                                    </a>
                                </li>

                                <li class="nav-item mx-1" id="delete_btn">
                                    <a class="btn btn-outline-secondary text-white" href="{% url 'Fin_Delete_Purchase_Bill' pbill.id %}" role="button">
                                        <i class="fa fa-trash" style="font-size: small;">&nbsp;&nbsp;Delete</i>
                                    </a>
                                </li>

                                

                                <li class="nav-item mx-1" id="comment_btn">
                                    <a class="btn btn-outline-secondary text-white" style="cursor: pointer;" data-toggle="modal" data-target="#comment_modal">
                                        <i class="fa fa-comment" style="font-size: small;">&nbsp;&nbsp;Comment</i>
                                    </a>
                                </li>

                                <li class="dropdown p-0 nav-item mx-1 mt-2" id="attach_btn">
                                    <a class="btn btn-outline-secondary text-white dropdown-toggle" data-toggle="dropdown" style="margin-top: 2px;">
                                        <i class="fa fa-paperclip" style="font-size: small;">&nbsp;&nbsp;Attach File</i>
                                    </a>
                                    <ul class="dropdown-menu" style="background-color: black;">
                                        <a class="dropdown-item" style="cursor: pointer;" data-toggle="modal" data-target="#additional_file">Attach file</a>
                                        {% if pbill.file %}
                                        <a class="dropdown-item" style="cursor: pointer;"download  href="{{ pbill.file.url }}"><i class=" fas fa-download"></i>Download file</a>
                                        {% endif %}
                                    </ul>
                                </li>

                                <li class="nav-item mx-1" id="print_btn" style="display: none;">
                                    <a class="btn btn-outline-secondary text-white" role="button" onclick="window.printfun()">
                                        <i class="fa fa-print" style="font-size: small;">&nbsp;&nbsp;Print</i>
                                    </a>
                                </li>
            
                                <li class="nav-item mx-1" id="pdf_btn" style="display: none;">
                                    <a class="btn btn-outline-secondary text-white" role="button" id="pdflink">
                                        <i class="fa fa-print" style="font-size: small;">&nbsp;&nbsp;PDF</i>
                                    </a>
                                </li>

                                <li class="dropdown p-0 nav-item mx-1 mt-2" id="share_btn" style="display: none;">
                                    <a class="btn btn-outline-secondary text-white dropdown-toggle" data-toggle="dropdown" style="margin-top: 2px;">
                                        <i class="fa fa-share-alt" style="font-size: small;">&nbsp;&nbsp;Share</i>
                                    </a>
                                    <ul class="dropdown-menu" style="background-color: black;">
                                        <li class="ml-3"> {% post_to_whatsapp object_or_url "WhatsApp" %}</li>
                                        <li class="ml-3 text-white" data-toggle="modal" data-target="#snd_mail">
                                            Mail
                                        </li>
                                    </ul>
                                </li>
        
                                <li class="nav-item mx-1" id="history_btn">
                                    <a class="btn btn-outline-secondary text-white" href="{% url 'Fin_Purchase_List_History' pbill.id %}" role="button">
                                        <i class="fa fa-history" style="font-size: small;">&nbsp;&nbsp;History</i>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
            <br>
            <div class="card-title">
                <center>
                    <h3 class="mb-0">PURCHASE BILL OVERVIEW</h3>
                </center>
            </div>
        </div>
    </div>

    <div id="overviewdiv">
        <div class="row ml-1 mr-1">
            <div class="col-lg-8 overview_details">
                <div class="p-5">
                    <div class="d-flex">
                        <h6><span class="text-success">Created By:</span> {{hist.logindetails.First_name}} {{hist.logindetails.Last_name}}</h6>
                        <h6 class="ml-5">{{hist.change_date}}</h6>
                    </div>
                    <br>
                    <h2>#{{ pbill.bill_no }}</h2>
                    <hr>
                    <div class="row mb-4 d-flex justify-content-between align-items-center">
                        <div class="col-md-4 mt-3">
                            <h5 style="border-bottom: 1px solid rgba(128, 128, 128, 0.6); width: fit-content;">Company Details</h5>
                        </div>
                        <div class="col-md-4 mt-3"></div>
                        <div class="col-md-4 mt-3"></div>

                        <div class="col-md-2 mt-3">
                            <h6 class="mb-0">Company</h6>
                        </div>
                        <div class="col-md-4 mt-3">
                            <p class="mb-0 text-right">{{ com.Company_name}}</p>
                        </div>
                        <div class="col-md-2 mt-3 vl">
                            <h6 class="mb-0">Email</h6>
                        </div>
                        <div class="col-md-4 mt-3">
                            <p class="mb-0 text-right">{{ com.Email }}</p>
                        </div>
                    </div>
                    <div class="row mb-4 d-flex justify-content-between align-items-center">
                        <div class="col-md-2 mt-3">
                            <h6 class="mb-0">Mobile</h6>
                        </div>
                        <div class="col-md-4 mt-3">
                            <p class="mb-0 text-right">{{ com.Contact }}</p>
                        </div>
                        <div class="col-md-2 mt-3 vl">
                            <h6 class="mb-0">Address</h6>
                        </div>
                        <div class="col-md-4 mt-3">
                            <p class="mb-0 text-right">{{ com.Address }} <br>
                                {{com.City}},{{com.State}} - {{com.Pincode}}
                            </p>
                        </div>
                    </div>
                    <hr>
                    <div class="row mb-4 d-flex justify-content-between align-items-center">
                        <div class="col-md-4 mt-3">
                            <h5 class="overview_head">Vendor Details</h5>
                        </div>
                        <div class="col-md-4 mt-3"></div>
                        <div class="col-md-4 mt-3"></div>
                        <div class="col-md-2 mt-3">
                            <h6 class="mb-0">Name</h6>
                        </div>
                        <div class="col-md-4 mt-3">
                            <p class="mb-0 text-center text-capitalize">{{ pbill.vendor.first_name }} {{ pbill.vendor.last_name }}</p>
                        </div>
                        <div class="col-md-2 mt-3 vl">
                            <h6 class="mb-0">Email</h6>
                        </div>
                        <div class="col-md-4 mt-3">
                            <p class="mb-0 text-center">{{ pbill.vendor.email }}</p>
                        </div>
                    </div>
                    <div class="row mb-4 d-flex justify-content-between align-items-center">
                        <div class="col-md-2 mt-3">
                            <h6 class="mb-0">Address</h6>
                        </div>
                        <div class="col-md-4 mt-3">
                            <p class="mb-0 text-center">{{ pbill.vendor.billing_street }} <br>
                                {{ pbill.vendor.billing_city }},
                                {{ pbill.vendor.billing_state }}
                                {{ pbill.vendor.billing_pincode }}</p>
                        </div>
                        <div class="col-md-2 mt-3 vl">
                            <h6 class="mb-0">GST Type<h6>
                        </div>
                        <div class="col-md-4 mt-3">
                            <p class="mb-0 text-center">{{ pbill.vendor.gst_type }}</p>
                        </div>
                    </div>
                    {% if pbill.vendor.gstin %}
                    <div class="row mb-4 d-flex justify-content-start align-items-center">
                        <div class="col-md-3 mt-3"> 
                            <h6 class="mb-0">GST No</h6>
                        </div>
                        <div class="col-md-3 mt-3 vr">
                            <p class="mb-0">{{ pbill.vendor.gstin }}</p>
                        </div>
                        <div class="col-md-6 mt-3 vl">
                            <h6 class="mb-0">&nbsp;</h6>
                        </div>
                    </div>
                    {% endif %}
                    {% if pbill.customer %}
                    <hr class="my-4">
                    <div class="row mb-4 d-flex justify-content-between align-items-center">
                        <div class="col-md-4 mt-3">
                            <h5 class="overview_head">Customer Details</h5>
                        </div>
                        <div class="col-md-4 mt-3"></div>
                        <div class="col-md-4 mt-3"></div>

                        <div class="col-md-2 mt-3">
                            <h6 class="mb-0">Name</h6>
                        </div>
                        <div class="col-md-4 mt-3">
                            <p class="mb-0 text-center text-capitalize">{{ pbill.customer.first_name }} {{ pbill.customer.last_name }}</p>
                        </div>
                        <div class="col-md-2 mt-3 vl">
                            <h6 class="mb-0">Email</h6>
                        </div>
                        <div class="col-md-4 mt-3">
                            <p class="mb-0 text-center">{{ pbill.customer.email }}</p>
                        </div>
                    </div>
                    <div class="row mb-4 d-flex justify-content-between align-items-center">
                        <div class="col-md-2 mt-3">
                            <h6 class="mb-0">Address</h6>
                        </div>
                        <div class="col-md-4 mt-3">
                            <p class="mb-0 text-center">{{ pbill.customer.billing_street }} <br>
                                {{pbill.customer.billing_city}},
                                {{pbill.customer.billing_state}}
                                {{pbill.customer.billing_pincode}}</p>
                        </div>
                        <div class="col-md-2 mt-3 vl">
                            <h6 class="mb-0">GST Type<h6>
                        </div>
                        <div class="col-md-4 mt-3">
                            <p class="mb-0 text-center">{{ pbill.customer.gst_type }}</p>
                        </div>
                    </div>
                    {% if pbill.customer.gstin %}
                    <div class="row mb-4 d-flex justify-content-start align-items-center">
                        <div class="col-md-3 mt-3"> 
                            <h6 class="mb-0">GST No</h6>
                        </div>
                        <div class="col-md-3 mt-3 vr">
                            <p class="mb-0">{{ pbill.customer.gstin }}</p>
                        </div>
                        <div class="col-md-6 mt-3 vl">
                            <h6 class="mb-0">&nbsp;</h6>
                        </div>
                    </div>
                    {% endif %}
                    {% endif %}
                    <hr class="my-4">
                    <div class="row mb-4 d-flex justify-content-between align-items-center">
                        <div class="col-md-4 mt-3">
                            <h5 class="overview_head">Billing Details</h5>
                        </div>
                        <div class="col-md-4 mt-3"></div>
                        <div class="col-md-4 mt-3"></div>

                        <div class="col-md-3 mt-3">
                            <h6 class="mb-0">Bill No</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.bill_no }}</p>
                        </div>

                        <div class="col-md-3 mt-3 vl">
                            <h6 class="mb-0">Reference No</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.ref_no }}</p>
                        </div>
                        
                    </div>
                    {% if pbill.porder_no %}
                    <div class="row mb-4 d-flex justify-content-between align-items-center">
                        <div class="col-md-3 mt-3">
                            <h6 class="mb-0">Purchase Order No</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.porder_no }}</p>
                        </div>

                        <div class="col-md-3 mt-3 vl">
                            <h6 class="mb-0">Bill Date</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.bill_date | date:'d-m-Y' }}</p>
                        </div>
                    </div>
                    <div class="row mb-4 d-flex justify-content-between align-items-center">
                        <div class="col-md-3 mt-3">
                            <h6 class="mb-0">Due Date</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.due_date | date:'d-m-Y' }}</p>
                        </div>

                        <div class="col-md-3 mt-3 vl">
                            <h6 class="mb-0">Price List</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.pricelist.name }}</p>
                        </div>
                    </div>
                    <div class="row mb-4 d-flex justify-content-start align-items-center">
                        <div class="col-md-3 mt-3"> 
                            <h6 class="mb-0">Payment Type</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.pay_type }}</p>
                        </div>
                        {% if pbill.pay_type == 'Cash' %}
                        <div class="col-md-6 mt-3 vl">
                            <h6 class="mb-0">&nbsp;</h6>
                        </div>
                        {% elif pbill.pay_type == 'Cheque' %}
                        <div class="col-md-3 mt-3 vl">
                            <h6 class="mb-0">Cheque No</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.cheque_no }}</p>
                        </div>
                        {% elif pbill.pay_type == 'Cheque' %}
                        <div class="col-md-3 mt-3 vl">
                            <h6 class="mb-0">UPI No</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.upi_no }}</p>
                        </div>
                        {% else %}
                        <div class="col-md-3 mt-3 vl">
                            <h6 class="mb-0">Bank No</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.bank_no }}</p>
                        </div>
                        {% endif %}
                    </div>
                    {% else %}
                    <div class="row mb-4 d-flex justify-content-between align-items-center">
                        <div class="col-md-3 mt-3">
                            <h6 class="mb-0">Bill Date</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.bill_date | date:'d-m-Y' }}</p>
                        </div>

                        <div class="col-md-3 mt-3 vl">
                            <h6 class="mb-0">Due Date</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.due_date | date:'d-m-Y' }}</p>
                        </div>
                    </div>
                    {% if pbill.pricelist %}
                    <div class="row mb-4 d-flex justify-content-between align-items-center">
                        <div class="col-md-3 mt-3">
                            <h6 class="mb-0">Price List</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.pricelist.name }}</p>
                        </div>

                        <div class="col-md-3 mt-3 vl">
                            <h6 class="mb-0">Payment Type</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.pay_type }}</p>
                        </div>
                    </div>
                    <div class="row mb-4 d-flex justify-content-start align-items-center">
                        {% if pbill.pay_type == 'Cash' %}
                        {% elif pbill.pay_type == 'Cheque' %}
                        <div class="col-md-3 mt-3">
                            <h6 class="mb-0">Cheque No</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.cheque_no }}</p>
                        </div>
                        <div class="col-md-6 mt-3 vl">
                            <h6 class="mb-0">&nbsp;</h6>
                        </div>
                        {% elif pbill.pay_type == 'UPI' %}
                        <div class="col-md-3 mt-3">
                            <h6 class="mb-0">UPI No</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.upi_no }}</p>
                        </div>
                        <div class="col-md-6 mt-3 vl">
                            <h6 class="mb-0">&nbsp;</h6>
                        </div>
                        {% else %}
                        <div class="col-md-3 mt-3">
                            <h6 class="mb-0">Bank No</h6>
                        </div>
                        <div class="col-md-3 mt-3">
                            <p class="mb-0 text-center">{{ pbill.bank_no }}</p>
                        </div>
                        <div class="col-md-6 mt-3 vl">
                            <h6 class="mb-0">&nbsp;</h6>
                        </div>
                        {% endif %}
                    </div>
                    {% else %}
                        <div class="row mb-4 d-flex justify-content-between align-items-center">
                            <div class="col-md-3 mt-3">
                                <h6 class="mb-0">Payment Type</h6>
                            </div>
                            <div class="col-md-3 mt-3">
                                <p class="mb-0 text-center">{{ pbill.pay_type }}</p>
                            </div>

                            {% if pbill.pay_type == 'Cash' %}
                            <div class="col-md-6 mt-3 vl">
                                <h6 class="mb-0">&nbsp;</h6>
                            </div>
                            {% elif pbill.pay_type == 'Cheque' %}
                            <div class="col-md-3 mt-3 vl">
                                <h6 class="mb-0">Cheque No</h6>
                            </div>
                            <div class="col-md-3 mt-3">
                                <p class="mb-0 text-center">{{ pbill.cheque_no }}</p>
                            </div>
                            {% elif pbill.pay_type == 'UPI' %}
                            <div class="col-md-3 mt-3 vl">
                                <h6 class="mb-0">UPI No</h6>
                            </div>
                            <div class="col-md-3 mt-3">
                                <p class="mb-0 text-center">{{ pbill.upi_no }}</p>
                            </div>
                            {% else %}
                            <div class="col-md-3 mt-3 vl">
                                <h6 class="mb-0">Bank No</h6>
                            </div>
                            <div class="col-md-3 mt-3">
                                <p class="mb-0 text-center">{{ pbill.bank_no }}</p>
                            </div>
                            {% endif %}
                        </div>
                    {% endif %}
                    {% endif %}
                    <hr>
                    <div class="row mb-4 d-flex justify-content-between align-items-center">
                        <div class="col-md-12 mt-3">
                            <h5 class="overview_head">Item Details</h5>
                            {% for i in itm %}
                            <div class="row mb-4 d-flex justify-content-between align-items-center">
                                <div class="col-md-3 mt-3">
                                    <h6 class="mb-0">Name</h6>
                                </div>
                                <div class="col-md-3 mt-3">
                                    <p class="mb-0 text-center">{{ i.item.name }}</p>
                                </div>
        
                                <div class="col-md-3 mt-3 vl">
                                    <h6 class="mb-0">{% if i.item.item_type == 'Goods' %} HSN {% else %} SAC {% endif %}</h6>
                                </div>
                                <div class="col-md-3 mt-3">
                                    <p class="mb-0 text-center">{% if i.item.item_type == 'Goods' %} {{ i.item.hsn }} {% else %} {{ i.item.sac }} {% endif %}</p>
                                </div>
                            </div>
                            <div class="row mb-4 d-flex justify-content-between align-items-center">
                                <div class="col-md-3 mt-3">
                                    <h6 class="mb-0">Quantity</h6>
                                </div>
                                <div class="col-md-3 mt-3">
                                    <p class="mb-0 text-center">{{ i.qty }}</p>
                                </div>
        
                                <div class="col-md-3 mt-3 vl">
                                    <h6 class="mb-0">Price</h6>
                                </div>
                                <div class="col-md-3 mt-3">
                                    <p class="mb-0 text-center">{{ i.price }}</p>
                                </div>
                            </div>
                            <div class="row mb-4 d-flex justify-content-between align-items-center">
                                <div class="col-md-3 mt-3">
                                    <h6 class="mb-0">Tax</h6>
                                </div>
                                <div class="col-md-3 mt-3">
                                    {% if pbill.igst != '0' %}
                                    <p class="mb-0 text-center">{{ i.tax }}% IGST</p>
                                    {% else %}
                                    <p class="mb-0 text-center">{{ i.tax }}% GST</p>
                                    {% endif %}
                                </div>
                                <div class="col-md-3 mt-3 vl">
                                    <h6 class="mb-0">Discount</h6>
                                </div>
                                <div class="col-md-3 mt-3">
                                    <p class="mb-0 text-center">{{ i.discount }}</p>
                                </div>
                            </div>
                            <div class="row mb-4 d-flex justify-content-start align-items-center">
                                <div class="col-md-3 mt-3"> 
                                    <h6 class="mb-0">Total</h6>
                                </div>
                                <div class="col-md-2 mt-3">
                                    <p class="mb-0" style="float: right;">{{ i.total }}</p>
                                </div>
                                <div class="col-md-1"></div>
                                <div class="col-md-6 mt-3 vl">
                                    <h6 class="mb-0">&nbsp;</h6>
                                </div>
                            </div>
                            <hr class="w-50">
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 overview_bill">
                <div class="p-5">
                    <h3 class="fw-bold mb-3 mt-2 pt-1">Bill Tax Details</h3>
                    <hr class="my-4">
                    <div class="d-flex justify-content-between mb-4">
                        <h5 class="">Bill status</h5>
                        {% if pbill.status == 'Save' %}
                        <h5 class="text-success"><b>SAVED</b></h5>
                        {% else %}
                        <h5 class="text-info"><b>DRAFT</b></h5>
                        {% endif %}
                    </div>
                    <div class="d-flex justify-content-between mb-4">
                        <h5 class="">Sub Total</h5>
                        <h6>{{ pbill.subtotal }}</h6>
                    </div>
                    {% if pbill.igst != '0' %}
                    <div class="d-flex justify-content-between mb-4">
                        <h5 class="">IGST</h5>
                        <h6>{{ pbill.igst }}</h6>
                    </div>
                    {% else %}
                    <div class="d-flex justify-content-between mb-4">
                        <h5 class="">CGST</h5>
                        <h6>{{ pbill.cgst }}</h6>
                    </div>
                    <div class="d-flex justify-content-between mb-4">
                        <h5 class="">SGST</h5>
                        <h6>{{ pbill.sgst }}</h6>
                    </div>
                    {% endif %}
                    <div class="d-flex justify-content-between mb-4">
                        <h5 class="">Tax Amount</h5>
                        <h6>{{pbill.taxamount }}</h6>
                    </div>
                    {% if pbill.ship_charge != '0' %}
                    <div class="d-flex justify-content-between mb-4">
                        <h5 class="">Shipping Charge</h5>
                        <h6>{{ pbill.ship_charge}}</h6>
                    </div>
                    {% endif %}
                    {% if pbill.adjust != '0' %}
                    <div class="d-flex justify-content-between mb-4">
                        <h5 class="">Adjustment</h5>
                        <h6>{{ pbill.adjust }}</h6>
                    </div>
                    {% endif %}
                    <hr class="my-4 bg-white">
                    <div class="d-flex justify-content-between mb-4">
                        <h5 class="">Grand Total</h5>
                        <h6>{{ pbill.grandtotal }}</h6>
                    </div><br>
                </div>
            </div>
        </div>
    </div>

    <div id="templatediv" style="display: none;">
        <div class="row">
            <div class="col-md-12">
                <div class="print-only ml-1 mr-1" id="whatToPrint">
                    <!-- template1 -->
                    <div id="whatToPrint1" class="printTemplates template1" >
                        <div class="my-5 page" size="A4" >
                            <div class="p-5" id="printdiv1">
                                <div id="ember2512" class="tooltip-container ember-view ribbon text-ellipsis">
                                    <div class="ribbon-inner ribbon-open">{{pbill.status}}<!----></div></div>
                                <section class="top-content bb d-flex justify-content-between">
                                    <div class="logo">
                                    </div>
                                    <div class="top-left">
                                        <div class="graphic-path">
                                            <p>Purchase Bill</p>
                                        </div>
                                        <div class="position-relative">
                                            <p>Bill No. <span>{{ pbill.bill_no }}</span></p>
                                        </div>
                                    </div>
                                </section>
                    
                                <section class="store-user mt-5">
                                    <div class="col-12">
                                        <div class="row bb pb-3">
                                            <div class="col-7">
                                                <p>FROM,</p>
                                                <h5>{{ pbill.vendor.first_name }}{{ pbill.vendor.last_name }}</h5>
                                                <p class="address"> 
                                                    {{ pbill.vendor.billing_street }}<br>
                                                    {{ pbill.vendor.billing_city }},
                                                    {{ pbill.vendor.billing_state }}<br>
                                                    {{ pbill.vendor.billing_pincode }}<br>
                                                </p>
                                                
                                            </div>
                                            <div class="col-5">
                                                <p>TO,</p>
                                                <h5>{{ pbill.customer.first_name}} {{ pbill.customer.last_name}}</h5>
                                                <p class="address col-9" style="margin-left: -14px;" > 
                                                    {{ pbill.customer.billing_street }}<br>
                                                    {{ pbill.customer.billing_city }},
                                                    {{ pbill.customer.billing_state }}<br>
                                                    {{ pbill.customer.billing_pincode }}<br>
                                                </p>
                                                
                                            </div>
                                        </div>
                                        <div class="row extra-info pt-3">
                                            <div class="col-7">
                                                <p>Bill Date: <span>{{pbill.bill_date | date:'d-m-Y'}}</span></p>
                                            </div>
                                            <div class="col-5">
                                                <p>Due Date : <span>{{pbill.due_date | date:'d-m-Y'}}</span></p>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                    
                                <section class="product-area mt-4">
                                    <table class="table table-hover table-bordered " id="table1">
                                        <thead class="bg-info">
                                            <tr>
                                                <td>Items</td>
                                                <td>HSN</td>
                                                <td>Price</td>
                                                <td>Quantity</td>
                                                <td>Tax</td>
                                                <td>Discount</td>
                                                <td>Total</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for i in itm %}
                                            <tr>
                                                <td>{{i.item.name}}</td>
                                                <td>{{i.item.hsn}}</td>
                                                <td>{{i.price}}</td>
                                                <td>{{i.qty}}</td>
                                                {% if  pbill.igst != '0' %}
                                                <td>{{ i.tax }}% IGST</td>
                                                {% else %}
                                                <td>{{ i.tax }}% GST</td>
                                                {% endif %}
                                                <td>{{i.discount}} </td>
                                                <td>{{i.total}}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table><br><br>
                                </section>
                    
                                <section class="balance-info">
                                    <div class="row">
                                        <div class="col-md-8"></div>
                                        <div class="col-md-4">
                                            <table class="table table-borderless table_data">
                                                <tbody>
                                                    <tr>
                                                        <td>Sub Total</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.subtotal}}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Tax Amount</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.taxamount}}</td>
                                                    </tr>
                                                    {% if pbill.igst != '0' %}
                                                    <tr>
                                                        <td>IGST</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.igst}}</td>
                                                    </tr>
                                                    {% else %}
                                                    <tr>
                                                        <td>CGST</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.cgst}}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>SGST</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.sgst}}</td>
                                                    </tr>
                                                    {% endif %}
                                                    {% if pbill.ship_charge != '0' %}
                                                    <tr>
                                                        <td>Shipping Charge</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.ship_charge}}</td>
                                                    </tr>
                                                    {% endif %}
                                                    {% if pbill.adjust != '0' %}
                                                    <tr>
                                                        <td>Adjustment</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.adjust}}</td>
                                                    </tr>
                                                    {% endif %}
                                                </tbody>
                                            </table>
                                            <hr style="background-color: #000000;">
                                            <table class="table table-borderless table_data">
                                                <tbody>
                                                    <tr>
                                                        <td>Grand Total</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.grandtotal}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </section>
        
                            </div>
                        </div>
                    </div>
        
                    <!-- template2 -->
                    <div  id="whatToPrint2"  class="printTemplates template2" style="display: none;">
                        <div class="my-5 page" size="A4" >
                            <div id="printdiv2">
                                <div class="row px-5 py-4" style="background-color:#268ddd;" >
                                    <div class="col-md-2">
                                        <br>
                                        <div class="text-white bg-secondary rounded p-3 text-center">
                                            {{pbill.status}}<!---->
                                        </div>
                                    </div>
                                    <div class="col-md-1"></div>
                                    <div class="col-md-4 text-center">
                                        <br>
                                        <p class="h5 text-white"><b class="float-right">PURCHASE BILL</b></p>
                                    </div>  
                                    <div class="col-md-1"></div>
                                    <div class="col-md-4 d-flex justify-content-end">
                                        <div class="text-white">
                                            <p class="mb-0 mt-2">Bill No: <b>{{ pbill.bill_no }}</b></p>
                                            <p class="mb-0 mt-2">Bill Date: <b>{{ pbill.bill_date | date:'d-m-Y' }}</b></p>
                                            <p class="mb-0 mt-2">Due Date: <b>{{ pbill.due_date | date:'d-m-Y' }}</b></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="px-5 py-1">
                                    <section class="store-user"><br><br>
                                        <div class="col-12">
                                            <div class="row bb pb-2 mt-3">
                                                <div class="col-4 pl-0">
                                                    <label class="text-white w-100 p-1 temp2_rib"><b>VENDOR ADDRESS</b></label>
                                                    <h5 class="text-secondary temp2_name">{{ pbill.vendor.first_name }} {{ pbill.vendor.last_name }}</h5>
                                                    <p class="temp2_add">
                                                        {{ pbill.vendor.billing_street }} 
                                                        <br>
                                                        {{ pbill.vendor.billing_city }},
                                                        <br>
                                                        {{ pbill.vendor.billing_state }}
                                                        <br>
                                                        {{ pbill.vendor.billing_pincode }}
                                                        <br>
                                                        <span>Mob: </span><b>{{ pbill.vendor.mobile }}</b>
                                                    </p>  
                                                </div>
                                                <div class="col-4"></div>
                                                <div class="col-4 pr-0">
                                                    <label class="text-white w-100 p-1 temp2_rib"><b>CUSTOMER ADDRESS</b></label>
                                                    <h5 class="text-secondary temp2_name">{{ pbill.customer.first_name }} {{ pbill.customer.last_name }}</h5>
                                                    <p class="temp2_add">
                                                        {{ pbill.customer.billing_street }} 
                                                        <br>
                                                        {{pbill.customer.billing_city}},
                                                        <br>
                                                        {{pbill.customer.billing_state}}
                                                        <br>
                                                        {{pbill.customer.billing_pincode}}
                                                        <br>
                                                        <span>Mob: </span><b>{{ pbill.customer.mobile }}</b>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </section>
                        
                                    <section class="product-area mt-2">
                                        <table class="table table-hover table-bordered template2table" id="table2">
                                            <thead>
                                                <tr class="template3 tablehead text-center bg-dark text-black">
                                                    <th>Items</th>
                                                    <th>HSN</th>
                                                    <th>Quantity</th>
                                                    <th>Rate</th>
                                                    <th>Tax</th>
                                                    <th>Discount</th>
                                                    <th>Total</th>
                                                </tr>
                                            </thead>
                                            <tbody class="bg-secondary">
                                                {% for i in itm %}
                                                    <tr class="text-center">
                                                        <td>{{ i.item.name }}</td>
                                                        <td>{{ i.item.hsn }}</td>
                                                        <td>{{ i.qty }}</td>
                                                        <td>{{ i.price }}</td>
                                                        {% if pbill.igst != '0' %}
                                                        <td>{{ i.tax }}% IGST</td>
                                                        {% else %}
                                                        <td>{{ i.tax }}% GST</td>
                                                        {% endif %}
                                                        <td>{{ i.discount }}</td>
                                                        <td>{{ i.total }}</td>
                                                    </tr>
                                                {% endfor %} 
                                            </tbody>
                                        </table>
                                    </section>
                        
                                    <section class="balance-info">
                                        <div class="row mt-3">
                                            <div class="col-4"></div>
                                            <div class="col-4"></div>
                                            <div class="col-4"><br><br>
                                                <table class="table table-borderless table_data">
                                                    <tbody>
                                                        <tr>
                                                            <td>Sub Total</td>
                                                            <td>:</td>
                                                            <td class="text-center">{{pbill.subtotal}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Tax Amount</td>
                                                            <td>:</td>
                                                            <td class="text-center">{{pbill.taxamount}}</td>
                                                        </tr>
                                                        {% if pbill.igst != '0' %}
                                                        <tr>
                                                            <td>IGST</td>
                                                            <td>:</td>
                                                            <td class="text-center">{{pbill.igst}}</td>
                                                        </tr>
                                                        {% else %}
                                                        <tr>
                                                            <td>CGST</td>
                                                            <td>:</td>
                                                            <td class="text-center">{{pbill.cgst}}</td> 
                                                        </tr>
                                                        <tr>
                                                            <td>SGST</td>
                                                            <td>:</td>
                                                            <td class="text-center">{{pbill.sgst}}</td>
                                                        </tr>
                                                        {% endif %}
                                                        {% if pbill.ship_charge != '0' %}
                                                        <tr>
                                                            <td>Shipping Charge</td>
                                                            <td>:</td>
                                                            <td class="text-center">{{pbill.ship_charge}}</td>
                                                        </tr>
                                                        {% endif %}
                                                        {% if pbill.adjust != '0' %}
                                                        <tr>
                                                            <td>Adjustment</td>
                                                            <td>:</td>
                                                            <td class="text-center">{{pbill.adjust}}</td>
                                                        </tr>
                                                        {% endif%}
                                                    </tbody>
            
                                                </table>
                                                <hr style="background-color: #000000;">
                                                <table class="table table-borderless table_data">
                                                    <tbody>
                                                        <tr>
                                                            <td>Grand Total</td>
                                                            <td>:</td>
                                                            <td class="text-center">{{pbill.grandtotal}}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div> 
                                        </div>
                                    </section>
                                </div>
                            </div>
                        </div>
                    </div>
        
                    <!-- template3 -->
                    <div id="whatToPrint3" class="printTemplates template3" style="display: none;">
                        <div class="my-5 page"  size="A4" >
                            <div id="printdiv3">
                                <div class="row">
                                    <div class="col-sm-12" id="temp3_head">
                                        <p class="mt-2 text-center" style="font-size: 4vh;">Purchase Bill</p>
                                        <p class="text-center"> 
                                            {{ pbill.vendor.first_name }} {{ pbill.vendor.last_name }} <br>
                                            {{ pbill.vendor.billing_street }}  <br>
                                            {{ pbill.vendor.billing_city }},
                                            {{ pbill.vendor.billing_state }}<br>
                                            {{ pbill.vendor.billing_pincode }}
                                            <br>
                                        </p>
                                    </div>
                                    
                                    <div class="row col-12">
                                        <div class="col-md-1"></div>
                                        <div class="col-5">
                                            <br><br><br>
                                            <p style="color:black;"> <span style=" font-weight: bold;">To: </span><br>
                                            <div class="ml-1" style="color:black;">
                                                {{cust.title}} {{ pbill.customer.first_name }} {{ pbill.customer.last_name }}<br>
                                                {{ pbill.customer.billing_street }}  <br>
                                                {{ pbill.customer.billing_city }},
                                                {{ pbill.customer.billing_state }}<br>
                                                {{ pbill.customer.billing_pincode }}
                                            </div>
                                            </p>
                                        </div>
                                        <div class="col-5">
                                            <br><br><br>
                                            <table class="table table-borderless table3_data">
                                                <tbody>
                                                    <tr>
                                                        <td style="font-weight: bold;">Bill No</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{ pbill.bill_no }}</td>
                                                    </tr>
                                                    
                                                    <tr>
                                                        <td style="font-weight: bold;">Bill Date</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.bill_date | date:'d-m-Y'}}<td>
                                                    </tr>
        
                                                    <tr>
                                                        <td style="font-weight: bold;">Due Date</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.due_date | date:'d-m-Y'}}</td>
                                                    </tr>
                                                </tbody>
            
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-md-1"></div>
                                    <div class="col-md-10"><br>
                                        <table class="table table-hover table-bordered template3table" id="table3">
                                            <thead >
                                                <tr class="template3 tablehead text-center bg-dark">
                                                    <th>Items</th>
                                                    <th>HSN</th>
                                                    <th>Quantity</th>
                                                    <th>Rate</th>
                                                    <th>Tax</th>
                                                    <th>Discount</th>
                                                    <th>Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for i in itm %}
                                                    <tr class="text-center">
                                                        <td>{{ i.item.name }}</td>
                                                        <td>{{ i.item.hsn }}</td>
                                                        <td>{{ i.qty }}</td>
                                                        <td>{{ i.price  }}</td>
                                                        {% if pbill.igst != '0' %}
                                                        <td>{{ i.tax }}% IGST</td>
                                                        {% else %}
                                                        <td>{{ i.tax }}% GST</td>
                                                        {% endif %}
                                                        <td>{{ i.discount  }}</td>
                                                        <td>{{ i.total }}</td>
                                                    </tr>
                                                {% endfor %} 
                                            </tbody>
                                        </table>
                                    </div>
                                </div> 
                                <section class="balance-info">
                                    <div class="row">
                                        <div class="col-md-7"></div>
                                        <div class="col-md-4">
                                            <br>
                                            <table class="table table-borderless table_data">
                                                <tbody>
                                                    <tr>
                                                        <td>Sub Total</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.subtotal}}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Tax Amount</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.taxamount}}</td>
                                                    </tr>
                                                    {% if pbill.igst != '0' %}
                                                    <tr>
                                                        <td>IGST</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.igst}}</td>
                                                    </tr>
                                                    {% else %}
                                                    <tr>
                                                        <td>CGST</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.cgst}}</td>
                                                        
                                                    </tr>
                                                    <tr>
                                                        <td>SGST</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.sgst}}</td>
                                                    </tr>
                                                    {% endif %}
                                                    {% if pbill.ship_charge != '0' %}
                                                    <tr>
                                                        <td>Shipping Charge</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.ship_charge}}</td>
                                                    </tr>
                                                    {% endif %}
                                                    {% if pbill.adjust != '0' %}
                                                    <tr>
                                                        <td>Adjustment</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.adjust}}</td>
                                                    </tr>
                                                    {%endif%}
                                                </tbody>
                                            </table>
                                            <hr style="background-color: #000000;">
                                            <table class="table table-borderless table_data">
                                                <tbody>
                                                    <tr>
                                                        <td>Grand Total</td>
                                                        <td>:</td>
                                                        <td class="text-center">{{pbill.grandtotal}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </section> 
                            </div>
                        </div>
                    </div>
                </div>
                <div id="templateToggle" class="templateToggleSegment mt-3 mb-0 w-100 d-flex justify-content-center">
                    <button class="btn btn-outline-light btn-sm m-2 active templateToggleButtons" id="toggleTemplate1" onclick="toggleTemplate('whatToPrint1','toggleTemplate1')">1</button>
                    <button class="btn btn-outline-light btn-sm m-2 templateToggleButtons" id="toggleTemplate2" onclick="toggleTemplate('whatToPrint2','toggleTemplate2')">2</button>
                    <button class="btn btn-outline-light btn-sm m-2 templateToggleButtons" id="toggleTemplate3" onclick="toggleTemplate('whatToPrint3','toggleTemplate3')">3</button>
                </div>
            </div>
        </div>
    </div>

    <div id="slipdiv" style="display: none;">
        <div class="slip-container bg-white" id="slip_container">
            <div class="slip text-dark">
                <h5 class="font-weight-bold text-center text-dark">{{ pbill.vendor.first_name }} {{ pbill.vendor.last_name }}</h5>
                <div class="address text-center">
                    <p>{{ pbill.vendor.billing_street }}</p>
                    <p>{{ pbill.vendor.billing_city }}, {{ pbill.vendor.billing_state }}</p>
                    <p>{{ pbill.vendor.billing_pincode }}</p>
                    <p>{{ pbill.vendor.email }}</p>
                    <p>{{ pbill.vendor.mobile }}</p>
                </div>

                <div class="divider"></div>

                <div class="ml-4 mt-2" style="color: black;">
                    <div class="row">
                        <div class="col-md-6 text-left">Bill No:</div>
                        <div class="col-md-5 text-right">{{ pbill.bill_no }}</div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 text-left">Customer Name:</div>
                        <div class="col-md-5 text-right">{{ pbill.vendor.first_name }} {{ pbill.vendor.last_name }}</div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 text-left">Bill Date :</div>
                        <div class="col-md-5 text-right">{{ pbill.bill_date | date:'d-m-Y'}}</div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 text-left">Due Date :</div>
                        <div class="col-md-5 text-right">{{ pbill.due_date | date:'d-m-Y'}}</div>
                    </div>
                </div>

                <div class="divider"></div>

                <div class="equal-length-container" style="color: black; font-weight: bold;">
                    <div class="equal-length-item" style=" text-align: center;">
                        Item
                        <hr style="border-bottom: 1px solid black; margin-top:1vh; width:95%">
                    </div>
                    <div class="equal-length-item ml-2"  style=" text-align:center;">
                        HSN
                        <hr style="border-bottom: 1px solid black; margin-top:1vh; width:63%; margin-left: 10px;">
                    </div>
                    <div class="equal-length-item"  style=" text-align: center; ">
                        Qty
                        <hr style="border-bottom: 1px solid black; margin-top:1vh; width:60%;  margin-left: 10px;">
                    </div>
                    <div class="equal-length-item"  style=" text-align: center; ">
                        Rate
                        <hr style="border-bottom: 1px solid black; margin-top:1vh; width:65%;  margin-left: 10px;">
                    </div>
                    <div class="equal-length-item"  style=" text-align: center; ">
                        Tax
                        <hr style="border-bottom: 1px solid black; margin-top:1vh; width:60%;  margin-left: 10px;">
                    </div>
                    <div class="equal-length-item" style=" text-align: center; ">
                        Total
                        <hr style="border-bottom: 1px solid black; margin-top:1vh; width:65%;  margin-left: 10px;">
                    </div>
                </div>
                {% for i in itm %}
                <div class="equal-length-container" style="color: black; font-size: small; word-wrap: break-word; margin-bottom: 1vh;">
                    <div class="equal-length-item"  style="text-align: center; margin-left: 2px;">
                        {{ i.item.name }}
                    </div>
                    <div class="equal-length-item" style="text-align: right;">
                        {{ i.item.hsn }}
                    </div>
                    <div class="equal-length-item" style="text-align: center; ">
                        {{ i.qty }}
                    </div>
                    <div class="equal-length-item" style="text-align: center; ">
                        {{ i.price }}
                    </div>
                    <div class="equal-length-item" id="tax{{ forloop.counter }}">
                        {{ i.tax }}% {{ i.tax_type }}
                    </div>
                    <div class="equal-length-item" style="text-align: center; ">
                        {{ i.total }}
                    </div>
                </div>
                {% endfor %}

                <div class="subtot mt-5">
                    {% if dis != 0 %}
                    <div class="subtot-item d-flex justify-content-between">
                        <span>Discount</span>
                        <span><span>&#8377; </span>{{ dis }}</span>
                    </div>
                    {% endif %}
                    <div class="subtot-item d-flex justify-content-between">
                        <span>Subtotal</span>
                        <span><span>&#8377; </span>{{ pbill.subtotal }}</span>
                    </div>
                    <div class="subtot-item d-flex justify-content-between">
                        <span>Tax Amount</span>
                        <span><span>&#8377; </span>{{ pbill.taxamount }}</span>
                    </div>
                    {% if pbill.igst != '0' %}
                    <div class="subtot-item d-flex justify-content-between">
                        <span>IGST</span>
                        <span><span>&#8377; </span>{{ pbill.igst }}</span>
                    </div>
                    {% else %}
                    <div class="subtot-item d-flex justify-content-between">
                        <span>CGST</span>
                        <span><span>&#8377; </span>{{ pbill.cgst }}</span>
                    </div>
                    <div class="subtot-item d-flex justify-content-between">
                        <span>SGST</span>
                        <span><span>&#8377; </span>{{ pbill.sgst }}</span>
                    </div>
                    {% endif %}
                    {% if pbill.adjust != '0' %}
                    <div class="subtot-item d-flex justify-content-between">
                        <span>Adjustment</span>
                        <span><span>&#8377; </span>{{ pbill.adjust }}</span>
                    </div>
                    {% endif %}
                </div>
                <div class="divider"></div>
                <div class="grandtot fw-bold d-flex justify-content-between">
                    <span><strong>TOTAL</strong></span>
                    <span><strong><span>&#8377; </span>{{ pbill.grandtotal }}</strong></span>
                </div>
                <div class="divider"></div>
                <div class="paid-by mb-4 d-flex justify-content-between">
                    <span>Created By:</span>
                    <span>{{hist.logindetails.First_name}}  {{hist.logindetails.Last_name}}</span>
                </div>
                <div class="createdby d-flex justify-content-between" style="margin-top: -8%;">
                    <span>Printed By:</span>
                    <span>{{data.First_name}}  {{data.Last_name}}</span>
                </div>
                <div class="datetime d-flex justify-content-between">
                    <p class="">Printed On:</p>
                    <span id="datetimedisplay"></span>
                </div>
                <div class="slip-footer mt-4 text-center">
                    <p>Thank you for supporting Local business!</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<!-- Update Time in Order Slip -->
<script>
    function updateDateTime() {
        var currentDate = new Date();
        var day = currentDate.getDate();
        var month = currentDate.getMonth() + 1;
        var year = currentDate.getFullYear();
        var hours = currentDate.getHours();
        var minutes = currentDate.getMinutes();
        var seconds = currentDate.getSeconds();
        var formattedDay = (day < 10) ? `0${day}` : day;
        var formattedMonth = (month < 10) ? `0${month}` : month;
        var formattedHours = (hours < 10) ? `0${hours}` : hours;
        var formattedMinutes = (minutes < 10) ? `0${minutes}` : minutes;
        var formattedSeconds = (seconds < 10) ? `0${seconds}` : seconds;
        var formattedDateTime = `${formattedDay}/${formattedMonth}/${year} ${formattedHours}:${formattedMinutes}:${formattedSeconds}`;
        document.getElementById('datetimedisplay').textContent = formattedDateTime;
    }

    updateDateTime();
    setInterval(updateDateTime, 1000);
</script>

<!-- Generate PDF -->
<script type="text/javascript">
    $(document).ready(function ($) {
        $(document).on('click', '#pdflink', function (event) {
            event.preventDefault();
            print1 = document.getElementById('whatToPrint1')
            print2 = document.getElementById('whatToPrint2')
            print3 = document.getElementById('whatToPrint3')
            print4 = document.getElementById('slipdiv')

            if (print1.style.display !== 'none'){
                var element = document.getElementById('printdiv1') 
            }

            if (print2.style.display !== 'none'){
                var element = document.getElementById('printdiv2') 
            }

            if (print3.style.display !== 'none'){
                var element = document.getElementById('printdiv3') 
            }

            if (print4.style.display !== 'none'){
                var element = document.getElementById('slip_container') 
            }

            var opt =
            {
                margin: 1,
                filename: 'Purchase_Bill' + '.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait', }
            };
            html2pdf().set(opt).from(element).save();
        });
    });
</script>

<!-- Print -->
<script>
    function printfun(){
        print4 = document.getElementById('slipdiv')
        if (print4.style.display !== 'none'){
            var printContents = document.getElementById("slipdiv").innerHTML;
        }else{
            var printContents = document.getElementById("whatToPrint").innerHTML;
        }

        var $printerDiv = $('<div class="printContainer"></div>'); // create the div that will contain the stuff to be printed
        $printerDiv.html(printContents); // add the content to be printed
        $('body').append($printerDiv).addClass("printingContent"); // add the div to body, and make the body aware of printing (we apply a set of css styles to the body to hide its contents)

        window.print(); // call print
        $printerDiv.remove(); // remove the div
        $('body').removeClass("printingContent");
    }
</script>

<!-- Toggle Between 3 Template -->
<script>
    function toggleTemplate(templateId,buttonId){
        $('.printTemplates').css('display','none');
        $('#'+templateId).css('display','block');
        $('.templateToggleButtons').removeClass('active');
        $('#'+buttonId).addClass('active');
        $("#templatePrintButton").attr("onclick","printSection('"+templateId+"')");
        document.getElementById('page-content').scrollIntoView();
    }
</script>

<!-- Toggle Between Overview, Template and Slip -->
<script>
    function showOverview(){
        document.getElementById('overviewdiv').style.display='block'
        document.getElementById('templatediv').style.display='none'
        document.getElementById('slipdiv').style.display='none'
        document.getElementById('overviewlink').style.backgroundColor='rgba(22,37,50,255)'
        document.getElementById('templatelink').style.backgroundColor='transparent'
        document.getElementById('sliplink').style.backgroundColor='transparent'
        document.getElementById('edit_btn').style.display='block'
        document.getElementById('share_btn').style.display='none'
        document.getElementById('attach_btn').style.display='block'
        document.getElementById('delete_btn').style.display='block'
        document.getElementById('print_btn').style.display='none'
        document.getElementById('pdf_btn').style.display='none'
        $('#comment_btn').show();
        $('#history_btn').show();
        document.getElementById('active_btn').style.display='block'
    }

    function showTemplate(){
        document.getElementById('overviewdiv').style.display='none'
        document.getElementById('templatediv').style.display='block'
        document.getElementById('slipdiv').style.display='none'
        document.getElementById('overviewlink').style.backgroundColor='transparent'
        document.getElementById('templatelink').style.backgroundColor='rgba(22,37,50,255)'
        document.getElementById('sliplink').style.backgroundColor='transparent'
        document.getElementById('edit_btn').style.display='none'
        document.getElementById('delete_btn').style.display='none'
        document.getElementById('share_btn').style.display='block'
        document.getElementById('attach_btn').style.display='none'
        document.getElementById('print_btn').style.display='block'
        document.getElementById('pdf_btn').style.display='block'
        $('#comment_btn').hide();
        $('#history_btn').hide();
        document.getElementById('active_btn').style.display='none'
    }

    function showSlip(){
        document.getElementById('overviewdiv').style.display='none'
        document.getElementById('templatediv').style.display='none'
        document.getElementById('slipdiv').style.display='block'
        document.getElementById('templatelink').style.backgroundColor='transparent'
        document.getElementById('overviewlink').style.backgroundColor='transparent'
        document.getElementById('sliplink').style.backgroundColor='rgba(22,37,50,255)'
        document.getElementById('edit_btn').style.display='none'
        document.getElementById('delete_btn').style.display='none'
        document.getElementById('share_btn').style.display='none'
        document.getElementById('attach_btn').style.display='none'
        document.getElementById('print_btn').style.display='block'
        document.getElementById('pdf_btn').style.display='block'
        $('#comment_btn').hide();
        $('#history_btn').hide();
        document.getElementById('active_btn').style.display='none'
    }
</script>

<!-- Edit in comment modal -->
<script>
    $(document).ready(function() {
        $(".edit_com_btn").click(function() {
            var $row = $(this).closest("tr");
            var comm_no = $row.find("td:nth-last-child(3)").text();
            var data = $row.find("td:nth-last-child(4)").text();
            $('#comment_id').val(comm_no)
            $('#comment').val(data)
            $('#comment_save').hide()
            $('#comment_edit').show()
        });
    });

    $(document).ready(function(){
        $('#comment_close').click(function() {
            $('#comment_id').val('')
            $('#comment').val('')
            $('#comment_save').show()
            $('#comment_edit').hide()
        });
    });
</script>


{% endblock %}