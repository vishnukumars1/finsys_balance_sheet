<!-- Created --shemeem  -->
{% extends 'company/Fin_base.html' %}
{% block body %}
{% load static %}

<style>
  input {
    background-color: #2f516f;
    border: 0;
    border-radius: 5px;
    color: white;
  }
  .selectize-input.full {
    background-color: #43596c !important;
    color: white !important;
    border: 1px solid rgb(255 255 255 / 35%) !important;
   }
   .dropdown-menu.accounts-available {
    border-radius: 5px;
   }
   #createNewAccount {
    overflow-y:auto;
   }
   .customers-options{
    cursor: pointer;
   }

</style>

<form action="{% url 'Fin_updateJournal' journal.id %}" method="post" class="needs-validation" enctype="multipart/form-data" onsubmit="return validateForm()">
  {% csrf_token %}
  <div class="page-content">
    <!-- <span class="d-flex justify-content-end p-2" style="cursor: pointer;" onclick="window.location.href=`{% url 'Fin_manualJournals' %}`"><i class="fa fa-times-circle text-white" style="font-size: 1.2rem;"></i></span> -->
    <div class="card radius-15">
      <div class="card-body">
        <div class="card-title">
          <center><h3 class="mb-0">EDIT MANUAL JOURNAL</h3></center>
        </div>
        <hr />
      </div>
    </div>
    <div class="card radius-15">
      <div class="card-body">
        <div id="journal">
            <div class="row">
                <div class="col-md-4 mt-3">
                    <div class="d-flex">
                        <label class="">Journal No.</label><span class="text-danger ml-3" id="JrnNOErr"></span>
                    </div>
                    <input type="text" class="form-control" value="{{journal.journal_no}}" name="journal_no" id="journalNumber" style="background-color: #43596c;" placeholder="{{JRNNo}}" required>
                </div>
                <div class="col-md-4 mt-3">
                    <label class="">Reference Number</label>
                    <input type="text" class="form-control" name="reference_number" value="{{journal.reference_no}}" style="background-color: #43596c;" readonly>
                </div>
                <div class="col-md-4 mt-3">
                    <label class="">Journal Date:</label>
                    <input type="date" class="form-control" name="journal_date" id="journalDate" style="background-color: #43596c; color: white;" value="{{journal.journal_date|date:'Y-m-d'}}">
                </div>
                <div class="col-md-4 mt-3">
                    <label class="">Currency</label>
                    <select name="currency" id="currency" class="form-control">
                        <option value="INR-Indian Rupee" selected>INR-Indian Rupee</option>
                    </select>
                </div>
                <div class="col-md-4 mt-3">
                    <label class="">Notes</label>
                    <textarea class="form-control" name="notes" id="notes" rows="4" placeholder="Enter Notes..">{{journal.notes}}</textarea>
                </div>

            </div>

            <div class="row clearfix ">
                <div class="col-md-12 table-responsive-md mt-3">
                    <table class="table table-bordered table-hover mt-3" id="estimateItemsTable">
                        <thead>
                            <tr>
                                <th class="text-center">#</th>
                                <th class="text-center">ACCOUNT</th>
                                <th class="text-center">DESCRIPTION</th>
                                <th class="text-center">CONTACT</th>
                                <th class="text-center">DEBITS</th>
                                <th class="text-center">CREDITS</th>
                            </tr>
                        </thead>
                        <tbody id="accounts-table-body">
                            {% for acc in jrnAccounts %}
                            <tr id='tab_row{{forloop.counter}}'>
                                <td class="nnum" style="text-align: center;">{{forloop.counter}}</td>
                                <td style="width: 20%;">
                                    <div class="d-flex">
                                        <div class="w-100">
                                            <div class="p-0 border-0 bg-none position-relative drop-box" style="display: block;">
                                                <input type="text" id="item{{forloop.counter}}" value="{{acc.Account.account_name}}" name="account_name[]" class="dropdown-toggle form-control account-display" onkeyup="filterFunction($(this).attr('id'))"  data-toggle="dropdown" aria-expanded="false" placeholder="Accounts.." autocomplete="off">
                                                <ul class="dropdown-menu w-100 accounts-available position-absolute" id="menu{{forloop.counter}}"  style="overflow-y: auto; height: fit-content;max-height: 50vh; width: fit-content !important; max-width: 21vw;"> 
                                                    {% for i in accounts %}
                                                    <li class="dropdown-item account-options" style="cursor: pointer;" onclick="getAccountDetails($(this).parent().prev().attr('id'),`{{i.account_name}}`,`{{i.id}}`)">{{i.account_name}}</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                        <a href="#">
                                            <button type="button" class="btn btn-outline-secondary ml-1" data-target="#createNewAccount" data-toggle="modal">+</button>
                                        </a>
                                    </div>
                                
                                </td>
                                <td>
                                    <input type="hidden" name="id[]" value="{{acc.id}}">
                                    <input type="hidden" name="acc_id[]" id="accId{{forloop.counter}}" value="{{acc.Account.id}}">
                                    <input type="text" name='desc[]' id="desc{{forloop.counter}}" value="{{acc.description}}" placeholder='Enter Description..' class="form-control" style="background-color: #43596c; color: white;" />
                                </td>
                                <td style="width: 20%;">
                                    <div class="w-100">
                                        <div class="p-0 border-0 bg-none position-relative drop-box" style="display: block;">
                                            <input type="text" id="contact{{forloop.counter}}" value="{{acc.contact}}" name="contact[]" class="dropdown-toggle form-control contact-display" onkeyup="filterContacts($(this).attr('id'))"  data-toggle="dropdown" aria-expanded="false" placeholder="Contact.." autocomplete="off">
                                            <ul class="dropdown-menu w-100 contacts-available position-absolute" id="contactMenu{{forloop.counter}}"  style="overflow-y: auto; height: fit-content;max-height: 50vh; width: fit-content !important; max-width: 21vw;"> 
                                                {% for i in vendors %}
                                                <li class="dropdown-item contact-options" style="cursor: pointer;" onclick="getContactDetails($(this).parent().prev().attr('id'),`{{i.first_name}} {{i.last_name}}`)">{{i.title}} {{i.first_name}} {{i.last_name}}</li>
                                                {% endfor %}

                                                {% for i in customers %}
                                                <li class="dropdown-item contact-options" style="cursor: pointer;" onclick="getContactDetails($(this).parent().prev().attr('id'),`{{i.first_name}} {{i.last_name}}`)">{{i.title}} {{i.first_name}} {{i.last_name}}</li>
                                                {% endfor %}

                                                {% for i in employees %}
                                                <li class="dropdown-item contact-options" style="cursor: pointer;" onclick="getContactDetails($(this).parent().prev().attr('id'),`{{i.first_name}} {{i.last_name}}`)">{{i.title}} {{i.first_name}} {{i.last_name}}</li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                </td>
                                <td >
                                    <input type="number" name='debits[]' id="debit{{forloop.counter}}" class="form-control debits" step="any" min=0 style="background-color: #43596c; color: white;" value={{acc.debit}} />
                                </td>
                                <td>
                                    <input type="number" name='credits[]' id="credit{{forloop.counter}}" class="form-control credits" step="any" min=0 style="background-color: #43596c; color: white;" value={{acc.credit}} />
                                </td>
                                <td>
                                    <button type="button" id="{{forloop.counter}}" class="btn btn-danger remove_row px-2 py-1 mx-1 fa fa-close" title="Remove Row"> </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tr>
                            <td style="border: none;"><a class="btn btn-outline-secondary ml-1" role="button" id="add" >+</a></td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="row clearfix" style="margin-top:20px">
                <div class="col-md-4">
                    <label for="formFileMultiple" class="form-label">Attach File(s)</label>
                    <input type="file" name="file" class="form-control" id="formFileMultiple" multiple />
                </div>
                <div class="col-md-2"></div>
                <div class="col-md-6 table-responsive-md" style="background-color:rgba(0,0,0,.2);">
                    <table class="table" id="tab_logic_total">
                        <tbody>
                            <tr>
                                <th class="text-center text-muted">Sub Total</th>
                                <td>
                                    <input type="number" class="form-control" name='subtotal_debit' placeholder='0.00' value={{journal.subtotal_debit}} style="background-color: #43596c; border: none;" id="debitSubTotal" readonly/>
                                </td>
                                <td>
                                    <input type="number" class="form-control" name='subtotal_credit' placeholder='0.00' value={{journal.subtotal_credit}} style="background-color: #43596c; border: none;" id="creditSubTotal" readonly/>
                                </td>
                            </tr>
                            <tr>
                                <th class="text-center">Total Amount</th>
                                <td>
                                    <input type="number" name='total_debit' id="debitTotalAmount" value="{{journal.total_debit}}" placeholder='0.00' class="form-control" />
                                </td>
                                <td>
                                    <input type="number" name='total_credit' placeholder='0.00' value="{{journal.total_credit}}" class="form-control" id="creditTotalAmount" />
                                </td>
                            </tr>
                            <tr>
                                <th class="text-center"> Difference</th>
                                <td>
                                    <input type="number" name='balance_debit' id="debitDifference" value="{{journal.balance_debit}}" placeholder='0.00' class="form-control"/>
                                </td>
                                <td>
                                    <input type="number" name='balance_credit' id="creditDifference" value="{{journal.balance_credit}}" placeholder='0.00' class="form-control"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        
            <div class="row my-5">
                <div class="col-md-6">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="agreeTerms" required style="background-color: #43596c;">
                        <label for="agreeTerms">Agree to terms and conditions</label>
                        <div class="invalid-feedback">You must agree before submitting.</div>
                    </div>
                </div>
                <div class="col-md-6 d-flex">
                    <input type="submit" class="btn btn-outline-secondary w-50 text-light" value="Save">
                    <input type="reset" class="btn btn-outline-secondary w-50 ml-1 text-light" onclick="window.location.href=`{% url 'Fin_viewJournal' journal.id %}`" value="Cancel">
                </div>
            </div>
        </div>
      </div>
    </div>
  </div>
</form>







<!-- Account Create Modal -->

<div class="modal fade" id="createNewAccount">
    <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background-color: #213b52;">
            <div class="modal-header">
                <h5 class="m-3">New Account</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card p-3">
                    <form method="post" id="newAccountForm">
                        {% csrf_token %}
                        <div class="row mt-2 mb-2">
                            <div class="col-md-6">
                                <div class="row mt-2">
                                    <div class="col-12">
                                        <label for="acctyp">Account Type</label>
                                        <input type="text" value="Assets" id="acctype" name="acctype" hidden>
                                        <select name="account_type" id="Account_type" class="custom-select-md form-control w-100"  onchange="AccountTypeChange(this)" required>
                                            <optgroup label="Assets" style="background-color: rgb(47 81 111);">
                                                <option value="Other Asset"> Other Asset </option>
                                                <option value="Other Current Asset"> Other Current Asset </option>
                                                <option value="Cash"> Cash </option>
                                                <option value="Bank"> Bank </option>
                                                <option value="Fixed Asset"> Fixed Asset </option>
                                                <option value="Stock"> Stock</option>
                                                <option value="Payment Clearing"> Payment Clearing</option>
                                            </optgroup>
                                        
                                            <optgroup label="Liability" style="background-color: rgb(47 81 111);">
                                                <option value="Other Current Liability">Other Current Liability </option>
                                                <option value="Credit Card"> Credit Card </option>
                                                <option value="Long Term Liability"> Long Term Liability </option>
                                                <option value="Other Liability"> Other Liability </option>
                                                <option value="Overseas Tax Payable"> Overseas Tax Payable </option>
                                            </optgroup>
                                        
                                            <optgroup label="Equity" style="background-color: rgb(47 81 111);">
                                                <option value="Equity"> Equity </option>
                                            </optgroup>
                                        
                                            <optgroup label="Income" style="background-color: rgb(47 81 111);">
                                                <option value="Income"> Income </option>
                                                <option value="Other Income"> Other Income </option>
                                            </optgroup>
                                        
                                            <optgroup label="Expense" style="background-color: rgb(47 81 111);">
                                                <option value="Expense"> Expense </option>
                                                <option value="Cost Of Goods Sold"> Cost Of Goods Sold </option>
                                                <option value="Other Expense"> Other Expense </option>
                                            </optgroup>
                                        
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-12">
                                        <label for="name">*Name</label>
                                        <input name="account_name" id="accountName" required class="custom-select-md form-control w-100">
                                    </div>
                                </div>
                                <div class="row mt-1" id="subAccountCheck" style="display: none;">
                                    <div class="col-12">
                                        <div class="form-check">
                                            <input type="checkbox" name="subAccountCheckBox" class="form-check-input" id="subAccountCheckBox">
                                            <label class="form-check-label" for="subAccountCheckBox">Make this a sub-account</label>
                                            <span><i class="fa fa-question-circle" data-toggle="tooltip" data-placement="bottom" title="Select this option if you are creating a sub-account."></i></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2" id="parentAccountValue" style="display: none;">
                                    <div class="col-12">
                                        <label for="parentAccount">Parent Account</label>
                                        <select name="parent_account" id="parentAccount" class="custom-select-md form-control w-100">
        
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-12">
                                        <label for="acc_code">Account Code</label>
                                        <input type="text" name="account_code" id="account_code" class="form-control">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-12">
                                        <label>Description</label>
                                        <textarea class="form-control" rows="3" id="description" name="description" placeholder="Max. 500 Characters"></textarea>
                                    </div>
                                </div>
                                
                            </div>
                            <div class="col-md-6 mt-4"> 
                                <div id="acnt-desc" class="form-control" name="detype" style="font-size: small;  height: fit-content;"></div>
                            </div>
                        </div>
                            
                        <div class="mt-3">
                            <div class="row">
                                <div class="col-md-4"></div>
                                <div class="col-md-4 d-flex justify-content-center">
                                    <button type="button" id="saveNewAccount" class="btn btn-outline-info">Save</button>
                                </div>
                                <div class="col-md-4"></div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>   
    </div>
</div>



<script>

    $(document).on('change','#journalNumber', function() {
        $('#JrnNOErr').text('');
        var jrn_num = $(this).val();
        if(jrn_num != ""){
            console.log(jrn_num);
            $.ajax({
                type: "GET",
                url: "{% url 'Fin_checkJournalNumber' %}",
                data: {
                    JrnNum : jrn_num,
                },
                success: function (response) {
                    if (response.status){
                        $('#JrnNOErr').text('');
                    }else{
                        $('#JrnNOErr').text(response.message);
                    }
                }
            })
        }
    });

    function filterFunction(id){
        var options = $('#'+ $("#"+id).next().attr('id')).children();
        var search_text = $("#"+id).val().toLowerCase();
        options.each(function(){
            if($(this).text().toLowerCase().includes(search_text)){
                $(this).show()
            }else{
                $(this).hide()
            }
        })
    }

    function filterContacts(id){
        var options = $('#'+ $("#"+id).next().attr('id')).children();
        var search_text = $("#"+id).val().toLowerCase();
        options.each(function(){
            if($(this).text().toLowerCase().includes(search_text)){
                $(this).show()
            }else{
                $(this).hide()
            }
        })
    }
    
    function getAccountDetails(inpId, value, accId){
        var accnt = value;
        var exists = false;

        $('#accounts-table-body tr').each(function () {
            var html = $(this).html();
            if (html != '') {
                var accName = $(this).find('.account-display').val();
                if(accName == accnt){
                    exists = true;
                }
            }
        });

        if(!exists){
            var n = inpId.slice(4);
            $('#'+inpId).val(value);
            document.getElementById('accId'+n).value = accId;
        }else{
            alert('Account already exists in the JOURNAL, choose another.!')
        }

    }

    function getContactDetails(inpId, value){
        var n = inpId.slice(4);
        $('#'+inpId).val(value);
    }

    


    // calculation---------------------------

    $(document).ready(function(){
        $('#accounts-table-body').on('keyup change', function () {
            calc();
        });
    });

    function calc() {
        var debit_total = 0;
        var credit_total = 0;
        $('#accounts-table-body tr').each(function() {
            var html = $(this).html();
            if (html != '') {
                var debit_val = $(this).find('.debits').val();
                var credit_val = $(this).find('.credits').val();
            
                debit_total += parseFloat(debit_val) || 0;
                credit_total += parseFloat(credit_val) || 0;

                $('#debitSubTotal').val(debit_total.toFixed(2));
                $('#debitTotalAmount').val(debit_total.toFixed(2));
                $('#creditSubTotal').val(credit_total.toFixed(2));
                $('#creditTotalAmount').val(credit_total.toFixed(2));
                
                calc_diff(debit_total, credit_total);
            }
        });
    }

    function calc_diff(debitTotal, creditTotal) {
        var x = 0;
        if (debitTotal == creditTotal) {
            $('#debitDifference').val(x.toFixed(2));
            $('#creditDifference').val(x.toFixed(2));
        } else if (debitTotal > creditTotal) {
            $('#debitDifference').val(x.toFixed(2));
            $('#creditDifference').val((debitTotal - creditTotal).toFixed(2));
        } else {
            $('#debitDifference').val((creditTotal - debitTotal).toFixed(2));
            $('#creditDifference').val(x.toFixed(2));
        }
    }
 
    // Tabel row add, clone, remove

    function refreshIndex(){
        var slNo = 1;
        var $rows = $("#accounts-table-body tr");

        for (var i = 0; i < $rows.length; i++) {
            $rows.eq(i).attr('id', 'tab_row'+slNo)
            $rows.eq(i).find('[id]').each(function() {
                var oldId = $(this).attr('id');
                var newId = oldId.replace(/\d+/, slNo);
                $(this).attr('id', newId );
            });

            $rows.eq(i).find('.nnum').text(slNo);
            slNo++;
        }
    }

    $(document).on('click','.remove_row',function(){
        var row_id = $(this).attr("id");
        $('#tab_row'+row_id+'').remove();
        refreshIndex();
        calc();
    });

    

$(document).ready(function(){
   $('#add').click(function(){
    var roinc = $("#accounts-table-body tr").length;
    roinc++
    $('#accounts-table-body').append(
        `
        <tr id='tab_row${roinc}'>
            <td class="nnum" style="text-align: center;">${roinc}</td>
            <td style="width: 20%;">
                <div class="d-flex">
                    <div class="w-100">
                        <div class="p-0 border-0 bg-none position-relative drop-box" style="display: block;">
                            <input type="text" id="item${roinc}" value="" name="account_name[]" class="dropdown-toggle form-control account-display" onkeyup="filterFunction($(this).attr('id'))"  data-toggle="dropdown" aria-expanded="false" placeholder="Accounts.." autocomplete="off">
                            <ul class="dropdown-menu w-100 accounts-available position-absolute" id="menu${roinc}"  style="overflow-y: auto; height: fit-content;max-height: 50vh; width: fit-content !important; max-width: 21vw;"> 
                                {% for i in accounts %}
                                <li class="dropdown-item account-options" style="cursor: pointer;" onclick="getAccountDetails($(this).parent().prev().attr('id'),'{{i.account_name}}','{{i.id}}')">{{i.account_name}}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <a href="#">
                        <button type="button" class="btn btn-outline-secondary ml-1" data-target="#createNewAccount" data-toggle="modal">+</button>
                    </a>
                </div>
            
            </td>
            <td>
                <input type="hidden" name="id[]" value=0 >
                <input type="hidden" name="acc_id[]" id="accId${roinc}">
                <input type="text" name='desc[]' id="desc${roinc}" placeholder='Enter Description..' class="form-control" style="background-color: #43596c; color: white;" />
            </td>
            <td style="width: 20%;">
                <div class="w-100">
                    <div class="p-0 border-0 bg-none position-relative drop-box" style="display: block;">
                        <input type="text" id="contact${roinc}" value="" name="contact[]" class="dropdown-toggle form-control contact-display" onkeyup="filterContacts($(this).attr('id'))"  data-toggle="dropdown" aria-expanded="false" placeholder="Contact.." autocomplete="off">
                        <ul class="dropdown-menu w-100 contacts-available position-absolute" id="contactMenu${roinc}"  style="overflow-y: auto; height: fit-content;max-height: 50vh; width: fit-content !important; max-width: 21vw;"> 
                            {% for i in vendors %}
                            <li class="dropdown-item contact-options" style="cursor: pointer;" onclick="getContactDetails($(this).parent().prev().attr('id'),'{{i.first_name}} {{i.last_name}}')">{{i.title}} {{i.first_name}} {{i.last_name}}</li>
                            {% endfor %}

                            {% for i in customers %}
                            <li class="dropdown-item contact-options" style="cursor: pointer;" onclick="getContactDetails($(this).parent().prev().attr('id'),'{{i.first_name}} {{i.last_name}}')">{{i.title}} {{i.first_name}} {{i.last_name}}</li>
                            {% endfor %}

                            {% for i in employees %}
                            <li class="dropdown-item contact-options" style="cursor: pointer;" onclick="getContactDetails($(this).parent().prev().attr('id'),'{{i.first_name}} {{i.last_name}}')">{{i.title}} {{i.first_name}} {{i.last_name}}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </td>
            <td >
                <input type="number" name='debits[]' id="debit${roinc}"  class="form-control debits" step="any" min=0 style="background-color: #43596c; color: white;" value=0 />
            </td>
            <td>
                <input type="number" name='credits[]' id="credit${roinc}" class="form-control credits" step="any" min=0 style="background-color: #43596c; color: white;" value=0 />
            </td>
            <td>
                <button type="button" id="${roinc}" class="btn btn-danger remove_row px-2 py-1 mx-1 fa fa-close" title="Remove Row"> </button>
            </td>
        </tr>
        `);
    });
  });
 
  
    function validateForm() {
        var length = $("#accounts-table-body tr").length;
        if(length < 1){
            alert('Add at least 1 Account..!')
            return false;
        }

        if(parseFloat($('#debitSubTotal').val()) == 0.0 || parseFloat($('#creditSubTotal').val()) == 0.0){
            alert('Debit and credit values should be entered.!')
            return false;
        }

        if(parseFloat($('#debitSubTotal').val()) != parseFloat($('#creditSubTotal').val())){
            alert('Please ensure that the debits and credits are equal..!')
            return false;
        }
    }

  
   </script>

<!-- Add Account -> scripts -->

<script>

    // Account add modal js

    $(document).ready(function(){
        var Acnt_desc = document.getElementById("acnt-desc");
        Acnt_desc.innerHTML=`<b>Asset</b> <br> Track special assets like goodwill and other intangible assets<br/>`;

            var selectedValue = $('#Account_type').val();
            $.ajax({
                type : 'GET',
                url:"{% url 'Fin_checkAccounts' %}",
                data:{
                    type : selectedValue,
                },
                
                success: function(response) {
                    if(response.status){
                        $('#subAccountCheck').css('display','block');
                        var dropdown = $('#parentAccount');
                        dropdown.empty();
                        dropdown.append(`<option selected disabled value="">--Choose--</option>`)
                        $.each(response, function(key, value) {
                            for(let i=0; i<value.length; i++){
                                dropdown.append($('<option></option>').text(value[i].name).val(value[i].name))
                            }
                        });
                    }else{
                        
                    }
                },         
            });
    })
    
    function AccountTypeChange(selectBox) {
        var selectElement = document.getElementById("Account_type");
        var selectedValue = selectElement.value;
        var Acnt_desc = document.getElementById("acnt-desc");
        var acctype = document.getElementById("acctype");

        switch(selectedValue) {

            case "Other Asset":
                Acnt_desc.innerHTML=`<b>Asset</b> <br> Track special assets like goodwill and other intangible assets<br/>`;
                acctype.value="Asset";
                break;
            case "Other Current Asset":
                Acnt_desc.innerHTML=`
                    <b>Asset</b> <br> Any short term asset that can be converted into cash or cash equivalents easily<br/>
                    <ul>
                        <li>1.Prepaid expenses</li>
                        <li>2.Stocks and Mutual Funds</li>
                    </ul>`;
                acctype.value="Asset";
                break;
            case "Cash":
                Acnt_desc.innerHTML=`<b>Asset</b> <br> To keep track of cash and other cash equivalents like petty cash, undeposited funds, etc.<br/>`;
                acctype.value="Asset";
                break;
            case "Bank":
                Acnt_desc.innerHTML=`<b>Asset</b> <br> To keep track of bank accounts like Savings, Checking, and Money Market accounts<br/>`;
                    acctype.value="Asset";
                break;
            case "Fixed Asset":
                Acnt_desc.innerHTML=`
                    <b>Asset</b> <br> Any long term investment or an asset that cannot be converted into cash easily like:<br/>
                    <ul>
                        <li>1.Land and Buildings</li>
                        <li>2.Plant, Machinery and Equipment</li>
                        <li>3.Computers</li>
                        <li>3.Furniture</li>
                    </ul>`;
                    acctype.value="Asset";
                break;
            case "Stock":
                Acnt_desc.innerHTML=`<b>Asset</b> <br> To keep track of your inventory assets.<br/>`;
                acctype.value="Asset";
                break;
            case "Payment Clearing":
                Acnt_desc.innerHTML=`<b>Asset</b> <br> To keep track of funds moving in and out via payment processors like Stripe, PayPal, etc.<br/>`;
                acctype.value="Asset";
                break;
            case "Other Current Liability":
                Acnt_desc.innerHTML=`
                    <b>Liability</b> <br> Any short term liability like:<br/>
                    <ul>
                        <li>1.Customer Deposits</li>
                        <li>2.Tax Payable</li>
                    </ul>`;
                    acctype.value="Liability"
                break;
            case "Credit Card":
                Acnt_desc.innerHTML=`<b>Liability</b> <br>Create a trail of all your credit card transactions by creating a credit card account<br/>`;
                acctype.value="Liability"
                break;
            case "Long Term Liability":
                Acnt_desc.innerHTML=`<b>Liability</b> <br> Liabilities that mature after a minimum period of one year like Notes Payable, Debentures, and Long Term Loans<br/>`;
                acctype.value="Liability"
                break;
            case "Other Liability":
                Acnt_desc.innerHTML=`
                    <b>Liability</b> <br>Obligation of an entity arising from past transactions or events which would require repayment.<br/>
                    <ul>
                        <li>1.Tax to be paid</li>
                        <li>2.Loan to be Repaid</li>
                        <li>3.Accounts Payable etc</li>
                    </ul>`;
                    acctype.value="Liability"
                break;
            case "Overseas Tax Payable":
                Acnt_desc.innerHTML=`<b>Liability</b> <br> Track your taxes in this account if your business sells digital services to foreign customers.<br/>`;
                acctype.value="Liability"
                break;
            case "Equity":
                Acnt_desc.innerHTML=`<b>Equity</b> <br>Owners or stakeholders interest on the assets of the business after deducting all the liabilities<br/>`;
                acctype.value="Equity"
                break;
            case "Income":
                Acnt_desc.innerHTML=`<b>Income</b> <br>Income or Revenue earned from normal business activities like sale of goods and services to customers<br/>`;
                acctype.value="Income"
                break;
            case "Other Income":
                Acnt_desc.innerHTML=`
                    <b>Income</b> <br>Income or revenue earned from activities not directly related to your business like :<br/>
                    <ul>
                        <li>1.Interest Earned</li>
                        <li>2.Dividend Earned</li>
                    </ul>`;
                    acctype.value="Income"
                break;
            case "Expense":
                Acnt_desc.innerHTML=`
                    <b>Expense</b> <br>Reflects expenses incurred for running normal business operations, such as :<br/>
                    <ul>
                        <li>1.Advertisements and Marketing</li>
                        <li>2.Business Travel Expenses</li>
                        <li>3.License Fees</li>
                        <li>4.Utility Expenses</li>
                    </ul>`;
                    acctype.value="Expense"
                break;
            case "Cost Of Goods Sold":
                Acnt_desc.innerHTML=`
                    <b>Expense</b> <br>This indicates the direct costs attributable to the production of the goods sold by a company such as:<br/>
                    <ul>
                        <li>1.Material and Labor costs</li>
                        <li>2.Cost of obtaining raw materials</li>
                    </ul>`;
                    acctype.value="Expense"
                break;
            case "Other Expense":
                Acnt_desc.innerHTML=`
                    <b>Expense</b> <br>Track miscellaneous expenses incurred for activities other than primary business operations or create additional accounts to track default expenses like insurance or contribution towards charity.<br/>`;
                    acctype.value="Expense"
                break;

            default:
            Acnt_desc.innerHTML=`<b>Account Type</b> <br>Select an account type..<br/>`;
                // }
            }

        if(selectedValue !=""){
            $('#subAccountCheck').css('display','none')
            $('#subAccountCheckBox').prop('checked', $('#subAccountCheckBox').prop('checked') ? false : false);
            $('#parentAccountValue').css('display','none');

            $.ajax({
                type : 'GET',
                url:"{% url 'Fin_checkAccounts' %}",
                data:{
                    type : selectedValue,
                },
                
                success: function(response) {
                    if(response.status){
                        $('#subAccountCheck').css('display','block');
                        var dropdown = $('#parentAccount');
                        dropdown.empty();
                        dropdown.append(`<option selected disabled value="">--Choose--</option>`)
                        $.each(response, function(key, value) {
                            for(let i=0; i<value.length; i++){
                                dropdown.append($('<option></option>').text(value[i].name).val(value[i].name))
                            }
                        });
                    }else{
                        
                    }
                },         
            });

        }

}

$(document).ready(function() {
    $('#subAccountCheckBox').change(function() {
        if ($(this).is(':checked')) {
            $('#parentAccountValue').css('display','block');
            $('#parentAccount').prop('required',true);
        } else {
            $('#parentAccountValue').css('display','none');
            $('#parentAccount').prop('required',false);
        }
    });
});

$(document).on("click","#saveNewAccount",function(){
    var name = $("#accountName").val();
    var type = $("#Account_type").val();
    var code = $("#account_code").val();
    var desc = $("#description").val();
    var subAcc = $("#subAccountCheckBox").prop('checked');
    var parentAcc = $("#parentAccount").val();
    console.log(name,type,code,desc,subAcc,parentAcc);

    if(subAcc && (parentAcc =="" || parentAcc == undefined) ){
        alert('Select a parent account.!')
        return;
    }

    if (name !="" && type !="" ){
        $.ajax({
            type : 'POST',
            url:"{% url 'Fin_createNewAccountAjax' %}",
            data:{
                'account_name' : name,
                'account_type' : type,
                'account_code' : code,
                'subAccountCheckBox' : subAcc,
                'parent_account' : parentAcc,
                'description' : desc,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            
            success: function(response) {
                if(response.status){
                    document.getElementById("newAccountForm").reset();
                    
                    $('#accounts-table-body tr').each(function () {
                        var currentRow = $(this);
                        var html = currentRow.html();
                        
                        if (html !== '') {
                            currentRow.find(".accounts-available").find("li").remove();

                            $.each(response, function(key, value) {
                                for (let i = 0; i < value.length; i++) {
                                    console.log(value);
                                    console.log(value[i]);
                                    console.log(value[i].name);
                                    currentRow.find(".accounts-available").append(`<li class="dropdown-item account-options" style="cursor: pointer;" onclick="getAccountDetails($(this).parent().prev().attr('id'),'${value[i].name}','${value[i].id}')">${value[i].name}</li>`);
                                }
                            });
                        }
                    });

                    if($('#createNewAccount').hasClass('show')){
                        $("#createNewAccount").modal('toggle');
                    }
                }else{
                    alert(response.message)
                }
            },         
        });
    }
    else{
        alert('Account name or Type cannot be blank.!')
    }
});
</script>

{% endblock %}